!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Wang={})}(this,function(e){"use strict";class t{}function n(e,t=".wang"){return e.endsWith(t)||e.includes(".")?e:e+t}class s extends Error{constructor(e,t={type:"RuntimeError"},n){super(e),this.name="WangError",this.context=t,this.originalError=n,Error.captureStackTrace&&Error.captureStackTrace(this,s)}toString(){return this.message}getFormattedMessage(e){let t=this.message;return this.context.suggestions&&this.context.suggestions.length>0&&(t+="\n\n💡 Suggestions:\n",this.context.suggestions.forEach((e,n)=>{t+=`   ${n+1}. ${e}\n`})),this.context.variables&&Object.keys(this.context.variables).length>0&&(t+="\n\n📊 Variables in scope:\n",Object.entries(this.context.variables).forEach(([e,n])=>{const s=this.formatValue(n);t+=`   • ${e}: ${s}\n`})),this.context.stackTrace&&this.context.stackTrace.length>0&&(t+="\n\n📍 Stack trace:\n",this.context.stackTrace.forEach(e=>{t+=`   ${e}\n`})),t}formatValue(e){return null===e?"null":void 0===e?"undefined":"string"==typeof e?`"${e}"`:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?`[array of ${e.length} items]`:"object"==typeof e?`{${Object.keys(e).join(", ")}}`:typeof e}}class r extends s{constructor(e,t=[]){const n=[];if(t.length>0){const s=t.filter(t=>t.includes(e.split("/").pop()||"")).slice(0,3);s.length>0&&n.push(`Did you mean one of these? ${s.join(", ")}`)}n.push("Check that the module path is correct"),n.push("Ensure the module has been added to the resolver"),super(`Module not found: "${e}"`,{type:"ModuleError",suggestions:n})}}class o extends s{constructor(e,t,n){const s=typeof t;let r="undefined";try{r=void 0===t?"undefined":null===t?"null":JSON.stringify(t).substring(0,50)}catch(e){r=String(t).substring(0,50)}super(`Type mismatch in ${n}:\n   Expected: ${e}\n   Received: ${s} (${r})`,{type:"RuntimeError",suggestions:[`Check that the value is of type ${e}`,"Use type conversion if necessary","Verify the data source"]})}}class a extends s{constructor(e,t){const n=[],s=t.filter(t=>t.includes(e)||e.includes(t)).slice(0,3);s.length>0&&n.push(`Did you mean: ${s.join(", ")}?`),n.push("Check for typos in the variable name"),n.push("Ensure the variable is declared before use"),super(`Variable "${e}" is not defined`,{type:"RuntimeError",suggestions:n,variables:Object.fromEntries(t.slice(0,10).map(e=>[e,"..."]))})}}class i extends t{constructor(){super(),this.modules=new Map,this.metadata=new Map}addModule(e,t,s){const r=n(e);return this.modules.set(r,t),s&&this.metadata.set(r,s),this}addModules(e){return Object.entries(e).forEach(([e,t])=>{this.addModule(e,t)}),this}removeModule(e){const t=n(e);return this.metadata.delete(t),this.modules.delete(t)}async resolve(e,t){const s=function(e,t){return t&&e.startsWith(".")?function(e){const t=e.split("/"),n=[];for(const e of t)".."===e?n.pop():e&&"."!==e&&n.push(e);return n.join("/")}(t.split("/").slice(0,-1).join("/")+"/"+e):e}(e,t),o=n(s);if(this.modules.has(o))return{code:this.modules.get(o),path:o,metadata:this.metadata.get(o)};if(this.modules.has(s))return{code:this.modules.get(s),path:s,metadata:this.metadata.get(s)};const a=n(s+"/index");if(this.modules.has(a))return{code:this.modules.get(a),path:a,metadata:this.metadata.get(a)};const i=await this.list();throw new r(e,i)}async exists(e,t){try{return await this.resolve(e,t),!0}catch{return!1}}async list(e){const t=Array.from(this.modules.keys());return e?t.filter(t=>t.startsWith(e)):t}clearCache(){this.modules.clear(),this.metadata.clear()}async getMetadata(e){const t=n(e);return this.metadata.get(t)||null}get size(){return this.modules.size}get isEmpty(){return 0===this.modules.size}exportModules(){const e={};return this.modules.forEach((t,n)=>{e[n]={code:t,metadata:this.metadata.get(n)}}),e}importModules(e){return Object.entries(e).forEach(([e,{code:t,metadata:n}])=>{this.modules.set(e,t),n&&this.metadata.set(e,n)}),this}}function l(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function c(e){return e.reduce((e,t)=>e+t,0)}function u(e){return new Promise(t=>setTimeout(t,e))}const p={sort_by:function(e,t){const n=[...e];if(!t)return n.sort();const s="string"==typeof t?e=>e?.[t]:t;return n.sort((e,t)=>{const n=s(e),r=s(t);return n<r?-1:n>r?1:0})},reverse:function(e){return[...e].reverse()},unique:function(e){return[...new Set(e)]},unique_by:function(e,t){const n="string"==typeof t?e=>e?.[t]:t,s=new Set,r=[];for(const t of e){const e=n(t);s.has(e)||(s.add(e),r.push(t))}return r},group_by:function(e,t){const n="string"==typeof t?e=>e?.[t]:t,s={};for(const t of e){const e=String(n(t));s[e]||(s[e]=[]),s[e].push(t)}return s},chunk:function(e,t=1){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n},flatten:function e(t,n=1){return n<=0?[...t]:t.reduce((t,s)=>Array.isArray(s)?t.concat(e(s,n-1)):t.concat(s),[])},first:function(e,t=1){return 1===t?e[0]:e.slice(0,t)},last:function(e,t=1){return 1===t?e[e.length-1]:e.slice(-t)},take:function(e,t){return e.slice(0,t)},drop:function(e,t){return e.slice(t)},shuffle:l,sample:function(e,t=1){const n=l(e);return 1===t?n[0]:n.slice(0,t)},zip:function(...e){const t=Math.min(...e.map(e=>e.length)),n=[];for(let s=0;s<t;s++)n.push(e.map(e=>e[s]));return n},partition:function(e,t){const n=[],s=[];for(const r of e)(t(r)?n:s).push(r);return[n,s]},keys:function(e){return Object.keys(e||{})},values:function(e){return Object.values(e||{})},entries:function(e){return Object.entries(e||{})},pick:function(e,t){const n={};for(const s of t)s in e&&(n[s]=e[s]);return n},omit:function(e,t){const n={...e};for(const e of t)delete n[e];return n},merge:function(...e){return Object.assign({},...e)},get:function(e,t,n){if("number"==typeof t){const s=e?.[t];return void 0===s?n:s}const s=String(t).split(".");let r=e;for(const e of s){if(null==r)return n;r=r[e]}return void 0===r?n:r},set:function(e,t,n){const s=t.split("."),r={...e};let o=r;for(let e=0;e<s.length-1;e++){const t=s[e];t in o&&"object"==typeof o[t]||(o[t]={}),o[t]={...o[t]},o=o[t]}return o[s[s.length-1]]=n,r},clone:function e(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t))return t.map(t=>e(t));const n={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=e(t[s]));return n},split:function(e,t=""){return e.split(t)},join:function(e,t=","){return e.join(t)},trim:function(e){return e.trim()},trim_start:function(e){return e.trimStart()},trim_end:function(e){return e.trimEnd()},replace_all:function(e,t,n){return e.split(t).join(n)},upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},starts_with:function(e,t){return e.startsWith(t)},ends_with:function(e,t){return e.endsWith(t)},includes:function(e,t){return e.includes(t)},pad_start:function(e,t,n=" "){return e.padStart(t,n)},pad_end:function(e,t,n=" "){return e.padEnd(t,n)},truncate:function(e,t,n="..."){return e.length<=t?e:e.slice(0,t-n.length)+n},map:async function(e,t){const n=[];for(let s=0;s<e.length;s++)n.push(await t(e[s],s));return n},filter:async function(e,t){const n=[];for(let s=0;s<e.length;s++)await t(e[s],s)&&n.push(e[s]);return n},reduce:async function(e,t,n){let s=arguments.length>2?n:e[0];for(let n=arguments.length>2?0:1;n<e.length;n++)s=await t(s,e[n],n);return s},find:async function(e,t){for(let n=0;n<e.length;n++)if(await t(e[n],n))return e[n]},find_index:async function(e,t){for(let n=0;n<e.length;n++)if(await t(e[n],n))return n;return-1},every:async function(e,t){for(let n=0;n<e.length;n++)if(!await t(e[n],n))return!1;return!0},some:async function(e,t){for(let n=0;n<e.length;n++)if(await t(e[n],n))return!0;return!1},count:async function(e,t){if(!t)return e.length;let n=0;for(const s of e)await t(s)&&n++;return n},is_array:function(e){return Array.isArray(e)},is_object:function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)},is_string:function(e){return"string"==typeof e},is_number:function(e){return"number"==typeof e&&!isNaN(e)},is_boolean:function(e){return"boolean"==typeof e},is_function:function(e){return"function"==typeof e},is_null:function(e){return null===e},is_empty:function(e){return null==e||(Array.isArray(e)||"string"==typeof e?0===e.length:"object"==typeof e&&0===Object.keys(e).length)},min:function(e){return 0===e.length?1/0:Math.min(...e)},max:function(e){return 0===e.length?-1/0:Math.max(...e)},sum:c,avg:function(e){return 0===e.length?0:c(e)/e.length},median:function(e){if(0===e.length)return 0;const t=[...e].sort((e,t)=>e-t),n=Math.floor(t.length/2);return t.length%2==0?(t[n-1]+t[n])/2:t[n]},round:function(e,t=0){const n=Math.pow(10,t);return Math.round(e*n)/n},floor:function(e){return Math.floor(e)},ceil:function(e){return Math.ceil(e)},abs:function(e){return Math.abs(e)},clamp:function(e,t,n){return Math.min(Math.max(e,t),n)},range:function(e,t,n=1){void 0===t&&(t=e,e=0);const s=[];if(n>0)for(let r=e;r<t;r+=n)s.push(r);else if(n<0)for(let r=e;r>t;r+=n)s.push(r);return s},sleep:u,wait:function(e){return u(e)},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},to_json:function(e,t=!1){return t?JSON.stringify(e,null,2):JSON.stringify(e)},from_json:function(e){return JSON.parse(e)},to_base64:function(e){return"undefined"!=typeof btoa?btoa(e):Buffer.from(e,"utf8").toString("base64")},from_base64:function(e){return"undefined"!=typeof atob?atob(e):Buffer.from(e,"base64").toString("utf8")}},m=(()=>{const e={exports:{}};var t,n;return t=void 0,n=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n="boolean"==typeof(new RegExp).sticky;function s(e){return e&&"[object RegExp]"===t.call(e)}function r(e){return e&&"object"==typeof e&&!s(e)&&!Array.isArray(e)}function o(e){return new RegExp("|"+e).exec("").length-1}function a(e){return"("+e+")"}function i(e){return e.length?"(?:"+e.map(function(e){return"(?:"+e+")"}).join("|")+")":"(?!)"}function l(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(s(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function c(e,t){return e.length>t?e:Array(t-e.length+1).join(" ")+e}function u(t,n){if(r(n)||(n={match:n}),n.include)throw new Error("Matching rules cannot also include states");var o={defaultType:t,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var a in n)e.call(n,a)&&(o[a]=n[a]);if("string"==typeof o.type&&t!==o.type)throw new Error("Type transform cannot be a string (type '"+o.type+"' for token '"+t+"')");var i=o.match;return o.match=Array.isArray(i)?i:i?[i]:[],o.match.sort(function(e,t){return s(e)&&s(t)?0:s(t)?-1:s(e)?1:t.length-e.length}),o}function p(e){return Array.isArray(e)?function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n];if(s.include)for(var r=[].concat(s.include),o=0;o<r.length;o++)t.push({include:r[o]});else{if(!s.type)throw new Error("Rule has no type: "+JSON.stringify(s));t.push(u(s.type,s))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),n=[],s=0;s<t.length;s++){var o=t[s],a=e[o],i=[].concat(a);if("include"!==o){var l=[];i.forEach(function(e){r(e)?(l.length&&n.push(u(o,l)),n.push(u(o,e)),l=[]):l.push(e)}),l.length&&n.push(u(o,l))}else for(var c=0;c<i.length;c++)n.push({include:i[c]})}return n}(e)}var m=u("error",{lineBreaks:!0,shouldThrow:!0});function f(e,t){for(var r=null,c=Object.create(null),u=!0,p=null,f=[],h=[],y=0;y<e.length;y++)e[y].fallback&&(u=!1);for(y=0;y<e.length;y++){var b=e[y];if(b.include)throw new Error("Inheritance is not allowed in stateless lexers");if(b.error||b.fallback){if(r)throw!b.fallback==!r.fallback?new Error("Multiple "+(b.fallback?"fallback":"error")+" rules not allowed (for token '"+b.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+b.defaultType+"')");r=b}var d=b.match.slice();if(u)for(;d.length&&"string"==typeof d[0]&&1===d[0].length;)c[d.shift().charCodeAt(0)]=b;if(b.pop||b.push||b.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+b.defaultType+"')");if(b.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+b.defaultType+"')")}if(0!==d.length){u=!1,f.push(b);for(var x=0;x<d.length;x++){var $=d[x];if(s($))if(null===p)p=$.unicode;else if(p!==$.unicode&&!1===b.fallback)throw new Error("If one rule is /u then all must be")}var g=i(d.map(l)),v=new RegExp(g);if(v.test(""))throw new Error("RegExp matches empty string: "+v);if(o(g)>0)throw new Error("RegExp has capture groups: "+v+"\nUse (?: … ) instead");if(!b.lineBreaks&&v.test("\n"))throw new Error("Rule should declare lineBreaks: "+v);h.push(a(g))}}var E=r&&r.fallback,w=n&&!E?"ym":"gm",S=n||E?"":"|";return!0===p&&(w+="u"),{regexp:new RegExp(i(h)+S,w),groups:f,fast:c,error:r||m}}function h(e,t,n){var s=e&&(e.push||e.next);if(s&&!n[s])throw new Error("Missing state '"+s+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!==+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var y=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};y.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedText=t?t.queuedText:"",this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},y.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},y.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},y.prototype.popState=function(){this.setState(this.stack.pop())},y.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var b=n?function(e,t){return e.exec(t)}:function(e,t){var n=e.exec(t);return 0===n[0].length?null:n};function d(){return this.value}if(y.prototype._getGroup=function(e){for(var t=this.groups.length,n=0;n<t;n++)if(void 0!==e[n+1])return this.groups[n];throw new Error("Cannot find token type for matched text")},y.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var n=this.buffer;if(e!==n.length){if(a=this.fast[n.charCodeAt(e)])return this._token(a,n.charAt(e),e);var s=this.re;s.lastIndex=e;var r=b(s,n),o=this.error;if(null==r)return this._token(o,n.slice(e,n.length),e);var a=this._getGroup(r),i=r[0];return o.fallback&&r.index!==e?(this.queuedGroup=a,this.queuedText=i,this._token(o,n.slice(e,r.index),e)):this._token(a,i,e)}},y.prototype._token=function(e,t,n){var s=0;if(e.lineBreaks){var r=/\n/g,o=1;if("\n"===t)s=1;else for(;r.exec(t);)s++,o=r.lastIndex}var a={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:d,offset:n,lineBreaks:s,line:this.line,col:this.col},i=t.length;if(this.index+=i,this.line+=s,0!==s?this.col=i-o+1:this.col+=i,e.shouldThrow)throw new Error(this.formatError(a,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),a},"undefined"!=typeof Symbol&&Symbol.iterator){var x=function(e){this.lexer=e};x.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},x.prototype[Symbol.iterator]=function(){return this},y.prototype[Symbol.iterator]=function(){return new x(this)}}return y.prototype.formatError=function(e,t){if(null==e){var n=this.buffer.slice(this.index);e={text:n,offset:this.index,lineBreaks:-1===n.indexOf("\n")?0:1,line:this.line,col:this.col}}var s=Math.max(e.line-2,1),r=e.line+2,o=String(r).length,a=function(e,t){for(var n=e.length,s=0;;){var r=e.lastIndexOf("\n",n-1);if(-1===r)break;if(n=r,++s===t)break;if(0===n)break}var o=s<t?0:n+1;return e.substring(o).split("\n")}(this.buffer,this.line-e.line+2+1).slice(0,5),i=[];i.push(t+" at line "+e.line+" col "+e.col+":"),i.push("");for(var l=0;l<a.length;l++){var u=a[l],p=s+l;i.push(c(String(p),o)+"  "+u),p===e.line&&i.push(c("",o+e.col+1)+"^")}return i.join("\n")},y.prototype.clone=function(){return new y(this.states,this.state)},y.prototype.has=function(e){return!0},{compile:function(e){var t=f(p(e));return new y({start:t},"start")},states:function(e,t){var n=e.$all?p(e.$all):[];delete e.$all;var s=Object.getOwnPropertyNames(e);t||(t=s[0]);for(var r=Object.create(null),o=0;o<s.length;o++)r[$=s[o]]=p(e[$]).concat(n);for(o=0;o<s.length;o++)for(var a=r[$=s[o]],i=Object.create(null),l=0;l<a.length;l++){var c=a[l];if(c.include){var u=[l,1];if(c.include!==$&&!i[c.include]){i[c.include]=!0;var m=r[c.include];if(!m)throw new Error("Cannot include nonexistent state '"+c.include+"' (in state '"+$+"')");for(var b=0;b<m.length;b++){var d=m[b];-1===a.indexOf(d)&&u.push(d)}}a.splice.apply(a,u),l--}}var x=Object.create(null);for(o=0;o<s.length;o++){var $;x[$=s[o]]=f(r[$],!0)}for(o=0;o<s.length;o++){var g=s[o],v=x[g],E=v.groups;for(l=0;l<E.length;l++)h(E[l],g,x);var w=Object.getOwnPropertyNames(v.fast);for(l=0;l<w.length;l++)h(v.fast[w[l]],g,x)}return new y(x,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t="undefined"!=typeof Map,n=t?new Map:Object.create(null),s=Object.getOwnPropertyNames(e),r=0;r<s.length;r++){var o=s[r],a=e[o];(Array.isArray(a)?a:[a]).forEach(function(e){if("string"!=typeof e)throw new Error("keyword must be string (in keyword '"+o+"')");t?n.set(e,o):n[e]=o})}return function(e){return t?n.get(e):n[e]}}}},"function"==typeof define&&define.amd?define([],n):"object"==typeof e&&e.exports?e.exports=n():t.moo=n(),e.exports})(),f=function(){function e(t,n,s){return this.id=++e.highestId,this.name=t,this.symbols=n,this.postprocess=s,this}function t(e,t,n,s){this.rule=e,this.dot=t,this.reference=n,this.data=[],this.wantedBy=s,this.isComplete=this.dot===e.symbols.length}function n(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function s(e,t){this.rules=e,this.start=t||this.rules[0].name;var n=this.byName={};this.rules.forEach(function(e){n.hasOwnProperty(e.name)||(n[e.name]=[]),n[e.name].push(e)})}function r(){this.reset("")}function o(e,t,o){if(e instanceof s){var a=e;o=t}else a=s.fromCompiled(e,t);for(var i in this.grammar=a,this.options={keepHistory:!1,lexer:a.lexer||new r},o||{})this.options[i]=o[i];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new n(a,0);this.table=[l],l.wants[a.start]=[],l.predict(a.start),l.process(),this.current=0}function a(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(a).join(" "):this.symbols.slice(0,e).map(a).join(" ")+" ● "+this.symbols.slice(e).map(a).join(" ");return this.name+" → "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var n=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=e,n.isComplete&&(n.data=n.build(),n.right=void 0),n},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},n.prototype.process=function(e){for(var t=this.states,n=this.wants,s=this.completed,r=0;r<t.length;r++){var a=t[r];if(a.isComplete){if(a.finish(),a.data!==o.fail){for(var i=a.wantedBy,l=i.length;l--;){var c=i[l];this.complete(c,a)}if(a.reference===this.index){var u=a.rule.name;(this.completed[u]=this.completed[u]||[]).push(a)}}}else{if("string"!=typeof(u=a.rule.symbols[a.dot])){this.scannable.push(a);continue}if(n[u]){if(n[u].push(a),s.hasOwnProperty(u)){var p=s[u];for(l=0;l<p.length;l++){var m=p[l];this.complete(a,m)}}}else n[u]=[a],this.predict(u)}}},n.prototype.predict=function(e){for(var n=this.grammar.byName[e]||[],s=0;s<n.length;s++){var r=n[s],o=this.wants[e],a=new t(r,0,this.index,o);this.states.push(a)}},n.prototype.complete=function(e,t){var n=e.nextState(t);this.states.push(n)},s.fromCompiled=function(t,n){var r=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var o=new s(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),n);return o.lexer=r,o},r.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},r.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},r.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},r.prototype.formatError=function(e,t){var n=this.buffer;if("string"==typeof n){var s=n.split("\n").slice(Math.max(0,this.line-5),this.line),r=n.indexOf("\n",this.index);-1===r&&(r=n.length);var o=this.index-this.lastLineBreak,a=String(this.line).length;return t+=" at line "+this.line+" col "+o+":\n\n",t+=s.map(function(e,t){return i(this.line-s.length+t+1,a)+" "+e},this).join("\n"),t+="\n"+i("",a+o)+"^\n"}return t+" at index "+(this.index-1);function i(e,t){var n=String(e);return Array(t-n.length+1).join(" ")+n}},o.fail={},o.prototype.feed=function(e){var t,s=this.lexer;for(s.reset(e,this.lexerState);;){try{if(!(t=s.next()))break}catch(e){var o=new n(this.grammar,this.current+1);throw this.table.push(o),(l=new Error(this.reportLexerError(e))).offset=this.current,l.token=e.token,l}var a=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1;o=new n(this.grammar,i);this.table.push(o);for(var l,c=void 0!==t.text?t.text:t.value,u=s.constructor===r?t.value:t,p=a.scannable,m=p.length;m--;){var f=p[m],h=f.rule.symbols[f.dot];if(h.test?h.test(u):h.type?h.type===t.type:h.literal===c){var y=f.nextState({data:u,token:t,isToken:!0,reference:i-1});o.states.push(y)}}if(o.process(),0===o.states.length)throw(l=new Error(this.reportError(t))).offset=this.current,l.token=t,l;this.options.keepHistory&&(a.lexerState=s.save()),this.current++}return a&&(this.lexerState=s.save()),this.results=this.finish(),this},o.prototype.reportLexerError=function(e){var t,n,s=e.token;return s?(t="input "+JSON.stringify(s.text[0])+" (lexer error)",n=this.lexer.formatError(s,"Syntax error")):(t="input (lexer error)",n=e.message),this.reportErrorCommon(n,t)},o.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),n=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(n,t)},o.prototype.reportErrorCommon=function(e,t){var n=[];n.push(e);var s=this.table.length-2,r=this.table[s],o=r.states.filter(function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t});0===o.length?(n.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(r.states,n)):(n.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),o.map(function(e){return this.buildFirstStateStack(e,[])||[e]},this).forEach(function(e){var t=e[0],s=t.rule.symbols[t.dot],r=this.getSymbolDisplay(s);n.push("A "+r+" based on:"),this.displayStateStack(e,n)},this));return n.push(""),n.join("\n")},o.prototype.displayStateStack=function(e,t){for(var n,s=0,r=0;r<e.length;r++){var o=e[r],a=o.rule.toString(o.dot);a===n?s++:(s>0&&t.push("    ^ "+s+" more lines identical to this"),s=0,t.push("    "+a)),n=a}},o.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},o.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var n=e.wantedBy[0],s=[e].concat(t),r=this.buildFirstStateStack(n,s);return null===r?null:[e].concat(r)},o.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},o.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},o.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},o.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(n){n.rule.name===t&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==o.fail&&e.push(n)}),e.map(function(e){return e.data})},{Parser:o,Grammar:s,Rule:e}}();function h(e){return e[0]}const y=m.compile({WS:/[ \t\r]+/u,NL:{match:/\n/u,lineBreaks:!0},lineComment:/\/\/.*$/u,blockComment:{match:/\/\*[^]*?\*\//u,lineBreaks:!0},string:[{match:/"(?:[^"\\]|\\[^])*"/u,value:e=>e.slice(1,-1).replace(/\\(.)/g,(e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";case"r":return"\r";case"\\":return"\\";case'"':return'"';case"'":return"'";default:return t}})},{match:/'(?:[^'\\]|\\[^])*'/u,value:e=>e.slice(1,-1).replace(/\\(.)/g,(e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";case"r":return"\r";case"\\":return"\\";case'"':return'"';case"'":return"'";default:return t}})}],templateLiteral:{match:/`(?:[^`\\]|\\[^])*`/u,value:e=>e.slice(1,-1).replace(/\\(.)/g,(e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";case"r":return"\r";case"\\":return"\\";case"`":return"`";case"$":return"$";default:return t}})},regex:{match:/\/(?:\\[^]|[^\s\/])(?:[^\/\\\r\n]|\\[^])*\/[gimsuy]*/u,value:e=>{const t=e.lastIndexOf("/");return{pattern:e.slice(1,t),flags:e.slice(t+1)}}},number:{match:/(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/u,value:e=>parseFloat(e)},identifier:{match:/[\p{L}\p{Nl}$_][\p{L}\p{Mn}\p{Mc}\p{Nd}\p{Pc}$_]*/u,type:m.keywords({let:"let",const:"const",var:"var",if:"if",else:"else",for:"for",while:"while",do:"do",break:"break",continue:"continue",return:"return",function:"function",class:"class",extends:"extends",constructor:"constructor",async:"async",await:"await",import:"import",export:"export",from:"from",as:"as",try:"try",catch:"catch",finally:"finally",throw:"throw",true:"true",false:"false",null:"null",undefined:"undefined",this:"this",super:"super",new:"new",typeof:"typeof",instanceof:"instanceof",in:"in",of:"of"})},"+=":/\+=/u,"-=":/-=/u,"*=":/\*=/u,"/=":/\/=/u,"===":/===/u,"!==":/!==/u,"==":/==/u,"!=":/!=/u,"<=":/<=/u,">=":/>=/u,"<<":/<</u,">>":/>>/u,">>>":/>>>/u,"&&":/&&/u,"||":/\|\|/u,"??":/\?\?/u,"?.":/\?\./u,"...":/\.\.\./u,"++":/\+\+/u,"--":/--/u,"**":/\*\*/u,"=>":/=>/u,"=":/=/u,"<":/</u,">":/>/u,"+":/\+/u,"-":/-/u,"*":/\*/u,"/":/\//u,"%":/%/u,"&":/&/u,"|":/\|/u,"^":/\^/u,"~":/~/u,"!":/!/u,"?":/\?/u,":":/:/u,"(":/\(/u,")":/\)/u,"[":/\[/u,"]":/\]/u,"{":/\{/u,"}":/\}/u,",":/,/u,".":/\./u,";":/;/u});var b;function d(e,t={},n){const s={type:e,...t};if(n){const e=t=>{if(!t)return null;if(void 0!==t.line)return{line:t.line,col:t.col,offset:t.offset};if(Array.isArray(t))for(const n of t){const t=e(n);if(t)return t}return t.type&&void 0!==t.value&&void 0!==t.line?{line:t.line,col:t.col,offset:t.offset}:null},t=e(n);t&&(s.loc={start:{line:t.line,column:t.col},offset:t.offset})}return s}function x(e,t,n,s){return d("BinaryExpression",{operator:t,left:e,right:n},s)}function $(e,t){return d("Identifier",{name:e},t)}function g(e,t,n){return d("Literal",{value:e,raw:t},n)}y.next=(b=y.next,()=>{let e;for(;(e=b.call(y))&&("WS"===e.type||"lineComment"===e.type||"blockComment"===e.type););return e});var v={Lexer:y,ParserRules:[{name:"Program",symbols:["StatementList"],postprocess:e=>d("Program",{body:e[0]})},{name:"StatementList",symbols:[],postprocess:()=>[]},{name:"StatementList",symbols:["Statement"],postprocess:e=>[e[0]]},{name:"StatementList",symbols:["StatementList","StatementTerminator","Statement"],postprocess:e=>[...e[0],e[2]]},{name:"StatementList",symbols:["StatementList","StatementTerminator"],postprocess:e=>e[0]},{name:"StatementTerminator",symbols:[y.has("NL")?{type:"NL"}:NL],postprocess:h},{name:"StatementTerminator",symbols:[{literal:";"}],postprocess:h},{name:"Statement",symbols:["Declaration"],postprocess:h},{name:"Statement",symbols:["LabeledStatement"],postprocess:h},{name:"Statement",symbols:["ControlStatement"],postprocess:h},{name:"Statement",symbols:["ExpressionStatement"],postprocess:h},{name:"Statement",symbols:["Block"],postprocess:h},{name:"LabeledStatement",symbols:[y.has("identifier")?{type:"identifier"}:identifier,{literal:":"},"LoopStatement"],postprocess:e=>d("LabeledStatement",{label:$(e[0].value),body:e[2]})},{name:"LoopStatement",symbols:["WhileStatement"],postprocess:h},{name:"LoopStatement",symbols:["DoWhileStatement"],postprocess:h},{name:"LoopStatement",symbols:["ForStatement"],postprocess:h},{name:"Declaration",symbols:["VariableDeclaration"],postprocess:h},{name:"Declaration",symbols:["FunctionDeclaration"],postprocess:h},{name:"Declaration",symbols:["ClassDeclaration"],postprocess:h},{name:"Declaration",symbols:["ImportDeclaration"],postprocess:h},{name:"Declaration",symbols:["ExportDeclaration"],postprocess:h},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"let"}]},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"const"}]},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"var"}]},{name:"VariableDeclaration",symbols:["VariableDeclaration$subexpression$1","VariableDeclaratorList"],postprocess:e=>d("VariableDeclaration",{kind:e[0][0].value,declarations:e[1]})},{name:"VariableDeclaratorList",symbols:["VariableDeclarator"],postprocess:e=>[e[0]]},{name:"VariableDeclaratorList",symbols:["VariableDeclaratorList",{literal:","},"VariableDeclarator"],postprocess:e=>[...e[0],e[2]]},{name:"VariableDeclarator$ebnf$1$subexpression$1",symbols:[{literal:"="},"AssignmentExpression"]},{name:"VariableDeclarator$ebnf$1",symbols:["VariableDeclarator$ebnf$1$subexpression$1"],postprocess:h},{name:"VariableDeclarator$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"VariableDeclarator",symbols:["BindingPattern","VariableDeclarator$ebnf$1"],postprocess:e=>d("VariableDeclarator",{id:e[0],init:e[1]?e[1][1]:null})},{name:"BindingPattern",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>$(e[0].value,e[0])},{name:"BindingPattern",symbols:["ArrayPattern"],postprocess:h},{name:"BindingPattern",symbols:["ObjectPattern"],postprocess:h},{name:"ArrayPattern",symbols:[{literal:"["},"ArrayPatternElementList",{literal:"]"}],postprocess:e=>d("ArrayPattern",{elements:e[1]})},{name:"ArrayPatternElementList",symbols:[],postprocess:()=>[]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElement"],postprocess:e=>[e[0]]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElementList",{literal:","},"ArrayPatternElement"],postprocess:e=>[...e[0],e[2]]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElementList",{literal:","}],postprocess:e=>[...e[0],null]},{name:"ArrayPatternElement",symbols:["BindingPattern"],postprocess:h},{name:"ArrayPatternElement",symbols:[{literal:"..."},"BindingPattern"],postprocess:e=>d("RestElement",{argument:e[1]})},{name:"ObjectPattern",symbols:[{literal:"{"},"ObjectPatternPropertyList",{literal:"}"}],postprocess:e=>d("ObjectPattern",{properties:e[1]})},{name:"ObjectPatternPropertyList",symbols:[],postprocess:()=>[]},{name:"ObjectPatternPropertyList",symbols:["ObjectPatternProperty"],postprocess:e=>[e[0]]},{name:"ObjectPatternPropertyList",symbols:["ObjectPatternPropertyList",{literal:","},"ObjectPatternProperty"],postprocess:e=>[...e[0],e[2]]},{name:"ObjectPatternProperty",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>d("Property",{key:$(e[0].value),value:$(e[0].value),shorthand:!0})},{name:"ObjectPatternProperty",symbols:["PropertyKey",{literal:":"},"BindingPattern"],postprocess:e=>d("Property",{key:e[0],value:e[2],shorthand:!1})},{name:"FunctionDeclaration$ebnf$1",symbols:[{literal:"async"}],postprocess:h},{name:"FunctionDeclaration$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"FunctionDeclaration$ebnf$2",symbols:[]},{name:"FunctionDeclaration$ebnf$2",symbols:["FunctionDeclaration$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionDeclaration$ebnf$3",symbols:[]},{name:"FunctionDeclaration$ebnf$3",symbols:["FunctionDeclaration$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionDeclaration",symbols:["FunctionDeclaration$ebnf$1",{literal:"function"},y.has("identifier")?{type:"identifier"}:identifier,{literal:"("},"FunctionDeclaration$ebnf$2","ParameterList","FunctionDeclaration$ebnf$3",{literal:")"},"Block"],postprocess:e=>d("FunctionDeclaration",{async:!!e[0],id:$(e[2].value),params:e[5],body:e[8]})},{name:"ParameterList",symbols:[],postprocess:()=>[]},{name:"ParameterList",symbols:["Parameter"],postprocess:e=>[e[0]]},{name:"ParameterList$ebnf$1",symbols:[]},{name:"ParameterList$ebnf$1",symbols:["ParameterList$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ParameterList$ebnf$2",symbols:[]},{name:"ParameterList$ebnf$2",symbols:["ParameterList$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ParameterList",symbols:["ParameterList","ParameterList$ebnf$1",{literal:","},"ParameterList$ebnf$2","Parameter"],postprocess:e=>[...e[0],e[4]]},{name:"Parameter",symbols:["BindingPattern"],postprocess:h},{name:"Parameter",symbols:["BindingPattern",{literal:"="},"AssignmentExpression"],postprocess:e=>d("AssignmentPattern",{left:e[0],right:e[2]})},{name:"Parameter",symbols:[{literal:"..."},"BindingPattern"],postprocess:e=>d("RestElement",{argument:e[1]})},{name:"ClassDeclaration$ebnf$1$subexpression$1",symbols:[{literal:"extends"},y.has("identifier")?{type:"identifier"}:identifier]},{name:"ClassDeclaration$ebnf$1",symbols:["ClassDeclaration$ebnf$1$subexpression$1"],postprocess:h},{name:"ClassDeclaration$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ClassDeclaration",symbols:[{literal:"class"},y.has("identifier")?{type:"identifier"}:identifier,"ClassDeclaration$ebnf$1","ClassBody"],postprocess:e=>d("ClassDeclaration",{id:$(e[1].value),superClass:e[2]?$(e[2][1].value):null,body:e[3]})},{name:"ClassBody",symbols:[{literal:"{"},"ClassMemberListWithNewlines",{literal:"}"}],postprocess:e=>d("ClassBody",{body:e[1]})},{name:"ClassMemberListWithNewlines$ebnf$1",symbols:[]},{name:"ClassMemberListWithNewlines$ebnf$1",symbols:["ClassMemberListWithNewlines$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberListWithNewlines$ebnf$2",symbols:["ClassMemberNonEmpty"],postprocess:h},{name:"ClassMemberListWithNewlines$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"ClassMemberListWithNewlines$ebnf$3",symbols:[]},{name:"ClassMemberListWithNewlines$ebnf$3",symbols:["ClassMemberListWithNewlines$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberListWithNewlines",symbols:["ClassMemberListWithNewlines$ebnf$1","ClassMemberListWithNewlines$ebnf$2","ClassMemberListWithNewlines$ebnf$3"],postprocess:e=>e[1]?e[1]:[]},{name:"ClassMemberNonEmpty",symbols:["ClassMember"],postprocess:e=>[e[0]]},{name:"ClassMemberNonEmpty$ebnf$1",symbols:[y.has("NL")?{type:"NL"}:NL]},{name:"ClassMemberNonEmpty$ebnf$1",symbols:["ClassMemberNonEmpty$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberNonEmpty",symbols:["ClassMember","ClassMemberNonEmpty$ebnf$1","ClassMemberNonEmpty"],postprocess:e=>[e[0],...e[2]]},{name:"ClassMember",symbols:["MethodDefinition"],postprocess:h},{name:"ClassMember",symbols:["PropertyDefinition"],postprocess:h},{name:"MethodDefinition$ebnf$1",symbols:[{literal:"async"}],postprocess:h},{name:"MethodDefinition$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"MethodDefinition$ebnf$2",symbols:[]},{name:"MethodDefinition$ebnf$2",symbols:["MethodDefinition$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MethodDefinition$ebnf$3",symbols:[]},{name:"MethodDefinition$ebnf$3",symbols:["MethodDefinition$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MethodDefinition",symbols:["MethodDefinition$ebnf$1","PropertyKey",{literal:"("},"MethodDefinition$ebnf$2","ParameterList","MethodDefinition$ebnf$3",{literal:")"},"Block"],postprocess:e=>d("MethodDefinition",{async:!!e[0],kind:"method",key:e[1],params:e[4],body:e[7]})},{name:"MethodDefinition$ebnf$4",symbols:[]},{name:"MethodDefinition$ebnf$4",symbols:["MethodDefinition$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MethodDefinition$ebnf$5",symbols:[]},{name:"MethodDefinition$ebnf$5",symbols:["MethodDefinition$ebnf$5",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MethodDefinition",symbols:[{literal:"constructor"},{literal:"("},"MethodDefinition$ebnf$4","ParameterList","MethodDefinition$ebnf$5",{literal:")"},"Block"],postprocess:e=>d("MethodDefinition",{kind:"constructor",key:$("constructor"),params:e[3],body:e[6]})},{name:"PropertyDefinition",symbols:["PropertyKey",{literal:"="},"AssignmentExpression"],postprocess:e=>d("PropertyDefinition",{key:e[0],value:e[2]})},{name:"ImportDeclaration",symbols:[{literal:"import"},{literal:"{"},"ImportsList",{literal:"}"},{literal:"from"},y.has("string")?{type:"string"}:string],postprocess:e=>d("ImportDeclaration",{specifiers:e[2],source:g(e[5].value,e[5].text)})},{name:"ImportsList",symbols:[],postprocess:()=>[]},{name:"ImportsList",symbols:["ImportSpecifier"],postprocess:e=>[e[0]]},{name:"ImportsList",symbols:["ImportsList",{literal:","},"ImportSpecifier"],postprocess:e=>[...e[0],e[2]]},{name:"ImportSpecifier$ebnf$1$subexpression$1",symbols:[{literal:"as"},y.has("identifier")?{type:"identifier"}:identifier]},{name:"ImportSpecifier$ebnf$1",symbols:["ImportSpecifier$ebnf$1$subexpression$1"],postprocess:h},{name:"ImportSpecifier$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ImportSpecifier",symbols:[y.has("identifier")?{type:"identifier"}:identifier,"ImportSpecifier$ebnf$1"],postprocess:e=>d("ImportSpecifier",{imported:$(e[0].value),local:$(e[1]?e[1][1].value:e[0].value)})},{name:"ExportDeclaration",symbols:[{literal:"export"},"Declaration"],postprocess:e=>d("ExportNamedDeclaration",{declaration:e[1]})},{name:"ExportDeclaration",symbols:[{literal:"export"},{literal:"{"},"ExportsList",{literal:"}"}],postprocess:e=>d("ExportNamedDeclaration",{specifiers:e[2],source:null})},{name:"ExportsList",symbols:[],postprocess:()=>[]},{name:"ExportsList",symbols:["ExportSpecifier"],postprocess:e=>[e[0]]},{name:"ExportsList",symbols:["ExportsList",{literal:","},"ExportSpecifier"],postprocess:e=>[...e[0],e[2]]},{name:"ExportSpecifier$ebnf$1$subexpression$1",symbols:[{literal:"as"},y.has("identifier")?{type:"identifier"}:identifier]},{name:"ExportSpecifier$ebnf$1",symbols:["ExportSpecifier$ebnf$1$subexpression$1"],postprocess:h},{name:"ExportSpecifier$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ExportSpecifier",symbols:[y.has("identifier")?{type:"identifier"}:identifier,"ExportSpecifier$ebnf$1"],postprocess:e=>d("ExportSpecifier",{local:$(e[0].value),exported:$(e[1]?e[1][1].value:e[0].value)})},{name:"ControlStatement",symbols:["IfStatement"],postprocess:h},{name:"ControlStatement",symbols:["WhileStatement"],postprocess:h},{name:"ControlStatement",symbols:["DoWhileStatement"],postprocess:h},{name:"ControlStatement",symbols:["ForStatement"],postprocess:h},{name:"ControlStatement",symbols:["TryStatement"],postprocess:h},{name:"ControlStatement",symbols:["ThrowStatement"],postprocess:h},{name:"ControlStatement",symbols:["ReturnStatement"],postprocess:h},{name:"ControlStatement",symbols:["BreakStatement"],postprocess:h},{name:"ControlStatement",symbols:["ContinueStatement"],postprocess:h},{name:"IfStatement$ebnf$1",symbols:[]},{name:"IfStatement$ebnf$1",symbols:["IfStatement$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"IfStatement$ebnf$2",symbols:[]},{name:"IfStatement$ebnf$2",symbols:["IfStatement$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"IfStatement$ebnf$3$subexpression$1$ebnf$1",symbols:["StatementTerminator"],postprocess:h},{name:"IfStatement$ebnf$3$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"IfStatement$ebnf$3$subexpression$1$ebnf$2",symbols:[]},{name:"IfStatement$ebnf$3$subexpression$1$ebnf$2",symbols:["IfStatement$ebnf$3$subexpression$1$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"IfStatement$ebnf$3$subexpression$1",symbols:["IfStatement$ebnf$3$subexpression$1$ebnf$1","IfStatement$ebnf$3$subexpression$1$ebnf$2",{literal:"else"},"Statement"]},{name:"IfStatement$ebnf$3",symbols:["IfStatement$ebnf$3$subexpression$1"],postprocess:h},{name:"IfStatement$ebnf$3",symbols:[],postprocess:function(e){return null}},{name:"IfStatement",symbols:[{literal:"if"},{literal:"("},"IfStatement$ebnf$1","Expression","IfStatement$ebnf$2",{literal:")"},"Statement","IfStatement$ebnf$3"],postprocess:e=>d("IfStatement",{test:e[3],consequent:e[6],alternate:e[7]?e[7][3]:null})},{name:"WhileStatement$ebnf$1",symbols:[]},{name:"WhileStatement$ebnf$1",symbols:["WhileStatement$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"WhileStatement$ebnf$2",symbols:[]},{name:"WhileStatement$ebnf$2",symbols:["WhileStatement$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"WhileStatement",symbols:[{literal:"while"},{literal:"("},"WhileStatement$ebnf$1","Expression","WhileStatement$ebnf$2",{literal:")"},"Statement"],postprocess:e=>d("WhileStatement",{test:e[3],body:e[6]})},{name:"DoWhileStatement$ebnf$1",symbols:[]},{name:"DoWhileStatement$ebnf$1",symbols:["DoWhileStatement$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"DoWhileStatement$ebnf$2",symbols:[]},{name:"DoWhileStatement$ebnf$2",symbols:["DoWhileStatement$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"DoWhileStatement",symbols:[{literal:"do"},"Statement",{literal:"while"},{literal:"("},"DoWhileStatement$ebnf$1","Expression","DoWhileStatement$ebnf$2",{literal:")"}],postprocess:e=>d("DoWhileStatement",{body:e[1],test:e[5]})},{name:"ForStatement$ebnf$1",symbols:[]},{name:"ForStatement$ebnf$1",symbols:["ForStatement$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$subexpression$1",symbols:["VariableDeclaration"]},{name:"ForStatement$subexpression$1",symbols:["Expression"]},{name:"ForStatement$subexpression$1",symbols:[]},{name:"ForStatement$ebnf$2",symbols:[]},{name:"ForStatement$ebnf$2",symbols:["ForStatement$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$3",symbols:[]},{name:"ForStatement$ebnf$3",symbols:["ForStatement$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$subexpression$2",symbols:["Expression"]},{name:"ForStatement$subexpression$2",symbols:[]},{name:"ForStatement$ebnf$4",symbols:[]},{name:"ForStatement$ebnf$4",symbols:["ForStatement$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$5",symbols:[]},{name:"ForStatement$ebnf$5",symbols:["ForStatement$ebnf$5",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$subexpression$3",symbols:["Expression"]},{name:"ForStatement$subexpression$3",symbols:[]},{name:"ForStatement$ebnf$6",symbols:[]},{name:"ForStatement$ebnf$6",symbols:["ForStatement$ebnf$6",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement",symbols:[{literal:"for"},{literal:"("},"ForStatement$ebnf$1","ForStatement$subexpression$1","ForStatement$ebnf$2",{literal:";"},"ForStatement$ebnf$3","ForStatement$subexpression$2","ForStatement$ebnf$4",{literal:";"},"ForStatement$ebnf$5","ForStatement$subexpression$3","ForStatement$ebnf$6",{literal:")"},"Statement"],postprocess:e=>d("ForStatement",{init:e[3]?e[3][0]:null,test:e[7]?e[7][0]:null,update:e[11]?e[11][0]:null,body:e[14]})},{name:"ForStatement$ebnf$7",symbols:[]},{name:"ForStatement$ebnf$7",symbols:["ForStatement$ebnf$7",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$subexpression$4",symbols:[{literal:"let"}]},{name:"ForStatement$subexpression$4",symbols:[{literal:"const"}]},{name:"ForStatement$subexpression$4",symbols:[{literal:"var"}]},{name:"ForStatement$ebnf$8",symbols:[]},{name:"ForStatement$ebnf$8",symbols:["ForStatement$ebnf$8",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$9",symbols:[]},{name:"ForStatement$ebnf$9",symbols:["ForStatement$ebnf$9",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$10",symbols:[]},{name:"ForStatement$ebnf$10",symbols:["ForStatement$ebnf$10",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement",symbols:[{literal:"for"},{literal:"("},"ForStatement$ebnf$7","ForStatement$subexpression$4","BindingPattern","ForStatement$ebnf$8",{literal:"of"},"ForStatement$ebnf$9","Expression","ForStatement$ebnf$10",{literal:")"},"Statement"],postprocess:e=>d("ForOfStatement",{left:d("VariableDeclaration",{kind:e[3][0].value,declarations:[d("VariableDeclarator",{id:e[4],init:null})]}),right:e[8],body:e[11]})},{name:"ForStatement$ebnf$11",symbols:[]},{name:"ForStatement$ebnf$11",symbols:["ForStatement$ebnf$11",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$subexpression$5",symbols:[{literal:"let"}]},{name:"ForStatement$subexpression$5",symbols:[{literal:"const"}]},{name:"ForStatement$subexpression$5",symbols:[{literal:"var"}]},{name:"ForStatement$ebnf$12",symbols:[]},{name:"ForStatement$ebnf$12",symbols:["ForStatement$ebnf$12",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$13",symbols:[]},{name:"ForStatement$ebnf$13",symbols:["ForStatement$ebnf$13",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement$ebnf$14",symbols:[]},{name:"ForStatement$ebnf$14",symbols:["ForStatement$ebnf$14",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ForStatement",symbols:[{literal:"for"},{literal:"("},"ForStatement$ebnf$11","ForStatement$subexpression$5","BindingPattern","ForStatement$ebnf$12",{literal:"in"},"ForStatement$ebnf$13","Expression","ForStatement$ebnf$14",{literal:")"},"Statement"],postprocess:e=>d("ForInStatement",{left:d("VariableDeclaration",{kind:e[3][0].value,declarations:[d("VariableDeclarator",{id:e[4],init:null})]}),right:e[8],body:e[11]})},{name:"TryStatement",symbols:[{literal:"try"},"Block","CatchFinally"],postprocess:e=>d("TryStatement",{block:e[1],handler:e[2].handler,finalizer:e[2].finalizer})},{name:"CatchFinally$ebnf$1$subexpression$1",symbols:[{literal:"("},"BindingPattern",{literal:")"}]},{name:"CatchFinally$ebnf$1",symbols:["CatchFinally$ebnf$1$subexpression$1"],postprocess:h},{name:"CatchFinally$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"CatchFinally$ebnf$2$subexpression$1",symbols:[{literal:"finally"},"Block"]},{name:"CatchFinally$ebnf$2",symbols:["CatchFinally$ebnf$2$subexpression$1"],postprocess:h},{name:"CatchFinally$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"CatchFinally",symbols:[{literal:"catch"},"CatchFinally$ebnf$1","Block","CatchFinally$ebnf$2"],postprocess:e=>({handler:d("CatchClause",{param:e[1]?e[1][1]:null,body:e[2]}),finalizer:e[3]?e[3][1]:null})},{name:"CatchFinally",symbols:[{literal:"finally"},"Block"],postprocess:e=>({handler:null,finalizer:e[1]})},{name:"ThrowStatement",symbols:[{literal:"throw"},"Expression"],postprocess:e=>d("ThrowStatement",{argument:e[1]})},{name:"ReturnStatement$ebnf$1",symbols:["Expression"],postprocess:h},{name:"ReturnStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ReturnStatement",symbols:[{literal:"return"},"ReturnStatement$ebnf$1"],postprocess:e=>d("ReturnStatement",{argument:e[1]})},{name:"BreakStatement$ebnf$1",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:h},{name:"BreakStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"BreakStatement",symbols:[{literal:"break"},"BreakStatement$ebnf$1"],postprocess:e=>d("BreakStatement",{label:e[1]?$(e[1].value):null})},{name:"ContinueStatement$ebnf$1",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:h},{name:"ContinueStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ContinueStatement",symbols:[{literal:"continue"},"ContinueStatement$ebnf$1"],postprocess:e=>d("ContinueStatement",{label:e[1]?$(e[1].value):null})},{name:"ExpressionStatement",symbols:["Expression"],postprocess:e=>d("ExpressionStatement",{expression:e[0]})},{name:"Expression",symbols:["AssignmentExpression"],postprocess:h},{name:"AssignmentExpression",symbols:["ConditionalExpression"],postprocess:h},{name:"AssignmentExpression",symbols:["ArrowFunction"],postprocess:h},{name:"AssignmentExpression",symbols:["LeftHandSideExpression","AssignmentOperator","AssignmentExpression"],postprocess:e=>d("AssignmentExpression",{operator:e[1],left:e[0],right:e[2]})},{name:"AssignmentOperator",symbols:[{literal:"="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"+="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"-="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"*="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"/="}],postprocess:e=>e[0].value},{name:"ArrowFunction",symbols:["ArrowParameters",{literal:"=>"},"ArrowBody"],postprocess:e=>d("ArrowFunctionExpression",{async:!1,params:e[0],body:e[2]})},{name:"ArrowFunction",symbols:[{literal:"async"},"ArrowParameters",{literal:"=>"},"ArrowBody"],postprocess:e=>d("ArrowFunctionExpression",{async:!0,params:e[1],body:e[3]})},{name:"ArrowParameters",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>[$(e[0].value,e[0])]},{name:"ArrowParameters$ebnf$1",symbols:[]},{name:"ArrowParameters$ebnf$1",symbols:["ArrowParameters$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrowParameters$ebnf$2",symbols:[]},{name:"ArrowParameters$ebnf$2",symbols:["ArrowParameters$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrowParameters",symbols:[{literal:"("},"ArrowParameters$ebnf$1","ParameterList","ArrowParameters$ebnf$2",{literal:")"}],postprocess:e=>e[2]},{name:"ArrowBody",symbols:["Block"],postprocess:h},{name:"ArrowBody",symbols:["AssignmentExpression"],postprocess:h},{name:"ConditionalExpression",symbols:["LogicalOrExpression"],postprocess:h},{name:"ConditionalExpression$ebnf$1",symbols:[]},{name:"ConditionalExpression$ebnf$1",symbols:["ConditionalExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConditionalExpression$ebnf$2",symbols:[]},{name:"ConditionalExpression$ebnf$2",symbols:["ConditionalExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConditionalExpression$ebnf$3",symbols:[]},{name:"ConditionalExpression$ebnf$3",symbols:["ConditionalExpression$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConditionalExpression$ebnf$4",symbols:[]},{name:"ConditionalExpression$ebnf$4",symbols:["ConditionalExpression$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConditionalExpression",symbols:["LogicalOrExpression","ConditionalExpression$ebnf$1",{literal:"?"},"ConditionalExpression$ebnf$2","AssignmentExpression","ConditionalExpression$ebnf$3",{literal:":"},"ConditionalExpression$ebnf$4","AssignmentExpression"],postprocess:e=>d("ConditionalExpression",{test:e[0],consequent:e[4],alternate:e[8]})},{name:"LogicalOrExpression",symbols:["LogicalAndExpression"],postprocess:h},{name:"LogicalOrExpression$ebnf$1",symbols:[]},{name:"LogicalOrExpression$ebnf$1",symbols:["LogicalOrExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"LogicalOrExpression$subexpression$1",symbols:[{literal:"||"}]},{name:"LogicalOrExpression$subexpression$1",symbols:[{literal:"??"}]},{name:"LogicalOrExpression$ebnf$2",symbols:[]},{name:"LogicalOrExpression$ebnf$2",symbols:["LogicalOrExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"LogicalOrExpression",symbols:["LogicalOrExpression","LogicalOrExpression$ebnf$1","LogicalOrExpression$subexpression$1","LogicalOrExpression$ebnf$2","LogicalAndExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"LogicalAndExpression",symbols:["EqualityExpression"],postprocess:h},{name:"LogicalAndExpression$ebnf$1",symbols:[]},{name:"LogicalAndExpression$ebnf$1",symbols:["LogicalAndExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"LogicalAndExpression$ebnf$2",symbols:[]},{name:"LogicalAndExpression$ebnf$2",symbols:["LogicalAndExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"LogicalAndExpression",symbols:["LogicalAndExpression","LogicalAndExpression$ebnf$1",{literal:"&&"},"LogicalAndExpression$ebnf$2","EqualityExpression"],postprocess:e=>x(e[0],e[2].value,e[4])},{name:"EqualityExpression",symbols:["RelationalExpression"],postprocess:h},{name:"EqualityExpression$ebnf$1",symbols:[]},{name:"EqualityExpression$ebnf$1",symbols:["EqualityExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"=="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"!="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"==="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"!=="}]},{name:"EqualityExpression$ebnf$2",symbols:[]},{name:"EqualityExpression$ebnf$2",symbols:["EqualityExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"EqualityExpression",symbols:["EqualityExpression","EqualityExpression$ebnf$1","EqualityExpression$subexpression$1","EqualityExpression$ebnf$2","RelationalExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"RelationalExpression",symbols:["AdditiveExpression"],postprocess:h},{name:"RelationalExpression$ebnf$1",symbols:[]},{name:"RelationalExpression$ebnf$1",symbols:["RelationalExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"RelationalExpression$subexpression$1",symbols:[{literal:"<"}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:">"}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:"<="}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:">="}]},{name:"RelationalExpression$ebnf$2",symbols:[]},{name:"RelationalExpression$ebnf$2",symbols:["RelationalExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"RelationalExpression",symbols:["RelationalExpression","RelationalExpression$ebnf$1","RelationalExpression$subexpression$1","RelationalExpression$ebnf$2","AdditiveExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"RelationalExpression$ebnf$3",symbols:[]},{name:"RelationalExpression$ebnf$3",symbols:["RelationalExpression$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"RelationalExpression$subexpression$2",symbols:[{literal:"instanceof"}]},{name:"RelationalExpression$subexpression$2",symbols:[{literal:"in"}]},{name:"RelationalExpression$ebnf$4",symbols:[]},{name:"RelationalExpression$ebnf$4",symbols:["RelationalExpression$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"RelationalExpression",symbols:["RelationalExpression","RelationalExpression$ebnf$3","RelationalExpression$subexpression$2","RelationalExpression$ebnf$4","AdditiveExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"AdditiveExpression",symbols:["MultiplicativeExpression"],postprocess:h},{name:"AdditiveExpression$ebnf$1",symbols:[]},{name:"AdditiveExpression$ebnf$1",symbols:["AdditiveExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"AdditiveExpression$subexpression$1",symbols:[{literal:"+"}]},{name:"AdditiveExpression$subexpression$1",symbols:[{literal:"-"}]},{name:"AdditiveExpression$ebnf$2",symbols:[]},{name:"AdditiveExpression$ebnf$2",symbols:["AdditiveExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"AdditiveExpression",symbols:["AdditiveExpression","AdditiveExpression$ebnf$1","AdditiveExpression$subexpression$1","AdditiveExpression$ebnf$2","MultiplicativeExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"MultiplicativeExpression",symbols:["ExponentiationExpression"],postprocess:h},{name:"MultiplicativeExpression$ebnf$1",symbols:[]},{name:"MultiplicativeExpression$ebnf$1",symbols:["MultiplicativeExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"*"}]},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"/"}]},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"%"}]},{name:"MultiplicativeExpression$ebnf$2",symbols:[]},{name:"MultiplicativeExpression$ebnf$2",symbols:["MultiplicativeExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MultiplicativeExpression",symbols:["MultiplicativeExpression","MultiplicativeExpression$ebnf$1","MultiplicativeExpression$subexpression$1","MultiplicativeExpression$ebnf$2","ExponentiationExpression"],postprocess:e=>x(e[0],e[2][0].value,e[4])},{name:"ExponentiationExpression",symbols:["UnaryExpression"],postprocess:h},{name:"ExponentiationExpression$ebnf$1",symbols:[]},{name:"ExponentiationExpression$ebnf$1",symbols:["ExponentiationExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ExponentiationExpression$ebnf$2",symbols:[]},{name:"ExponentiationExpression$ebnf$2",symbols:["ExponentiationExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ExponentiationExpression",symbols:["UnaryExpression","ExponentiationExpression$ebnf$1",{literal:"**"},"ExponentiationExpression$ebnf$2","ExponentiationExpression"],postprocess:e=>x(e[0],e[2].value,e[4])},{name:"UnaryExpression",symbols:["PostfixExpression"],postprocess:h},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"!"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"+"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"-"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"~"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"typeof"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"await"}]},{name:"UnaryExpression",symbols:["UnaryExpression$subexpression$1","UnaryExpression"],postprocess:e=>function(e,t,n=!0,s){return d("UnaryExpression",{operator:e,argument:t,prefix:n},s)}(e[0][0].value,e[1])},{name:"UnaryExpression$subexpression$2",symbols:[{literal:"++"}]},{name:"UnaryExpression$subexpression$2",symbols:[{literal:"--"}]},{name:"UnaryExpression",symbols:["UnaryExpression$subexpression$2","UnaryExpression"],postprocess:e=>d("UpdateExpression",{operator:e[0][0].value,argument:e[1],prefix:!0})},{name:"PostfixExpression",symbols:["LeftHandSideExpression"],postprocess:h},{name:"PostfixExpression$subexpression$1",symbols:[{literal:"++"}]},{name:"PostfixExpression$subexpression$1",symbols:[{literal:"--"}]},{name:"PostfixExpression",symbols:["LeftHandSideExpression","PostfixExpression$subexpression$1"],postprocess:e=>d("UpdateExpression",{operator:e[1][0].value,argument:e[0],prefix:!1})},{name:"LeftHandSideExpression",symbols:["CallExpression"],postprocess:h},{name:"LeftHandSideExpression",symbols:["NewExpression"],postprocess:h},{name:"CallExpression",symbols:["MemberExpression","Arguments"],postprocess:e=>d("CallExpression",{callee:e[0],arguments:e[1]})},{name:"CallExpression",symbols:[{literal:"new"},"MemberExpression","Arguments"],postprocess:e=>d("NewExpression",{callee:e[1],arguments:e[2]})},{name:"CallExpression",symbols:["CallExpression","Arguments"],postprocess:e=>d("CallExpression",{callee:e[0],arguments:e[1]})},{name:"CallExpression",symbols:["CallExpression",{literal:"["},"Expression",{literal:"]"}],postprocess:e=>d("MemberExpression",{object:e[0],property:e[2],computed:!0})},{name:"CallExpression$ebnf$1",symbols:[]},{name:"CallExpression$ebnf$1",symbols:["CallExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"CallExpression",symbols:["CallExpression","CallExpression$ebnf$1",{literal:"."},"PropertyName"],postprocess:e=>d("MemberExpression",{object:e[0],property:$(e[3].value),computed:!1})},{name:"CallExpression$ebnf$2",symbols:[]},{name:"CallExpression$ebnf$2",symbols:["CallExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"CallExpression",symbols:["CallExpression","CallExpression$ebnf$2",{literal:"?."},"OptionalMemberAccess"],postprocess:e=>d("MemberExpression",{object:e[0],property:e[3].property,computed:e[3].computed,optional:!0})},{name:"NewExpression",symbols:[{literal:"new"},"MemberExpression"],postprocess:e=>d("NewExpression",{callee:e[1],arguments:[]})},{name:"NewExpression",symbols:["MemberExpression"],postprocess:h},{name:"MemberExpression",symbols:["PrimaryExpression"],postprocess:h},{name:"MemberExpression",symbols:["MemberExpression",{literal:"["},"Expression",{literal:"]"}],postprocess:e=>d("MemberExpression",{object:e[0],property:e[2],computed:!0})},{name:"MemberExpression$ebnf$1",symbols:[]},{name:"MemberExpression$ebnf$1",symbols:["MemberExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MemberExpression",symbols:["MemberExpression","MemberExpression$ebnf$1",{literal:"."},"PropertyName"],postprocess:e=>d("MemberExpression",{object:e[0],property:$(e[3].value),computed:!1})},{name:"MemberExpression$ebnf$2",symbols:[]},{name:"MemberExpression$ebnf$2",symbols:["MemberExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MemberExpression",symbols:["MemberExpression","MemberExpression$ebnf$2",{literal:"?."},"OptionalMemberAccess"],postprocess:e=>d("MemberExpression",{object:e[0],property:e[3].property,computed:e[3].computed,optional:!0})},{name:"OptionalMemberAccess",symbols:["PropertyName"],postprocess:e=>({property:$(e[0].value),computed:!1})},{name:"OptionalMemberAccess",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>({property:e[1],computed:!0})},{name:"PropertyName",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>e[0]},{name:"PropertyName",symbols:["ReservedKeyword"],postprocess:e=>e[0]},{name:"ReservedKeyword",symbols:[{literal:"let"}],postprocess:e=>({value:"let"})},{name:"ReservedKeyword",symbols:[{literal:"const"}],postprocess:e=>({value:"const"})},{name:"ReservedKeyword",symbols:[{literal:"var"}],postprocess:e=>({value:"var"})},{name:"ReservedKeyword",symbols:[{literal:"if"}],postprocess:e=>({value:"if"})},{name:"ReservedKeyword",symbols:[{literal:"else"}],postprocess:e=>({value:"else"})},{name:"ReservedKeyword",symbols:[{literal:"for"}],postprocess:e=>({value:"for"})},{name:"ReservedKeyword",symbols:[{literal:"while"}],postprocess:e=>({value:"while"})},{name:"ReservedKeyword",symbols:[{literal:"do"}],postprocess:e=>({value:"do"})},{name:"ReservedKeyword",symbols:[{literal:"break"}],postprocess:e=>({value:"break"})},{name:"ReservedKeyword",symbols:[{literal:"continue"}],postprocess:e=>({value:"continue"})},{name:"ReservedKeyword",symbols:[{literal:"return"}],postprocess:e=>({value:"return"})},{name:"ReservedKeyword",symbols:[{literal:"function"}],postprocess:e=>({value:"function"})},{name:"ReservedKeyword",symbols:[{literal:"class"}],postprocess:e=>({value:"class"})},{name:"ReservedKeyword",symbols:[{literal:"extends"}],postprocess:e=>({value:"extends"})},{name:"ReservedKeyword",symbols:[{literal:"constructor"}],postprocess:e=>({value:"constructor"})},{name:"ReservedKeyword",symbols:[{literal:"async"}],postprocess:e=>({value:"async"})},{name:"ReservedKeyword",symbols:[{literal:"await"}],postprocess:e=>({value:"await"})},{name:"ReservedKeyword",symbols:[{literal:"import"}],postprocess:e=>({value:"import"})},{name:"ReservedKeyword",symbols:[{literal:"export"}],postprocess:e=>({value:"export"})},{name:"ReservedKeyword",symbols:[{literal:"from"}],postprocess:e=>({value:"from"})},{name:"ReservedKeyword",symbols:[{literal:"as"}],postprocess:e=>({value:"as"})},{name:"ReservedKeyword",symbols:[{literal:"try"}],postprocess:e=>({value:"try"})},{name:"ReservedKeyword",symbols:[{literal:"catch"}],postprocess:e=>({value:"catch"})},{name:"ReservedKeyword",symbols:[{literal:"finally"}],postprocess:e=>({value:"finally"})},{name:"ReservedKeyword",symbols:[{literal:"throw"}],postprocess:e=>({value:"throw"})},{name:"ReservedKeyword",symbols:[{literal:"true"}],postprocess:e=>({value:"true"})},{name:"ReservedKeyword",symbols:[{literal:"false"}],postprocess:e=>({value:"false"})},{name:"ReservedKeyword",symbols:[{literal:"null"}],postprocess:e=>({value:"null"})},{name:"ReservedKeyword",symbols:[{literal:"undefined"}],postprocess:e=>({value:"undefined"})},{name:"ReservedKeyword",symbols:[{literal:"this"}],postprocess:e=>({value:"this"})},{name:"ReservedKeyword",symbols:[{literal:"super"}],postprocess:e=>({value:"super"})},{name:"ReservedKeyword",symbols:[{literal:"new"}],postprocess:e=>({value:"new"})},{name:"ReservedKeyword",symbols:[{literal:"typeof"}],postprocess:e=>({value:"typeof"})},{name:"ReservedKeyword",symbols:[{literal:"instanceof"}],postprocess:e=>({value:"instanceof"})},{name:"ReservedKeyword",symbols:[{literal:"in"}],postprocess:e=>({value:"in"})},{name:"ReservedKeyword",symbols:[{literal:"of"}],postprocess:e=>({value:"of"})},{name:"Arguments$ebnf$1",symbols:[]},{name:"Arguments$ebnf$1",symbols:["Arguments$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Arguments$ebnf$2",symbols:[]},{name:"Arguments$ebnf$2",symbols:["Arguments$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Arguments",symbols:[{literal:"("},"Arguments$ebnf$1","ArgumentList","Arguments$ebnf$2",{literal:")"}],postprocess:e=>e[2]},{name:"ArgumentList",symbols:[],postprocess:()=>[]},{name:"ArgumentList",symbols:["AssignmentExpression"],postprocess:e=>[e[0]]},{name:"ArgumentList$ebnf$1",symbols:[]},{name:"ArgumentList$ebnf$1",symbols:["ArgumentList$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArgumentList$ebnf$2",symbols:[]},{name:"ArgumentList$ebnf$2",symbols:["ArgumentList$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArgumentList",symbols:["ArgumentList","ArgumentList$ebnf$1",{literal:","},"ArgumentList$ebnf$2","AssignmentExpression"],postprocess:e=>[...e[0],e[4]]},{name:"ArgumentList",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>[d("SpreadElement",{argument:e[1]})]},{name:"ArgumentList$ebnf$3",symbols:[]},{name:"ArgumentList$ebnf$3",symbols:["ArgumentList$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArgumentList$ebnf$4",symbols:[]},{name:"ArgumentList$ebnf$4",symbols:["ArgumentList$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArgumentList",symbols:["ArgumentList","ArgumentList$ebnf$3",{literal:","},"ArgumentList$ebnf$4",{literal:"..."},"AssignmentExpression"],postprocess:e=>[...e[0],d("SpreadElement",{argument:e[5]})]},{name:"PrimaryExpression",symbols:[{literal:"this"}],postprocess:()=>d("ThisExpression")},{name:"PrimaryExpression",symbols:[{literal:"super"}],postprocess:()=>d("Super")},{name:"PrimaryExpression",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>$(e[0].value,e[0])},{name:"PrimaryExpression",symbols:["Literal"],postprocess:h},{name:"PrimaryExpression",symbols:["ArrayLiteral"],postprocess:h},{name:"PrimaryExpression",symbols:["ObjectLiteral"],postprocess:h},{name:"PrimaryExpression",symbols:["FunctionExpression"],postprocess:h},{name:"PrimaryExpression",symbols:["TemplateLiteral"],postprocess:h},{name:"PrimaryExpression$ebnf$1",symbols:[]},{name:"PrimaryExpression$ebnf$1",symbols:["PrimaryExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PrimaryExpression$ebnf$2",symbols:[]},{name:"PrimaryExpression$ebnf$2",symbols:["PrimaryExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PrimaryExpression",symbols:[{literal:"("},"PrimaryExpression$ebnf$1","Expression","PrimaryExpression$ebnf$2",{literal:")"}],postprocess:e=>e[2]},{name:"FunctionExpression$ebnf$1",symbols:[]},{name:"FunctionExpression$ebnf$1",symbols:["FunctionExpression$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionExpression$ebnf$2",symbols:[]},{name:"FunctionExpression$ebnf$2",symbols:["FunctionExpression$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionExpression",symbols:[{literal:"function"},{literal:"("},"FunctionExpression$ebnf$1","ParameterList","FunctionExpression$ebnf$2",{literal:")"},"Block"],postprocess:e=>d("FunctionExpression",{async:!1,id:null,params:e[3],body:e[6]})},{name:"FunctionExpression$ebnf$3",symbols:[]},{name:"FunctionExpression$ebnf$3",symbols:["FunctionExpression$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionExpression$ebnf$4",symbols:[]},{name:"FunctionExpression$ebnf$4",symbols:["FunctionExpression$ebnf$4",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionExpression",symbols:[{literal:"async"},{literal:"function"},{literal:"("},"FunctionExpression$ebnf$3","ParameterList","FunctionExpression$ebnf$4",{literal:")"},"Block"],postprocess:e=>d("FunctionExpression",{async:!0,id:null,params:e[4],body:e[7]})},{name:"Literal",symbols:[y.has("number")?{type:"number"}:number],postprocess:e=>g(e[0].value,e[0].text)},{name:"Literal",symbols:[y.has("string")?{type:"string"}:string],postprocess:e=>g(e[0].value,e[0].text)},{name:"Literal",symbols:[y.has("regex")?{type:"regex"}:regex],postprocess:e=>{return t=e[0].value.pattern,n=e[0].value.flags,d("RegexLiteral",{pattern:t,flags:n});var t,n}},{name:"Literal",symbols:[{literal:"true"}],postprocess:()=>g(!0,"true")},{name:"Literal",symbols:[{literal:"false"}],postprocess:()=>g(!1,"false")},{name:"Literal",symbols:[{literal:"null"}],postprocess:()=>g(null,"null")},{name:"Literal",symbols:[{literal:"undefined"}],postprocess:()=>g(void 0,"undefined")},{name:"TemplateLiteral",symbols:[y.has("templateLiteral")?{type:"templateLiteral"}:templateLiteral],postprocess:e=>d("TemplateLiteral",{raw:e[0].value,value:e[0].value})},{name:"ArrayLiteral$ebnf$1",symbols:[]},{name:"ArrayLiteral$ebnf$1",symbols:["ArrayLiteral$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrayLiteral$ebnf$2",symbols:[]},{name:"ArrayLiteral$ebnf$2",symbols:["ArrayLiteral$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrayLiteral",symbols:[{literal:"["},"ArrayLiteral$ebnf$1","ElementList","ArrayLiteral$ebnf$2",{literal:"]"}],postprocess:e=>d("ArrayExpression",{elements:e[2]})},{name:"ElementList",symbols:[],postprocess:()=>[]},{name:"ElementList",symbols:["Element"],postprocess:e=>[e[0]]},{name:"ElementList$ebnf$1",symbols:[]},{name:"ElementList$ebnf$1",symbols:["ElementList$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList$ebnf$2",symbols:[]},{name:"ElementList$ebnf$2",symbols:["ElementList$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList",symbols:["ElementList","ElementList$ebnf$1",{literal:","},"ElementList$ebnf$2","Element"],postprocess:e=>[...e[0],e[4]]},{name:"ElementList$ebnf$3",symbols:[]},{name:"ElementList$ebnf$3",symbols:["ElementList$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList",symbols:["ElementList","ElementList$ebnf$3",{literal:","}],postprocess:e=>[...e[0],null]},{name:"Element",symbols:["AssignmentExpression"],postprocess:h},{name:"Element",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>d("SpreadElement",{argument:e[1]})},{name:"ObjectLiteral$ebnf$1",symbols:[]},{name:"ObjectLiteral$ebnf$1",symbols:["ObjectLiteral$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral",symbols:[{literal:"{"},"ObjectLiteral$ebnf$1",{literal:"}"}],postprocess:()=>d("ObjectExpression",{properties:[]})},{name:"ObjectLiteral$ebnf$2",symbols:[]},{name:"ObjectLiteral$ebnf$2",symbols:["ObjectLiteral$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral$ebnf$3",symbols:[]},{name:"ObjectLiteral$ebnf$3",symbols:["ObjectLiteral$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral",symbols:[{literal:"{"},"ObjectLiteral$ebnf$2","PropertyDefinitionList","ObjectLiteral$ebnf$3",{literal:"}"}],postprocess:e=>d("ObjectExpression",{properties:e[2]})},{name:"PropertyDefinitionList",symbols:["PropertyDef"],postprocess:e=>[e[0]]},{name:"PropertyDefinitionList$ebnf$1",symbols:[]},{name:"PropertyDefinitionList$ebnf$1",symbols:["PropertyDefinitionList$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList$ebnf$2",symbols:[]},{name:"PropertyDefinitionList$ebnf$2",symbols:["PropertyDefinitionList$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList",symbols:["PropertyDefinitionList","PropertyDefinitionList$ebnf$1",{literal:","},"PropertyDefinitionList$ebnf$2","PropertyDef"],postprocess:e=>[...e[0],e[4]]},{name:"PropertyDefinitionList$ebnf$3",symbols:[]},{name:"PropertyDefinitionList$ebnf$3",symbols:["PropertyDefinitionList$ebnf$3",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList",symbols:["PropertyDefinitionList","PropertyDefinitionList$ebnf$3",{literal:","}],postprocess:e=>e[0]},{name:"PropertyDef$ebnf$1",symbols:[]},{name:"PropertyDef$ebnf$1",symbols:["PropertyDef$ebnf$1",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDef$ebnf$2",symbols:[]},{name:"PropertyDef$ebnf$2",symbols:["PropertyDef$ebnf$2",y.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDef",symbols:["ObjectPropertyKey","PropertyDef$ebnf$1",{literal:":"},"PropertyDef$ebnf$2","AssignmentExpression"],postprocess:e=>d("Property",{key:e[0],value:e[4],shorthand:!1})},{name:"PropertyDef",symbols:["PropertyName"],postprocess:e=>d("Property",{key:$(e[0].value),value:$(e[0].value),shorthand:!0})},{name:"PropertyDef",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>d("SpreadElement",{argument:e[1]})},{name:"ObjectPropertyKey",symbols:["PropertyName"],postprocess:e=>$(e[0].value)},{name:"ObjectPropertyKey",symbols:[y.has("string")?{type:"string"}:string],postprocess:e=>g(e[0].value,e[0].text)},{name:"ObjectPropertyKey",symbols:[y.has("number")?{type:"number"}:number],postprocess:e=>g(e[0].value,e[0].text)},{name:"ObjectPropertyKey",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>e[1]},{name:"PropertyKey",symbols:[y.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>$(e[0].value,e[0])},{name:"PropertyKey",symbols:[y.has("string")?{type:"string"}:string],postprocess:e=>g(e[0].value,e[0].text,e[0])},{name:"PropertyKey",symbols:[y.has("number")?{type:"number"}:number],postprocess:e=>g(e[0].value,e[0].text)},{name:"PropertyKey",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>e[1]},{name:"Block",symbols:[{literal:"{"},"StatementList",{literal:"}"}],postprocess:e=>d("BlockStatement",{body:e[1]})}],ParserStart:"Program"};class E{constructor(e={}){this.globalModuleCache=new Map,this.consoleLogs=[],this.callStack=[],this.currentModulePath="<main>",this.nodeStack=[],this.moduleResolver=e.moduleResolver||new i,this.globalContext=e.globalContext||this.createContext(),this.currentContext=this.globalContext,this.bindBuiltins(),e.functions&&Object.entries(e.functions).forEach(([e,t])=>{this.bindFunction(e,t)})}createContext(e){return{variables:new Map,variableKinds:new Map,functions:new Map,classes:new Map,exports:new Map,parent:e,moduleCache:new Map,modulePath:this.currentModulePath}}getStackTrace(){return this.callStack.map(e=>{let t=e.functionName;return e.modulePath&&"<main>"!==e.modulePath?(t+=` (${e.modulePath}`,e.line&&(t+=`:${e.line}`,e.column&&(t+=`:${e.column}`)),t+=")"):e.line&&(t+=` (line ${e.line})`),t})}getNodeLocation(e){return e?.loc?{line:e.loc.start.line,column:e.loc.start.column}:void 0!==e?.line?{line:e.line,column:e.column||0}:e?.start?{line:e.start.line,column:e.start.column}:e?.token?{line:e.token.line,column:e.token.col}:{}}collectVariablesFromContextChain(){const e={},t={},n={};let s=this.currentContext;for(;s;){for(const[r,o]of s.variables){if(e.hasOwnProperty(r)||r.startsWith("__"))continue;const s=this.formatVariableValue(o);this.isGlobalVariable(r)?n[r]=s:t[r]=s,e[r]=s}s=s.parent||null}const r={};let o=0;for(const[e,n]of Object.entries(t)){if(o++>=10)break;r[e]=n}for(const[e,t]of Object.entries(n)){if(o++>=10)break;r[e]=t}return r}formatVariableValue(e){try{return void 0===e?"undefined":null===e?"null":"function"==typeof e?"[Function]":"object"==typeof e?"[Object]":String(e).substring(0,50)}catch{return"[Error getting value]"}}isGlobalVariable(e){return new Set(["Error","Infinity","NaN","undefined","Date","RegExp","Array","Function","String","Number","Boolean","Object","Math","JSON","Promise","Set","Map","WeakSet","WeakMap","Symbol","Proxy","Reflect","console","setTimeout","setInterval","clearTimeout","clearInterval"]).has(e)}enhanceErrorWithContext(e,t){if(t){const n=this.getNodeLocation(t);n.line&&(e.context.line=n.line,e.context.column=n.column)}e.context.stackTrace=this.getStackTrace(),this.currentModulePath&&"<main>"!==this.currentModulePath&&(e.message.includes(this.currentModulePath)||(e.message=`[${this.currentModulePath}] ${e.message}`)),e.context.variables=this.collectVariablesFromContextChain()}enhanceErrorWithMemberContext(e,t,n,s){if(this.enhanceErrorWithContext(e,t),s){const t=e.message;e.message=t.replace(/Type mismatch in calling '.*?':/,`Type mismatch in calling method '${s.propertyName}' on object '${s.objectName}':`)}if(null!=n){const t=this.getObjectInfo(n);e.context.suggestions||(e.context.suggestions=[]);const r=[`Check if the method '${s?.propertyName||"method"}' exists on the ${t.type}`];if(t.availableMethods.length>0){r.push(`Available methods on '${s?.objectName||"object"}': ${t.availableMethods.slice(0,8).join(", ")}`);const e=this.findSimilarNames(s?.propertyName||"",t.availableMethods);e.length>0&&r.push(`Did you mean: ${e.slice(0,3).join(", ")}?`)}e.context.suggestions=[...r,...e.context.suggestions]}}getObjectInfo(e){const t=Array.isArray(e)?"array":typeof e,n=[],s=[];if(null!=e){const t=Object.getOwnPropertyNames(e);for(const r of t)"function"==typeof e[r]?n.push(r):s.push(r);if(Array.isArray(e)){["push","pop","shift","unshift","slice","splice","concat","join","forEach","map","filter","reduce","find","includes","indexOf","sort","reverse"].forEach(t=>{"function"!=typeof e[t]||n.includes(t)||n.push(t)})}else if("string"==typeof e){["charAt","charCodeAt","concat","includes","indexOf","slice","split","substring","toLowerCase","toUpperCase","trim","replace","match"].forEach(t=>{"function"!=typeof e[t]||n.includes(t)||n.push(t)})}else if("object"==typeof e){let t=Object.getPrototypeOf(e);for(;t&&t!==Object.prototype;){const e=Object.getOwnPropertyNames(t);for(const s of e)"function"!=typeof t[s]||"constructor"===s||n.includes(s)||n.push(s);t=Object.getPrototypeOf(t)}}}return{type:t,availableMethods:n.sort(),properties:s.sort()}}findSimilarNames(e,t){const n=e.toLowerCase(),s=[];for(const r of t){const t=r.toLowerCase();let o=0;if(t!==n){if(t.includes(n)||n.includes(t))o=3;else if(t.startsWith(n.charAt(0))&&n.startsWith(t.charAt(0)))o=2;else if(e.length<=6&&r.length<=6){const e=this.levenshteinDistance(n,t);e<=2&&(o=3-e)}o>0&&s.push({name:r,score:o})}}return s.sort((e,t)=>t.score-e.score).map(e=>e.name)}levenshteinDistance(e,t){const n=[];for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let s=1;s<=t.length;s++)for(let r=1;r<=e.length;r++)t.charAt(s-1)===e.charAt(r-1)?n[s][r]=n[s-1][r-1]:n[s][r]=Math.min(n[s-1][r-1]+1,n[s][r-1]+1,n[s-1][r]+1);return n[t.length][e.length]}bindBuiltins(){this.bindFunction("log",(...e)=>{this.consoleLogs.push({type:"log",args:e,timestamp:Date.now()}),console.log(...e)}),this.bindFunction("error",(...e)=>{this.consoleLogs.push({type:"error",args:e,timestamp:Date.now()}),console.error(...e)}),this.bindFunction("warn",(...e)=>{this.consoleLogs.push({type:"warn",args:e,timestamp:Date.now()}),console.warn(...e)}),this.bindFunction("Number",e=>Number(e)),this.bindFunction("String",e=>String(e)),this.bindFunction("Boolean",e=>Boolean(e)),this.bindFunction("isNaN",e=>isNaN(e)),this.bindFunction("isFinite",e=>isFinite(e)),this.bindFunction("isInteger",e=>Number.isInteger(e)),Object.entries(p).forEach(([e,t])=>{this.bindFunction(e,t)});const e=function(t){if(!(this instanceof e))return new Error(t);const n=new Error(t);return Object.setPrototypeOf(this,n),this.message=t||"",this.name="Error",this};this.bindFunction("Error",e),this.currentContext.variables.set("Error",e),this.currentContext.variables.set("Infinity",1/0),this.currentContext.variables.set("NaN",NaN),this.currentContext.variables.set("undefined",void 0),this.currentContext.variables.set("Date",Date),this.currentContext.variables.set("RegExp",RegExp),this.currentContext.variables.set("Array",Array),this.currentContext.variables.set("Function",Function),this.currentContext.variables.set("String",String),this.currentContext.variables.set("Number",Number),this.currentContext.variables.set("Boolean",Boolean);const t=Object;t.is=Object.is,this.currentContext.variables.set("Object",t),this.currentContext.variables.set("Promise",{all:e=>Promise.all(e),race:e=>Promise.race(e),resolve:e=>Promise.resolve(e),reject:e=>Promise.reject(e)}),this.bindFunction("filter",async(e,t)=>{const n=[];for(let s=0;s<e.length;s++){const r=t(e[s],s,e);(r instanceof Promise?await r:r)&&n.push(e[s])}return n}),this.bindFunction("map",async(e,t)=>{const n=[];for(let s=0;s<e.length;s++){const r=t(e[s],s,e);n.push(r instanceof Promise?await r:r)}return n}),this.bindFunction("reduce",async(e,t,n)=>{let s=void 0!==n?n:e[0];for(let r=void 0!==n?0:1;r<e.length;r++){const n=t(s,e[r],r,e);s=n instanceof Promise?await n:n}return s}),this.bindFunction("forEach",async(e,t)=>{if("function"!=typeof t)throw new TypeError(`${t} is not a function`);const n=e.length;for(let s=0;s<n;s++){if(!Object.prototype.hasOwnProperty.call(e,s))continue;const n=t(e[s],s,e);n&&n instanceof Promise&&await n}}),this.bindFunction("find",async(e,t)=>{for(let n=0;n<e.length;n++)if(await t(e[n],n,e))return e[n]}),this.bindFunction("some",async(e,t)=>{for(let n=0;n<e.length;n++)if(await t(e[n],n,e))return!0;return!1}),this.bindFunction("every",async(e,t)=>{for(let n=0;n<e.length;n++)if(!await t(e[n],n,e))return!1;return!0}),this.bindFunction("sort",async(e,t)=>{if(!t)return[...e].sort();const n=[...e];for(let e=0;e<n.length-1;e++)for(let s=e+1;s<n.length;s++){await t(n[e],n[s])>0&&([n[e],n[s]]=[n[s],n[e]])}return n}),this.bindFunction("slice",(e,t,n)=>e.slice(t,n)),this.bindFunction("concat",(...e)=>[].concat(...e)),this.bindFunction("join",(e,t)=>e.join(t)),this.bindFunction("includes",(e,t)=>e.includes(t)),this.bindFunction("indexOf",(e,t)=>Array.isArray(e)?e.indexOf(t):-1),this.bindFunction("push",(e,...t)=>e.push(...t)),this.bindFunction("forEach",(e,t)=>{Array.isArray(e)&&e.forEach(t)}),this.bindFunction("pop",e=>e.pop()),this.bindFunction("shift",e=>e.shift()),this.bindFunction("unshift",(e,...t)=>e.unshift(...t)),this.bindFunction("assign",Object.assign),this.bindFunction("freeze",Object.freeze),this.bindFunction("seal",Object.seal),this.bindFunction("toUpperCase",e=>e.toUpperCase()),this.bindFunction("toLowerCase",e=>e.toLowerCase()),this.bindFunction("trim",e=>e.trim()),this.bindFunction("split",(e,t)=>void 0!==t?e.split(t):e.split("")),this.bindFunction("replace",(e,t,n)=>e.replace(t,n)),this.bindFunction("substring",(e,t,n)=>e.substring(t,n)),this.bindFunction("charAt",(e,t)=>e.charAt(t)),this.bindFunction("charCodeAt",(e,t)=>e.charCodeAt(t)),this.bindFunction("startsWith",(e,t)=>e.startsWith(t)),this.bindFunction("endsWith",(e,t)=>e.endsWith(t)),this.bindFunction("repeat",(e,t)=>e.repeat(t)),this.bindFunction("padStart",(e,t,n)=>e.padStart(t,n)),this.bindFunction("padEnd",(e,t,n)=>e.padEnd(t,n)),this.bindFunction("pow",Math.pow),this.bindFunction("sqrt",Math.sqrt),this.bindFunction("random",Math.random),this.bindFunction("typeof",e=>typeof e),this.bindFunction("isArray",Array.isArray),this.bindFunction("isNaN",isNaN),this.bindFunction("isFinite",isFinite),this.bindFunction("parseInt",parseInt),this.bindFunction("parseFloat",parseFloat),this.bindFunction("parseJSON",JSON.parse),this.bindFunction("stringify",JSON.stringify),this.bindFunction("wait",e=>new Promise(t=>setTimeout(t,e))),this.bindFunction("Promise",Promise)}bindFunction(e,t){this.globalContext.functions.set(e,t)}setVariable(e,t){this.globalContext.variables.set(e,t)}async execute(e,t,n){E.versionLogged||(console.log("Wang Language Runtime v0.24.1"),E.versionLogged=!0),this.consoleLogs=[];const r=new f.Parser(f.Grammar.fromCompiled(v));try{if(r.feed(e),0===r.results.length)throw new s("No parse found",{type:"ParseError"});r.results.length>1&&console.warn("Ambiguous grammar detected, using first parse");const o=r.results[0],a=t||this.globalContext,i=this.currentContext;this.currentContext=a;try{const e=await this.evaluateNode(o);return n?.withMetadata?{result:e,metadata:{logs:[...this.consoleLogs]}}:e}finally{this.currentContext=i}}catch(e){if(e&&"object"==typeof e&&"return"===e.type)return n?.withMetadata?{result:e.value,metadata:{logs:[...this.consoleLogs]}}:e.value;if(e instanceof s)throw e;const t=e instanceof Error?e.message:JSON.stringify(e);throw new s(`Parse error: ${t}`,{type:"ParseError"},e instanceof Error?e:void 0)}}createSyncFunction(e){const t=this.currentContext,n=this.currentContext.variables.get("this"),s=this,r=function(...o){const a=s.createContext(t);e.id&&e.id.name&&a.variables.set(e.id.name,r),"ArrowFunctionExpression"===e.type?a.variables.set("this",n):a.variables.set("this",this),e.params.forEach((e,t)=>{if("Identifier"===e.type)a.variables.set(e.name,o[t]);else if("RestElement"===e.type)a.variables.set(e.argument.name,o.slice(t));else if("AssignmentPattern"===e.type){const n=void 0!==o[t]?o[t]:s.evaluateNodeSync(e.right);"Identifier"===e.left.type&&a.variables.set(e.left.name,n)}});const i=s.currentContext;s.currentContext=a;try{const t=e.body;if("ArrowFunctionExpression"===e.type&&"BlockStatement"!==t.type)return s.evaluateNodeSync(t);let n;for(const e of t.body)try{n=s.evaluateNodeSync(e)}catch(e){if("return"===e.type)return e.value;throw e}return n}finally{s.currentContext=i}};return r}evaluateNodeSync(e){if(e)switch(e.type){case"Literal":return e.value;case"RegexLiteral":return new RegExp(e.pattern,e.flags);case"Identifier":return this.evaluateIdentifier(e);case"MemberExpression":const t=this.evaluateNodeSync(e.object);if(e.optional&&null==t)return;if(!e.optional&&null==t){const n="Identifier"===e.object.type?e.object.name:"expression",s=e.computed?"<computed>":e.property.name||"<unknown>",r=new o("object",t,`accessing property '${s}' of '${n}'`);throw this.enhanceErrorWithContext(r,e),r}const n=e.computed?this.evaluateNodeSync(e.property):e.property.name;if("string"==typeof t){const e=this.getStringMethod(t,n);if(e)return e}if(Array.isArray(t)){const e=this.getArrayMethod(t,n);if(e)return e}return t[n];case"BinaryExpression":if("||"===e.operator){return this.evaluateNodeSync(e.left)||this.evaluateNodeSync(e.right)}if("&&"===e.operator){return this.evaluateNodeSync(e.left)&&this.evaluateNodeSync(e.right)}const r=this.evaluateNodeSync(e.left),a=this.evaluateNodeSync(e.right);switch(e.operator){case"+":return r+a;case"-":return r-a;case"*":return r*a;case"/":return r/a;case"%":return r%a;case"==":return r==a;case"!=":return r!=a;case"===":return r===a;case"!==":return r!==a;case"<":return r<a;case"<=":return r<=a;case">":return r>a;case">=":return r>=a;case"in":if(null==a)throw new TypeError('Cannot use "in" operator to search for property in null or undefined');return String(r)in Object(a);case"instanceof":if("function"!=typeof a)throw new TypeError("Right-hand side of instanceof is not a constructor");return r instanceof a;default:throw new s(`Unknown binary operator: ${e.operator}`,{type:"RuntimeError",suggestions:["Valid operators: +, -, *, /, %, ==, !=, ===, !==, <, <=, >, >=, &&, ||, ??, in, instanceof","Check for typos in the operator"]})}case"UnaryExpression":const i=this.evaluateNodeSync(e.argument);switch(e.operator){case"!":return!i;case"-":return-i;case"+":return+i;case"typeof":return typeof i;default:throw new s(`Unknown unary operator: ${e.operator}`,{type:"RuntimeError",suggestions:["Valid unary operators: !, -, +, ~, typeof, void, delete","Check for typos in the operator"]})}case"AssignmentExpression":const l=this.evaluateNodeSync(e.right);if("MemberExpression"===e.left.type){this.evaluateNodeSync(e.left.object)[e.left.computed?this.evaluateNodeSync(e.left.property):e.left.property.name]=l}else"Identifier"===e.left.type&&this.currentContext.variables.set(e.left.name,l);return l;case"ConditionalExpression":return this.evaluateNodeSync(e.test)?this.evaluateNodeSync(e.consequent):this.evaluateNodeSync(e.alternate);case"BlockStatement":let c;for(const t of e.body)c=this.evaluateNodeSync(t);return c;case"ExpressionStatement":return this.evaluateNodeSync(e.expression);case"ReturnStatement":throw{type:"return",value:e.argument?this.evaluateNodeSync(e.argument):void 0};case"IfStatement":return this.evaluateNodeSync(e.test)?this.evaluateNodeSync(e.consequent):e.alternate?this.evaluateNodeSync(e.alternate):void 0;case"CallExpression":let u,p=null;if("MemberExpression"===e.callee.type){const t=this.evaluateNodeSync(e.callee.object),n=e.callee.computed?this.evaluateNodeSync(e.callee.property):e.callee.property.name;u=t?.[n],p=t}else u=this.evaluateNodeSync(e.callee);if("function"!=typeof u){const t=new o("function",u,"calling 'member expression'");if("MemberExpression"===e.callee.type){const n=this.getMemberExpressionName(e.callee);this.enhanceErrorWithMemberContext(t,e,p,n)}else{const n=e.callee.name||"expression";t.message=t.message.replace(/calling '.*?'/,`calling '${n}'`),this.enhanceErrorWithContext(t,e)}throw t}const m=e.arguments.map(e=>{if("SpreadElement"===e.type){return this.evaluateNodeSync(e.argument)}return this.evaluateNodeSync(e)}),f=m,h=[];for(let t=0;t<f.length;t++)"SpreadElement"===e.arguments[t].type?h.push(...f[t]):h.push(f[t]);return u.apply(p,h);case"ThrowStatement":throw this.evaluateNodeSync(e.argument);case"ThisExpression":return this.evaluateIdentifier({name:"this"});case"ArrowFunctionExpression":case"FunctionExpression":return this.createSyncFunction(e);case"ObjectExpression":const y={};for(const t of e.properties)if("SpreadElement"===t.type){const e=this.evaluateNodeSync(t.argument);Object.assign(y,e)}else{const e=t.computed?this.evaluateNodeSync(t.key):"Identifier"===t.key.type?t.key.name:this.evaluateNodeSync(t.key);t.shorthand?y[e]=this.evaluateIdentifier(t.key):y[e]=this.evaluateNodeSync(t.value)}return y;case"ArrayExpression":const b=[];for(const t of e.elements)if(null===t)b.push(void 0);else if("SpreadElement"===t.type){const e=this.evaluateNodeSync(t.argument);if("function"!=typeof e[Symbol.iterator]&&!Array.isArray(e))throw new Error("Parse error: Spread syntax requires ...iterable[Symbol.iterator] to be a function");b.push(...e)}else b.push(this.evaluateNodeSync(t));return b;default:throw new s(`Cannot evaluate node type synchronously: ${e.type}`,{type:"RuntimeError",suggestions:["This node type may require async evaluation","Use await or the async version of this method",`Node type '${e.type}' is not supported in synchronous context`]})}}async evaluateNode(e){if(e)switch(e.type){case"Program":return this.evaluateProgram(e);case"VariableDeclaration":return this.evaluateVariableDeclaration(e);case"FunctionDeclaration":return this.evaluateFunctionDeclaration(e);case"ClassDeclaration":return this.evaluateClassDeclaration(e);case"ExpressionStatement":return this.evaluateNode(e.expression);case"BlockStatement":return this.evaluateBlock(e);case"IfStatement":return this.evaluateIfStatement(e);case"ForStatement":case"ForOfStatement":case"ForInStatement":return this.evaluateForStatement(e);case"WhileStatement":return this.evaluateWhileStatement(e);case"DoWhileStatement":return this.evaluateDoWhileStatement(e);case"SwitchStatement":return this.evaluateSwitchStatement(e);case"BreakStatement":throw{type:"break",label:e.label};case"ContinueStatement":throw{type:"continue",label:e.label};case"LabeledStatement":return this.evaluateLabeledStatement(e);case"ReturnStatement":throw{type:"return",value:e.argument?await this.evaluateNode(e.argument):void 0};case"ThrowStatement":throw await this.evaluateNode(e.argument);case"TryStatement":return this.evaluateTryStatement(e);case"ImportDeclaration":return this.evaluateImport(e);case"ExportNamedDeclaration":return this.evaluateExport(e);case"Identifier":return this.evaluateIdentifier(e);case"Literal":return e.value;case"RegexLiteral":return new RegExp(e.pattern,e.flags);case"TemplateLiteral":return this.evaluateTemplateLiteral(e);case"ArrayExpression":return this.evaluateArrayExpression(e);case"ObjectExpression":return this.evaluateObjectExpression(e);case"FunctionExpression":case"ArrowFunctionExpression":return this.createFunction(e);case"CallExpression":return this.evaluateCallExpression(e);case"NewExpression":return this.evaluateNewExpression(e);case"MemberExpression":return this.evaluateMemberExpression(e);case"BinaryExpression":return this.evaluateBinaryExpression(e);case"UnaryExpression":return this.evaluateUnaryExpression(e);case"AssignmentExpression":return this.evaluateAssignmentExpression(e);case"UpdateExpression":return this.evaluateUpdateExpression(e);case"ConditionalExpression":return this.evaluateConditionalExpression(e);case"ThisExpression":return this.evaluateIdentifier({name:"this"});case"Super":return this.currentContext.variables.get("__super__");case"SpreadElement":const t=await this.evaluateNode(e.argument);if(!Array.isArray(t)){const n=new o("array",t,"spread operator");throw this.enhanceErrorWithContext(n,e),n}return t;default:throw new s(`Unknown node type: ${e.type}`,{type:"RuntimeError"})}}async evaluateProgram(e){const t=this.processContinuations(e.body);let n;this.hoistVarDeclarations(t);for(const e of t)n=await this.evaluateNode(e);return n}processContinuations(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n];t.push(s)}return t}hoistVarDeclarations(e){for(const t of e)if("VariableDeclaration"===t.type&&"var"===t.kind)for(const e of t.declarations)this.hoistVarPattern(e.id);else"FunctionDeclaration"===t.type&&this.currentContext.functions.set(t.id.name,this.createFunction(t))}hoistVarPattern(e){if("Identifier"===e.type)this.currentContext.variables.has(e.name)||(this.currentContext.variables.set(e.name,void 0),this.currentContext.variableKinds.set(e.name,"var"));else if("ObjectPattern"===e.type)for(const t of e.properties)if("Property"===t.type)if(t.shorthand&&"string"==typeof t.value)this.currentContext.variables.has(t.value)||(this.currentContext.variables.set(t.value,void 0),this.currentContext.variableKinds.set(t.value,"var"));else{const e="string"==typeof t.value?{type:"Identifier",name:t.value}:t.value;this.hoistVarPattern(e)}else"RestElement"===t.type&&(this.currentContext.variables.has(t.argument)||(this.currentContext.variables.set(t.argument,void 0),this.currentContext.variableKinds.set(t.argument,"var")));else if("ArrayPattern"===e.type)for(const t of e.elements)if(t)if("RestElement"===t.type){const e=t.argument.name||t.argument;this.currentContext.variables.has(e)||(this.currentContext.variables.set(e,void 0),this.currentContext.variableKinds.set(e,"var"))}else this.hoistVarPattern(t)}async evaluateVariableDeclaration(e){for(const t of e.declarations){const n=t.init?await this.evaluateNode(t.init):void 0;this.assignPattern(t.id,n,e.kind)}}assignPattern(e,t,n){if("Identifier"===e.type)if("var"===n){let n=this.currentContext;for(;n;){if(n.variables.has(e.name)){n.variables.set(e.name,t);break}n=n.parent}n||(this.currentContext.variables.set(e.name,t),this.currentContext.variableKinds.set(e.name,"var"))}else this.currentContext.variables.set(e.name,t),n&&this.currentContext.variableKinds.set(e.name,n);else if("ObjectPattern"===e.type){if(null==t){const n="ObjectPattern"===e.type?"object":"array",s=new o(n,t,"destructuring assignment");throw this.enhanceErrorWithContext(s,e),s}for(const s of e.properties)if("Property"===s.type){const e="Identifier"===s.key.type?s.key.name:s.key.value;if(s.shorthand&&"string"==typeof s.value)this.currentContext.variables.set(s.value,t[e]),n&&this.currentContext.variableKinds.set(s.value,n);else{const r="string"==typeof s.value?{type:"Identifier",name:s.value}:s.value;this.assignPattern(r,t[e],n)}}else if("RestElement"===s.type){const r={...t};for(const t of e.properties)if("Property"===t.type){delete r["Identifier"===t.key.type?t.key.name:t.key.value]}this.currentContext.variables.set(s.argument,r),n&&this.currentContext.variableKinds.set(s.argument,n)}}else if("ArrayPattern"===e.type){if(null==t){const n="ObjectPattern"===e.type?"object":"array",s=new o(n,t,"destructuring assignment");throw this.enhanceErrorWithContext(s,e),s}const s=Array.isArray(t)?t:[];let r=0;for(const t of e.elements)t&&("RestElement"===t.type?(this.currentContext.variables.set(t.argument.name||t.argument,s.slice(r)),n&&this.currentContext.variableKinds.set(t.argument.name||t.argument,n)):this.assignPattern(t,s[r],n)),r++}}async evaluateFunctionDeclaration(e){const t=this.createFunction(e);this.currentContext.functions.set(e.id.name,t)}canExecuteSynchronously(e){if("BlockStatement"!==e.type)return!0;for(const t of e.body)if(!this.canStatementExecuteSynchronously(t))return!1;return!0}canStatementExecuteSynchronously(e){switch(e.type){case"ExpressionStatement":return this.canExpressionExecuteSynchronously(e.expression);case"ReturnStatement":return!e.argument||this.canExpressionExecuteSynchronously(e.argument);case"VariableDeclaration":default:return!1;case"IfStatement":return this.canExpressionExecuteSynchronously(e.test)&&this.canStatementExecuteSynchronously(e.consequent)&&(!e.alternate||this.canStatementExecuteSynchronously(e.alternate))}}canExpressionExecuteSynchronously(e){switch(e.type){case"Identifier":case"Literal":case"BooleanLiteral":case"NumericLiteral":case"StringLiteral":return!0;case"BinaryExpression":case"LogicalExpression":return this.canExpressionExecuteSynchronously(e.left)&&this.canExpressionExecuteSynchronously(e.right);case"UnaryExpression":return this.canExpressionExecuteSynchronously(e.argument);case"MemberExpression":return this.canExpressionExecuteSynchronously(e.object)&&(!e.computed||this.canExpressionExecuteSynchronously(e.property));default:return!1}}createFunction(e){const t=e.params||[],n=e.body,s=e.async,r=this.currentContext,o="ArrowFunctionExpression"===e.type?this.currentContext.variables.get("this"):void 0;if(!s&&"ArrowFunctionExpression"===e.type&&this.canExecuteSynchronously(n)){return(...e)=>{const s=this.createContext(r);s.variables.set("this",o);const a=this.currentContext;this.currentContext=s;for(let n=0;n<t.length;n++){const r=t[n];if("RestElement"===r.type){s.variables.set(r.argument.name||r.argument,e.slice(n));break}if("AssignmentPattern"===r.type){const t=void 0!==e[n]?e[n]:this.evaluateNodeSync(r.right);this.assignPattern(r.left,t)}else this.assignPattern(r,e[n])}try{if("BlockStatement"===n.type){let e;this.hoistVarDeclarations(n.body);for(const t of n.body)try{e=this.evaluateNodeSync(t)}catch(e){if("return"===e?.type)return e.value;throw e}return e}return this.evaluateNodeSync(n)}finally{this.currentContext=a}}}const a=this,i=async function(...s){const l=a.createContext(r);e.id&&e.id.name&&l.variables.set(e.id.name,i),"ArrowFunctionExpression"===e.type?l.variables.set("this",o):l.variables.set("this",this);const c=a.currentContext;a.currentContext=l;for(let e=0;e<t.length;e++){const n=t[e];if("RestElement"===n.type){l.variables.set(n.argument.name||n.argument,s.slice(e));break}if("AssignmentPattern"===n.type){const t=e<s.length&&void 0!==s[e]?s[e]:await a.evaluateNode(n.right);a.assignPattern(n.left,t)}else a.assignPattern(n,s[e])}try{return"BlockStatement"===n.type?(a.hoistVarDeclarations(n.body),void await a.evaluateBlock(n)):await a.evaluateNode(n)}catch(e){if("return"===e?.type)return e.value;throw e}finally{a.currentContext=c}};return s?i:function(...e){const t=i.apply(this,e);return t instanceof Promise?t:Promise.resolve(t)}}async evaluateClassDeclaration(e){const t=e.id.name,n=e.superClass?this.evaluateIdentifier(e.superClass):null,s=e.body.body.find(e=>"constructor"===e.kind),r=this,o=function(...e){return(async()=>{const t=Object.create(o.prototype);if(s){const o=r.createContext(r.currentContext);o.variables.set("this",t),n&&o.variables.set("__super__",async(...e)=>{const s=await n(...e);Object.assign(t,s),s instanceof Error&&(void 0!==s.message&&(t.message=s.message),void 0!==s.name&&(t.name=s.name),void 0!==s.stack&&(t.stack=s.stack))});for(let t=0;t<s.params.length;t++){const n=s.params[t];"Identifier"===n.type&&o.variables.set(n.name,e[t])}const a=r.currentContext;r.currentContext=o;try{for(const e of s.body.body)await r.evaluateNode(e)}finally{r.currentContext=a}}return t})()};n&&(o.prototype=Object.create(n.prototype),o.prototype.constructor=o);for(const t of e.body.body)if("MethodDefinition"===t.type&&"constructor"!==t.kind){const e=t.key.name;if("get"===t.kind||"set"===t.kind){const n=t.static?o:o.prototype,s=Object.getOwnPropertyDescriptor(n,e)||{configurable:!0,enumerable:!0};"get"===t.kind?s.get=function(){const e=r.createContext(r.currentContext);e.variables.set("this",this);const n=r.currentContext;r.currentContext=e;try{let e;for(const n of t.body.body)try{e=r.evaluateNodeSync(n)}catch(e){if("return"===e.type)return e.value;throw e}return e}finally{r.currentContext=n}}:s.set=function(e){const n=r.createContext(r.currentContext);if(n.variables.set("this",this),t.params.length>0){const s=t.params[0];"Identifier"===s.type&&n.variables.set(s.name,e)}const s=r.currentContext;r.currentContext=n;try{for(const e of t.body.body)if("ExpressionStatement"===e.type)r.evaluateNodeSync(e.expression);else if("IfStatement"===e.type){r.evaluateNodeSync(e.test)?r.evaluateNodeSync(e.consequent):e.alternate&&r.evaluateNodeSync(e.alternate)}else if("ThrowStatement"===e.type)throw r.evaluateNodeSync(e.argument)}finally{r.currentContext=s}},Object.defineProperty(n,e,s)}else{const n=async function(...e){const n=r.createContext(r.currentContext);n.variables.set("this",t.static?o:this);for(let s=0;s<t.params.length;s++){const o=t.params[s];if("Identifier"===o.type)n.variables.set(o.name,e[s]);else if("AssignmentPattern"===o.type){const t=s<e.length&&void 0!==e[s]?e[s]:await r.evaluateNode(o.right);"Identifier"===o.left.type&&n.variables.set(o.left.name,t)}}const s=r.currentContext;r.currentContext=n;try{let e;for(const n of t.body.body)try{e=await r.evaluateNode(n)}catch(e){if("return"===e.type)return e.value;throw e}return e}finally{r.currentContext=s}};t.static?o[e]=n:o.prototype[e]=n}}this.currentContext.classes.set(t,o),this.currentContext.variables.set(t,o)}async evaluateBlock(e){const t=this.createContext(this.currentContext),n=this.currentContext;this.currentContext=t;try{e._processedBody||(e._processedBody=this.processContinuations(e.body));const t=e._processedBody;let n;for(const e of t)n=await this.evaluateNode(e);return n}finally{this.currentContext=n}}async evaluateIfStatement(e){return await this.evaluateNode(e.test)?await this.evaluateNode(e.consequent):e.alternate?await this.evaluateNode(e.alternate):void 0}async evaluateForStatement(e){if("ForOfStatement"===e.type){const t=await this.evaluateNode(e.right);if(null==t){const n=new o("iterable",t,"for...of loop");throw this.enhanceErrorWithContext(n,e),n}if("function"!=typeof t[Symbol.iterator]&&!Array.isArray(t)){const n=new o("iterable (Array, Set, Map, String, etc.)",t,"for...of loop");throw this.enhanceErrorWithContext(n,e),n}for(const n of t){"VariableDeclaration"===e.left.type&&this.assignPattern(e.left.declarations[0].id,n);try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}}else if("ForInStatement"===e.type){const t=await this.evaluateNode(e.right);if(null==t){const n=new o("object",t,"for...in loop");throw this.enhanceErrorWithContext(n,e),n}for(const n in t){"VariableDeclaration"===e.left.type&&this.assignPattern(e.left.declarations[0].id,n);try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}}else for(e.init&&await this.evaluateNode(e.init);!e.test||await this.evaluateNode(e.test);){try{await this.evaluateNode(e.body)}catch(t){if("break"===t.type&&!t.label)break;if("continue"===t.type&&!t.label){e.update&&await this.evaluateNode(e.update);continue}throw t}e.update&&await this.evaluateNode(e.update)}}async evaluateWhileStatement(e){for(;await this.evaluateNode(e.test);)try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}async evaluateDoWhileStatement(e){do{try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}while(await this.evaluateNode(e.test))}async evaluateLabeledStatement(e){try{return await this.evaluateNode(e.body)}catch(t){if(("break"===t.type||"continue"===t.type)&&t.label===e.label){if("break"===t.type)return;throw t}throw t}}async evaluateSwitchStatement(e){const t=await this.evaluateNode(e.discriminant);let n=!1;for(const s of e.cases){if(!n)if(null===s.test)n=!0;else{t===await this.evaluateNode(s.test)&&(n=!0)}if(n)try{for(const e of s.consequent)await this.evaluateNode(e)}catch(e){if("break"===e.type)break;throw e}}}async evaluateTryStatement(e){let t;try{t=await this.evaluateNode(e.block)}catch(n){if(n&&"object"==typeof n&&("break"===n.type||"continue"===n.type||"return"===n.type))throw n;if(!e.handler)throw n;e.handler.param&&this.assignPattern(e.handler.param,n),t=await this.evaluateNode(e.handler.body)}finally{if(e.finalizer){t=await this.evaluateNode(e.finalizer)}}return t}evaluateIdentifier(e){const t=e.name;if(this.currentContext.variables.has(t))return this.currentContext.variables.get(t);let n=this.currentContext.parent;for(;n;){if(n.variables.has(t))return n.variables.get(t);n=n.parent}if(this.currentContext.functions.has(t))return this.currentContext.functions.get(t);if(this.globalContext.functions.has(t))return this.globalContext.functions.get(t);if(this.currentContext.classes.has(t))return this.currentContext.classes.get(t);const s=new a(t,[...this.currentContext.variables.keys()]);throw this.enhanceErrorWithContext(s,e),s}async evaluateCallExpression(e){if("Super"===e.callee.type){const t=this.currentContext.variables.get("__super__");if(!t){const t=new s("super() can only be called in a derived class constructor",{type:"RuntimeError"});throw this.enhanceErrorWithContext(t,e),t}const n=[];for(const t of e.arguments)if("SpreadElement"===t.type){const e=await this.evaluateNode(t.argument);if("function"!=typeof e[Symbol.iterator]&&!Array.isArray(e))throw new Error("Parse error: Spread syntax requires ...iterable[Symbol.iterator] to be a function");n.push(...e)}else n.push(await this.evaluateNode(t));return t(...n)}let t,n=null;if("MemberExpression"===e.callee.type){const s=await this.evaluateNode(e.callee.object);if(n=s,e.callee.optional&&null==s)t=void 0;else{if(!e.callee.optional&&null==s){const t="Identifier"===e.callee.object.type?e.callee.object.name:"expression",n=e.callee.computed?"<computed>":e.callee.property.name||"<unknown>",r=new o("object",s,`accessing property '${n}' of '${t}'`);throw this.enhanceErrorWithContext(r,e.callee),r}{const n=e.callee.computed?await this.evaluateNode(e.callee.property):e.callee.property.name;if("string"==typeof s){const e=this.getStringMethod(s,n);t=e||s[n]}else if(Array.isArray(s)){const e=this.getArrayMethod(s,n);t=e||s[n]}else t=s[n]}}}else t=await this.evaluateNode(e.callee);if("function"!=typeof t){const s=new o("function",t,"calling 'member expression'");if("MemberExpression"===e.callee.type){const t=this.getMemberExpressionName(e.callee);this.enhanceErrorWithMemberContext(s,e,n,t)}else{const t="Identifier"===e.callee.type?e.callee.name:"expression";s.message=s.message.replace(/calling '.*?'/,`calling '${t}'`),this.enhanceErrorWithContext(s,e)}throw s}const r=[];for(const t of e.arguments)if("SpreadElement"===t.type){const e=await this.evaluateNode(t.argument);if("function"!=typeof e[Symbol.iterator]&&!Array.isArray(e))throw new Error("Parse error: Spread syntax requires ...iterable[Symbol.iterator] to be a function");r.push(...e)}else r.push(await this.evaluateNode(t));const a=r,i="Identifier"===e.callee.type?e.callee.name:"MemberExpression"===e.callee.type?e.callee.property.name||"<computed>":"<anonymous>",l=this.getNodeLocation(e),c={functionName:i,modulePath:this.currentModulePath,line:l.line,column:l.column,nodeType:"CallExpression"};this.callStack.push(c);try{return await t.apply(n,a)}finally{this.callStack.pop()}}async evaluateBinaryExpression(e){if("||"===e.operator){return await this.evaluateNode(e.left)||await this.evaluateNode(e.right)}if("&&"===e.operator){return await this.evaluateNode(e.left)&&await this.evaluateNode(e.right)}const t=await this.evaluateNode(e.left),n=await this.evaluateNode(e.right);switch(e.operator){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"**":return t**n;case"==":return t==n;case"!=":return t!=n;case"===":return t===n;case"!==":return t!==n;case"<":return t<n;case">":return t>n;case"<=":return t<=n;case">=":return t>=n;case"??":return t??n;case"in":if(null==n)throw new TypeError('Cannot use "in" operator to search for property in null or undefined');return String(t)in Object(n);case"instanceof":if("function"!=typeof n)throw new TypeError("Right-hand side of instanceof is not a constructor");return t instanceof n;default:throw new s(`Unknown binary operator: ${e.operator}`,{type:"RuntimeError"})}}async evaluateUnaryExpression(e){if("++"===e.operator||"--"===e.operator){if("Identifier"!==e.argument.type)throw new s("Prefix increment/decrement only supports identifiers",{type:"RuntimeError"});const t=e.argument.name,n=this.evaluateIdentifier(e.argument)||0,r="++"===e.operator?n+1:n-1;let o=this.currentContext;for(;o;){if(o.variables.has(t)){o.variables.set(t,r);break}o=o.parent}return o||this.currentContext.variables.set(t,r),r}if("typeof"===e.operator){if("Identifier"===e.argument.type){const t=e.argument.name;let n=this.currentContext;for(;n;){if(n.variables.has(t)){return typeof n.variables.get(t)}if(n.functions.has(t))return"function";n=n.parent}return this.currentContext.functions.has(t)?"function":"undefined"}return typeof await this.evaluateNode(e.argument)}const t=await this.evaluateNode(e.argument);switch(e.operator){case"!":return!t;case"+":return+t;case"-":return-t;case"await":return await t;default:throw new s(`Unknown unary operator: ${e.operator}`,{type:"RuntimeError"})}}async evaluateAssignmentExpression(e){const t=await this.evaluateNode(e.right);if("Identifier"===e.left.type){const n=e.left.name;switch(e.operator){case"=":let r=this.currentContext,o=!1;for(;r;){if(r.variables.has(n)){if("const"===r.variableKinds.get(n))throw new s(`Cannot reassign const variable "${n}"`);r.variables.set(n,t),o=!0;break}r=r.parent}return o||this.currentContext.variables.set(n,t),t;case"+=":const a=(this.evaluateIdentifier(e.left)||0)+t;let i=this.currentContext;for(;i;){if(i.variables.has(n)){if("const"===i.variableKinds.get(n))throw new s(`Cannot reassign const variable "${n}"`);i.variables.set(n,a);break}i=i.parent}return i||this.currentContext.variables.set(n,a),a;case"-=":const l=(this.evaluateIdentifier(e.left)||0)-t;let c=this.currentContext;for(;c;){if(c.variables.has(n)){if("const"===c.variableKinds.get(n))throw new s(`Cannot reassign const variable "${n}"`);c.variables.set(n,l);break}c=c.parent}return c||this.currentContext.variables.set(n,l),l;case"*=":const u=(this.evaluateIdentifier(e.left)||0)*t;let p=this.currentContext;for(;p;){if(p.variables.has(n)){if("const"===p.variableKinds.get(n))throw new s(`Cannot reassign const variable "${n}"`);p.variables.set(n,u);break}p=p.parent}return p||this.currentContext.variables.set(n,u),u;case"/=":const m=(this.evaluateIdentifier(e.left)||0)/t;let f=this.currentContext;for(;f;){if(f.variables.has(n)){if("const"===f.variableKinds.get(n))throw new s(`Cannot reassign const variable "${n}"`);f.variables.set(n,m);break}f=f.parent}return f||this.currentContext.variables.set(n,m),m;default:throw new s(`Assignment operator ${e.operator} not implemented`,{type:"RuntimeError"})}}else if("MemberExpression"===e.left.type){const n=await this.evaluateNode(e.left.object),r=e.left.computed?await this.evaluateNode(e.left.property):e.left.property.name;if(null==n)throw new s(`Cannot set property '${r}' on null or undefined`,{type:"RuntimeError"});switch(e.operator){case"=":return n[r]=t,t;case"+=":return n[r]=(n[r]||0)+t,n[r];case"-=":return n[r]=(n[r]||0)-t,n[r];case"*=":return n[r]=(n[r]||0)*t,n[r];case"/=":return n[r]=(n[r]||0)/t,n[r];default:throw new s(`Assignment operator ${e.operator} not implemented for member expressions`,{type:"RuntimeError"})}}throw new s("Complex assignment patterns not yet implemented",{type:"RuntimeError"})}async evaluateUpdateExpression(e){if("Identifier"===e.argument.type){const t=e.argument.name,n=this.evaluateIdentifier(e.argument)||0,r="++"===e.operator?n+1:n-1;let o=this.currentContext;for(;o;){if(o.variables.has(t)){if("const"===o.variableKinds.get(t))throw new s(`Cannot reassign const variable "${t}"`);o.variables.set(t,r);break}o=o.parent}return o||this.currentContext.variables.set(t,r),e.prefix?r:n}if("MemberExpression"===e.argument.type){const t=await this.evaluateNode(e.argument.object),n=e.argument.computed?await this.evaluateNode(e.argument.property):e.argument.property.name;if(null==t){const s="Identifier"===e.argument.object.type?e.argument.object.name:"expression";throw new o("object",t,`updating property '${n}' of '${s}'`)}const s=t[n]||0,r="++"===e.operator?s+1:s-1;return t[n]=r,e.prefix?r:s}throw new s("Update expression only supports identifiers and member expressions",{type:"RuntimeError"})}async evaluateConditionalExpression(e){return await this.evaluateNode(e.test)?await this.evaluateNode(e.consequent):await this.evaluateNode(e.alternate)}async evaluateMemberExpression(e){const t=await this.evaluateNode(e.object);if(e.optional&&null==t)return;if(!e.optional&&null==t){const n="Identifier"===e.object.type?e.object.name:"expression",s=e.computed?"<computed>":e.property.name||"<unknown>",r=new o("object",t,`accessing property '${s}' of '${n}'`);throw this.enhanceErrorWithContext(r,e),r}const n=e.computed?await this.evaluateNode(e.property):e.property.name;if("string"==typeof t){const e=this.getStringMethod(t,n);if(e)return e}if(Array.isArray(t)){const e=this.getArrayMethod(t,n);if(e)return e}return t[n]}getMemberExpressionName(e){let t="unknown",n="unknown";if(e.object)if("Identifier"===e.object.type)t=e.object.name;else if("ThisExpression"===e.object.type)t="this";else if("MemberExpression"===e.object.type){t=this.getMemberExpressionName(e.object).fullName}else t="expression";e.property&&(n=e.computed?"Literal"===e.property.type?String(e.property.value):"Identifier"===e.property.type?`[${e.property.name}]`:"[computed]":e.property.name||"unknown");return{objectName:t,propertyName:n,fullName:e.computed?`${t}[${n}]`:`${t}.${n}`}}getStringMethod(e,t){const n=this;switch(t){case"split":return t=>{const s=n.currentContext.functions.get("split");return s?s(e,t):e.split(t)};case"includes":return(t,n)=>e.includes(t,n);case"indexOf":return(t,n)=>e.indexOf(t,n);case"lastIndexOf":return(t,n)=>e.lastIndexOf(t,n);case"substring":return(t,s)=>{const r=n.currentContext.functions.get("substring");return r?r(e,t,s):e.substring(t,s)};case"substr":return(t,n)=>e.substr(t,n);case"slice":return(t,n)=>e.slice(t,n);case"trim":return()=>{const t=n.currentContext.functions.get("trim");return t?t(e):e.trim()};case"trimStart":case"trimLeft":return()=>e.trimStart();case"trimEnd":case"trimRight":return()=>e.trimEnd();case"replace":return(t,s)=>{const r=n.currentContext.functions.get("replace");return r?r(e,t,s):e.replace(t,s)};case"replaceAll":return(t,n)=>"replaceAll"in String.prototype?e.replaceAll(t,n):"string"==typeof t?e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n):e.replace(t,n);case"toLowerCase":return()=>{const t=n.currentContext.functions.get("toLowerCase");return t?t(e):e.toLowerCase()};case"toUpperCase":return()=>{const t=n.currentContext.functions.get("toUpperCase");return t?t(e):e.toUpperCase()};case"charAt":return t=>{const s=n.currentContext.functions.get("charAt");return s?s(e,t):e.charAt(t)};case"charCodeAt":return t=>{const s=n.currentContext.functions.get("charCodeAt");return s?s(e,t):e.charCodeAt(t)};case"startsWith":return(t,s)=>{const r=n.currentContext.functions.get("startsWith");return r?r(e,t):e.startsWith(t,s)};case"endsWith":return(t,s)=>{const r=n.currentContext.functions.get("endsWith");return r?r(e,t):e.endsWith(t,s)};case"repeat":return t=>{const s=n.currentContext.functions.get("repeat");return s?s(e,t):e.repeat(t)};case"padStart":return(t,s)=>{const r=n.currentContext.functions.get("padStart");return r?r(e,t,s):e.padStart(t,s)};case"padEnd":return(t,s)=>{const r=n.currentContext.functions.get("padEnd");return r?r(e,t,s):e.padEnd(t,s)};case"match":return t=>e.match(t);case"search":return t=>e.search(t);case"concat":return(...t)=>e.concat(...t);default:return}}getArrayMethod(e,t){const n=this;switch(t){case"filter":return async t=>{const s=n.currentContext.functions.get("filter")||n.globalContext.functions.get("filter");return s?await s(e,t):e.filter(t)};case"map":return async t=>{const s=n.currentContext.functions.get("map")||n.globalContext.functions.get("map");return s?await s(e,t):e.map(t)};case"reduce":return async(t,s)=>{const r=n.currentContext.functions.get("reduce")||n.globalContext.functions.get("reduce");return r?await r(e,t,s):e.reduce(t,s)};case"find":return async t=>{const s=n.currentContext.functions.get("find")||n.globalContext.functions.get("find");return s?await s(e,t):e.find(t)};case"findIndex":return t=>e.findIndex(t);case"some":return async t=>{const s=n.currentContext.functions.get("some")||n.globalContext.functions.get("some");return s?await s(e,t):e.some(t)};case"every":return async t=>{const s=n.currentContext.functions.get("every")||n.globalContext.functions.get("every");return s?await s(e,t):e.every(t)};case"forEach":return async t=>{if("function"!=typeof t)throw new TypeError(`${t} is not a function`);const n=e.length;for(let s=0;s<n;s++){if(!Object.prototype.hasOwnProperty.call(e,s))continue;const n=t(e[s],s,e);n&&n instanceof Promise&&await n}};case"sort":return t=>{const s=n.currentContext.functions.get("sort")||n.globalContext.functions.get("sort");return s?s(e,t):e.sort(t)};case"reverse":return()=>{const t=n.currentContext.functions.get("reverse")||n.globalContext.functions.get("reverse");return t?t(e):e.reverse()};case"slice":return(t,s)=>{const r=n.currentContext.functions.get("slice");return r?r(e,t,s):e.slice(t,s)};case"splice":return(t,n,...s)=>e.splice(t,n??e.length-t,...s);case"concat":return(...t)=>{const s=n.currentContext.functions.get("concat");return s?s(e,...t):e.concat(...t)};case"join":return t=>{const s=n.currentContext.functions.get("join");return s?s(e,t):e.join(t)};case"includes":return(t,s)=>{const r=n.currentContext.functions.get("includes");return r?r(e,t):e.includes(t,s)};case"indexOf":return(t,s)=>{const r=n.currentContext.functions.get("indexOf");return r?r(e,t):e.indexOf(t,s)};case"lastIndexOf":return(t,n)=>{const s=e.length;for(let r=void 0!==n?n<0?Math.max(0,s+n):Math.min(n,s-1):s-1;r>=0;r--)if(e[r]===t)return r;return-1};case"push":return(...t)=>{const s=n.currentContext.functions.get("push");return s?s(e,...t):(e.push(...t),e.length)};case"pop":return()=>{const t=n.currentContext.functions.get("pop");return t?t(e):e.pop()};case"shift":return()=>{const t=n.currentContext.functions.get("shift");return t?t(e):e.shift()};case"unshift":return(...t)=>{const s=n.currentContext.functions.get("unshift");return s?s(e,...t):e.unshift(...t)};case"flat":return t=>e.flat(t);case"flatMap":return t=>e.flatMap(t);default:return}}isNativeConstructor(e){if(e===Date||e===Error||e===Array||e===Object||e===RegExp||e===Map||e===Set||e===Promise)return!0;if("AsyncFunction"===e.constructor.name)return!1;if(e.prototype&&e.prototype.constructor===e){const t=Object.getOwnPropertyDescriptor(e,"prototype");if(t&&!t.writable)return!0;return e.toString().includes("[native code]"),!0}return!1}async evaluateNewExpression(e){const t=await this.evaluateNode(e.callee);if("function"!=typeof t){const n=new o("constructor",t,"new expression");throw this.enhanceErrorWithContext(n,e),n}const n=[];for(const t of e.arguments)n.push(await this.evaluateNode(t));if(this.isNativeConstructor(t))return new t(...n);return await t(...n)}async evaluateArrayExpression(e){const t=[];for(const n of e.elements)if(n)if("SpreadElement"===n.type){const e=await this.evaluateNode(n.argument);if("function"!=typeof e[Symbol.iterator]&&!Array.isArray(e))throw new Error("Parse error: Spread syntax requires ...iterable[Symbol.iterator] to be a function");t.push(...e)}else t.push(await this.evaluateNode(n));else t.push(void 0);return t}async evaluateObjectExpression(e){const t={};for(const n of e.properties)if("SpreadElement"===n.type){const e=await this.evaluateNode(n.argument);Object.assign(t,e)}else if("Property"===n.type){const e=n.computed?await this.evaluateNode(n.key):n.key.name||n.key.value||n.key;n.shorthand?t[e]=this.evaluateIdentifier({name:e}):t[e]=await this.evaluateNode(n.value)}return t}async evaluateTemplateLiteral(e){const t=e.raw||e.value||"";return t.includes("${")?await this.interpolateTemplate(t):t}async interpolateTemplate(e){const t=/\$\{([^}]+)\}/g;let n,s=e;const r=[];for(;null!==(n=t.exec(e));){const e=n[1];try{const t=new f.Parser(f.Grammar.fromCompiled(v)).feed(e).results;if(t&&t.length>0){const e=t[0],s=await this.evaluateNode(e);r.push({start:n.index,end:n.index+n[0].length,value:String(s)})}else{const t=this.currentContext.variables.get(e.trim());void 0!==t&&r.push({start:n.index,end:n.index+n[0].length,value:String(t)})}}catch(t){console.warn(`Failed to evaluate template expression: ${e}`,t)}}for(let e=r.length-1;e>=0;e--){const t=r[e];s=s.slice(0,t.start)+t.value+s.slice(t.end)}return s}async evaluateTemplateExpression(e){try{const t=new f.Parser(f.Grammar.fromCompiled(v)).feed(e).results;if(t&&t.length>0)return await this.evaluateNode(t[0])}catch(t){const n=e.trim();if(/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n))return this.evaluateIdentifier({name:n})}return e}async evaluateImport(e){const t=e.source.value||e.source,n=await this.importModule(t);for(const t of e.specifiers)if("ImportNamespaceSpecifier"===t.type){const e=t.local.name||t.local;this.currentContext.variables.set(e,n)}else if("ImportSpecifier"===t.type){const e=t.imported.name||t.imported,s=t.local.name||t.local,r=n[e];this.currentContext.variables.set(s,r)}}async evaluateExport(e){if(e.declaration)if(await this.evaluateNode(e.declaration),"VariableDeclaration"===e.declaration.type){for(const t of e.declaration.declarations)if("Identifier"===t.id.type){const e=this.currentContext.variables.get(t.id.name);this.currentContext.exports.set(t.id.name,e),this.currentContext.moduleExports&&(this.currentContext.moduleExports[t.id.name]=e)}}else if("FunctionDeclaration"===e.declaration.type){const t=this.currentContext.functions.get(e.declaration.id.name);this.currentContext.exports.set(e.declaration.id.name,t),this.currentContext.moduleExports&&(this.currentContext.moduleExports[e.declaration.id.name]=t)}else if("ClassDeclaration"===e.declaration.type){const t=this.currentContext.classes.get(e.declaration.id.name);this.currentContext.exports.set(e.declaration.id.name,t),this.currentContext.moduleExports&&(this.currentContext.moduleExports[e.declaration.id.name]=t)}for(const t of e.specifiers||[]){const e=this.currentContext.variables.get(t.local)||this.currentContext.functions.get(t.local)||this.currentContext.classes.get(t.local);this.currentContext.exports.set(t.exported,e),this.currentContext.moduleExports&&(this.currentContext.moduleExports[t.exported]=e)}}async importModule(e){if(this.globalModuleCache.has(e))return this.globalModuleCache.get(e);const t={};this.globalModuleCache.set(e,t);const{code:n}=await this.moduleResolver.resolve(e),s=this.currentModulePath;this.currentModulePath=e;const r=this.createContext(this.globalContext);r.modulePath=e,r.moduleExports=t;try{await this.execute(n,r),r.exports.forEach((e,n)=>{t[n]=e})}finally{this.currentModulePath=s}return t}}E.versionLogged=!1;class w extends E{constructor(e={}){super(e),this.operationCounter=0,this.contextIdMap=new Map,this.idContextMap=new Map,this.nextContextId=0,this.pauseCheckInterval=e.pauseCheckInterval??10,this.executionState={type:"completed",callStack:[]}}pause(){"running"===this.executionState.type&&(this.executionState.pauseRequested=!0)}async resume(){if("paused"!==this.executionState.type)throw new Error("Interpreter is not paused");this.executionState.type="running",this.executionState.pauseRequested=!1;try{const e=await this.resumeFromCallStack();return this.executionState.type="completed",this.executionState.result=e,e}catch(e){throw this.executionState.type="error",this.executionState.error=e,e}}async checkPause(){if(this.operationCounter++,this.operationCounter%this.pauseCheckInterval===0&&await new Promise(e=>setTimeout(e,0)),this.executionState.pauseRequested)throw this.executionState.type="paused",this.executionState.pauseRequested=!1,{type:"pause",state:this.executionState}}async evaluateNode(e){await this.checkPause(),this.executionState.currentNode=e;let t;["FunctionDeclaration","FunctionExpression","ArrowFunctionExpression","BlockStatement","ForStatement","WhileStatement","DoWhileStatement"].includes(e.type)&&(t={type:this.getFrameType(e.type),node:e,context:this.currentContext,name:e.id?.name},this.executionState.callStack.push(t));try{const n=await super.evaluateNode(e);return t&&this.executionState.callStack.pop(),n}catch(e){if(e&&"object"==typeof e&&"pause"===e.type)throw e;throw t&&this.executionState.callStack.pop(),e}}async execute(e,t){this.executionState={type:"running",callStack:[]};const n=new f.Parser(f.Grammar.fromCompiled(v));try{if(n.feed(e),0===n.results.length)throw new Error("No parse found");n.results.length>1&&console.warn("Ambiguous grammar detected, using first parse");const s=n.results[0],r=t||this.globalContext,o=this.currentContext;this.currentContext=r;try{const e=await this.evaluateNode(s);return this.executionState.type="completed",this.executionState.result=e,e}finally{this.currentContext=o}}catch(e){if(e&&"object"==typeof e&&"pause"===e.type)return;if(e&&"object"==typeof e&&"return"===e.type)return this.executionState.type="completed",this.executionState.result=e.value,e.value;throw this.executionState.type="error",this.executionState.error=e,e}}getExecutionState(){return{...this.executionState}}serialize(){return this.assignContextIds(this.globalContext),{version:"1.0.0",globalContext:this.serializeContext(this.globalContext),currentContext:this.serializeContext(this.currentContext),executionState:this.serializeExecutionState(),moduleCache:Array.from(this.globalModuleCache.entries()),customFunctions:Array.from(this.globalContext.functions.keys())}}static async deserialize(e,t={}){const n=new w({moduleResolver:t.moduleResolver||new i,functions:t.functions});return n.deserializeContexts(e),e.moduleCache.forEach(([e,t])=>{n.globalModuleCache.set(e,t)}),n.executionState=n.deserializeExecutionState(e.executionState),n}assignContextIds(e,t=new Set){if(t.has(e))return;t.add(e);const n="ctx_"+this.nextContextId++;this.contextIdMap.set(e,n),this.idContextMap.set(n,e),e.parent&&this.assignContextIds(e.parent,t)}serializeContext(e){const t=e.parent?this.contextIdMap.get(e.parent):void 0;return{variables:Array.from(e.variables.entries()).map(([e,t])=>[e,this.serializeValue(t)]),variableKinds:Array.from(e.variableKinds.entries()),functionNames:Array.from(e.functions.keys()),classNames:Array.from(e.classes.keys()),exports:Array.from(e.exports.entries()).map(([e,t])=>[e,this.serializeValue(t)]),parentId:t,moduleCache:Array.from(e.moduleCache.entries())}}serializeValue(e){if(void 0===e)return{__type:"undefined"};if(null===e)return null;if("function"==typeof e)return{__type:"function",name:e.name||"anonymous"};if(e instanceof Date)return{__type:"Date",value:e.toISOString()};if(e instanceof RegExp)return{__type:"RegExp",source:e.source,flags:e.flags};if(e instanceof Map)return{__type:"Map",entries:Array.from(e.entries())};if(e instanceof Set)return{__type:"Set",values:Array.from(e.values())};if("object"==typeof e)try{return JSON.parse(JSON.stringify(e))}catch{return{__type:"circular_reference"}}return e}deserializeValue(e){if(e&&"object"==typeof e&&"__type"in e)switch(e.__type){case"undefined":return;case"function":return()=>{throw new Error(`Function ${e.name} needs to be re-bound`)};case"Date":return new Date(e.value);case"RegExp":return new RegExp(e.source,e.flags);case"Map":return new Map(e.entries);case"Set":return new Set(e.values);case"circular_reference":return null}return e}serializeExecutionState(){return{...this.executionState,callStack:this.executionState.callStack.map(e=>({...e,context:this.serializeContext(e.context)}))}}deserializeExecutionState(e){return{...e,callStack:e.callStack.map(e=>({...e,context:this.idContextMap.get(e.context.parentId)||this.currentContext}))}}deserializeContexts(e){const t=new Map,n=this.createContext();if(this.restoreContextData(n,e.globalContext),t.set("global",n),this.globalContext=n,e.currentContext===e.globalContext)this.currentContext=n;else{const n=this.createContext();this.restoreContextData(n,e.currentContext),t.set("current",n),this.currentContext=n}e.currentContext.parentId&&(this.currentContext.parent=t.get(e.currentContext.parentId))}restoreContextData(e,t){t.variables.forEach(([t,n])=>{const s=this.deserializeValue(n);e.variables.set(t,s)}),t.variableKinds.forEach(([t,n])=>{e.variableKinds.set(t,n)}),t.variables.some(([e])=>"Date"===e)&&e.variables.set("Date",Date),t.variables.some(([e])=>"Error"===e)&&e.variables.set("Error",Error),t.exports.forEach(([t,n])=>{e.exports.set(t,this.deserializeValue(n))}),t.moduleCache.forEach(([t,n])=>{e.moduleCache.set(t,n)})}getFrameType(e){switch(e){case"FunctionDeclaration":case"FunctionExpression":case"ArrowFunctionExpression":return"function";case"BlockStatement":default:return"block";case"ForStatement":case"WhileStatement":case"DoWhileStatement":return"loop";case"Program":return"program"}}async resumeFromCallStack(){const e=this.executionState.callStack[this.executionState.callStack.length-1];if(!e)throw new Error("No frame to resume from");return this.currentContext=e.context,this.evaluateNode(e.node)}getCallStackTrace(){return this.executionState.callStack.map(e=>{const t=e.name||"<anonymous>";return`${e.type}: ${t}`})}getCurrentVariables(){const e={};let t=this.currentContext;for(;t;)t.variables.forEach((t,n)=>{n in e||(e[n]=t)}),t=t.parent;return e}isPaused(){return"paused"===this.executionState.type}isRunning(){return"running"===this.executionState.type}isCompleted(){return"completed"===this.executionState.type}hasError(){return"error"===this.executionState.type}}class S{validate(e,t={}){try{const n=new f.Parser(f.Grammar.fromCompiled(v)),s=5e4,r=1e3;if(e.length>s)return{valid:!1,error:{message:`Code is too large (${e.length} characters). Maximum supported size is ${s} characters.`,line:1,column:1,suggestion:"Consider splitting your code into multiple modules or files"}};const o=Date.now(),a=5e3;try{n.feed(e)}catch(e){if(Date.now()-o>a)return{valid:!1,error:{message:"Parse timeout: Code structure is too complex for the parser to handle efficiently.",line:1,column:1,suggestion:"Try breaking complex nested expressions into separate statements"}};throw e}return 0===n.results.length?{valid:!1,error:{message:"No valid parse found",line:0,column:0}}:n.results.length>r?{valid:!1,error:{message:`Code is too ambiguous: ${n.results.length} possible interpretations found (maximum: ${r}).`,line:1,column:1,suggestion:"Simplify complex expressions, especially nested ternary operators and object literals with logical OR operators"}}:(n.results.length>1&&console.warn(`Grammar ambiguity: ${n.results.length} possible parses found`),{valid:!0,ast:t.includeAST?n.results[0]:void 0})}catch(t){return t.message&&(t.message.includes("Maximum call stack")||t.message.includes("out of memory"))?{valid:!1,error:{message:"Parser ran out of memory: Code contains expressions that are too complex to parse.",line:1,column:1,suggestion:"Break down complex nested expressions, especially combinations of ternary operators, logical OR, and object literals"}}:this.formatError(t,e)}}formatError(e,t){const n=e.message||e.toString(),s=n.match(/line (\d+) col (\d+)/),r=s?parseInt(s[1]):0,o=s?parseInt(s[2]):0,a=t.split("\n");let i,l="";if(s&&r>0){l=`Parse error: Syntax error at line ${r} col ${o}:\n\n`;const e=Math.max(0,r-3),t=Math.min(a.length,r);for(let n=e;n<t;n++){const e=n+1,t=a[n];l+=`${String(e).padStart(String(r).length," ")} ${t}\n`}l+=" ".repeat(String(r).length+o)+"^\n";const s=n.match(/Unexpected (.+?) token: "(.+?)"/);s&&(l+=`Unexpected ${s[1]} token: "${s[2]}". `);const i=n.match(/Instead, I was expecting to see one of the following:([\s\S]*)/);if(i){l+="Instead, I was expecting to see one of the following:\n";const e=i[1].trim(),t=e.split("\n").slice(0,10);for(const e of t)e.trim()&&(l+="\n"+e);e.split("\n").length>10&&(l+="\n... and more")}}else l=n;return(n.includes("Unexpected identifier")||n.includes("Unexpected /"))&&r>0&&a[r-1]&&a[r-1].includes("match(")?i='This appears to be a regex pattern containing HTML tags (e.g., </a>). The parser may be interpreting "</" as operators. Try escaping the forward slash in closing tags: "<\\/a>" instead of "</a>".':n.includes("Unexpected ) token")||n.includes("Unexpected }")?i="Check for missing commas between object properties, or a missing closing brace/bracket earlier in the code.":n.includes("Unexpected NL token")&&n.includes("=>")?i='Arrow functions with newlines require braces. Change "=> \\n expression" to either "=> expression" (single line) or "=> { return expression }" (with braces).':n.includes("Unexpected NL token")&&n.includes("ArrowBody")?i="Multi-line arrow function bodies must use braces. Wrap your expression in { return ... }":n.includes("Unexpected identifier")&&(i="Check for missing operators, commas, or semicolons between statements."),{valid:!1,error:{message:l,line:r,column:o,suggestion:i}}}checkSyntaxPatterns(e){return{hasMultilineArrows:/=>\s*\n\s*[^{]/.test(e),hasAsyncAwait:/\basync\b|\bawait\b/.test(e),hasClasses:/\bclass\b/.test(e),hasModules:/\bimport\b|\bexport\b/.test(e)}}suggestFixes(e){const t=[];return this.checkSyntaxPatterns(e).hasMultilineArrows&&t.push("Found multi-line arrow functions without braces. Consider using braces for multi-line arrow function bodies."),/\)\s*\n\s*{/.test(e)&&!/"function"/.test(e)&&t.push("Found newline between closing parenthesis and opening brace. This might cause parsing issues in some contexts."),/,\s*}/.test(e)&&t.push("Found trailing comma before closing brace. While valid in JavaScript, ensure Wang supports this."),t}}const L=new S;e.CircularDependencyError=class extends s{constructor(e){super(`Circular dependency detected:\n   ${e.join(" → ")} → ${e[0]}`,{type:"ModuleError",suggestions:["Move shared code to a separate module","Use dynamic imports for one direction","Refactor to remove the circular dependency"]})}},e.FunctionNotFoundError=class extends s{constructor(e,t){const n=[],s=t.filter(t=>t.includes(e)||e.includes(t)).slice(0,5);s.length>0&&n.push(`Available similar functions: ${s.join(", ")}`),n.push("Check the function name spelling"),n.push("Ensure the function is imported or defined"),n.push(`Available functions: ${t.slice(0,10).join(", ")}...`),super(`Function "${e}" is not defined`,{type:"RuntimeError",suggestions:n})}},e.InMemoryModuleResolver=i,e.ModuleNotFoundError=r,e.ModuleResolver=t,e.PausableWangInterpreter=w,e.TypeMismatchError=o,e.UndefinedVariableError=a,e.VERSION="0.21.8",e.WangError=s,e.WangInterpreter=E,e.WangValidator=S,e.createInterpreter=function(e){return new E(e)},e.validator=L});
//# sourceMappingURL=wang.min.js.map
