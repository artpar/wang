!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Wang={})}(this,function(e){"use strict";function t(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(s){if("default"!==s&&!(s in e)){var n=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,n.get?n:{enumerable:!0,get:function(){return t[s]}})}})}),Object.freeze(e)}class s{}function n(e,t=".wang"){return e.endsWith(t)||e.includes(".")?e:e+t}class r extends Error{constructor(e,t={type:"RuntimeError"},s){super(e),this.name="WangError",this.context=t,this.originalError=s,Error.captureStackTrace&&Error.captureStackTrace(this,r)}toString(){return this.message}getFormattedMessage(e){let t=this.message;return this.context.suggestions&&this.context.suggestions.length>0&&(t+="\n\nðŸ’¡ Suggestions:\n",this.context.suggestions.forEach((e,s)=>{t+=`   ${s+1}. ${e}\n`})),this.context.variables&&Object.keys(this.context.variables).length>0&&(t+="\n\nðŸ“Š Variables in scope:\n",Object.entries(this.context.variables).forEach(([e,s])=>{const n=this.formatValue(s);t+=`   â€¢ ${e}: ${n}\n`})),this.context.stackTrace&&this.context.stackTrace.length>0&&(t+="\n\nðŸ“ Stack trace:\n",this.context.stackTrace.forEach(e=>{t+=`   ${e}\n`})),t}formatValue(e){return null===e?"null":void 0===e?"undefined":"string"==typeof e?`"${e}"`:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?`[array of ${e.length} items]`:"object"==typeof e?`{${Object.keys(e).join(", ")}}`:typeof e}}class o extends r{constructor(e,t=[]){const s=[];if(t.length>0){const n=t.filter(t=>t.includes(e.split("/").pop()||"")).slice(0,3);n.length>0&&s.push(`Did you mean one of these? ${n.join(", ")}`)}s.push("Check that the module path is correct"),s.push("Ensure the module has been added to the resolver"),super(`Module not found: "${e}"`,{type:"ModuleError",suggestions:s})}}class a extends r{constructor(e,t,s){const n=typeof t;let r="undefined";try{r=void 0===t?"undefined":null===t?"null":JSON.stringify(t).substring(0,50)}catch(e){r=String(t).substring(0,50)}super(`Type mismatch in ${s}:\n   Expected: ${e}\n   Received: ${n} (${r})`,{type:"RuntimeError",suggestions:[`Check that the value is of type ${e}`,"Use type conversion if necessary","Verify the data source"]})}}class i extends r{constructor(e,t){const s=[],n=t.filter(t=>t.includes(e)||e.includes(t)).slice(0,3);n.length>0&&s.push(`Did you mean: ${n.join(", ")}?`),s.push("Check for typos in the variable name"),s.push("Ensure the variable is declared before use"),super(`Variable "${e}" is not defined`,{type:"RuntimeError",suggestions:s,variables:Object.fromEntries(t.slice(0,10).map(e=>[e,"..."]))})}}class l extends s{constructor(){super(),this.modules=new Map,this.metadata=new Map}addModule(e,t,s){const r=n(e);return this.modules.set(r,t),s&&this.metadata.set(r,s),this}addModules(e){return Object.entries(e).forEach(([e,t])=>{this.addModule(e,t)}),this}removeModule(e){const t=n(e);return this.metadata.delete(t),this.modules.delete(t)}async resolve(e,t){const s=function(e,t){return t&&e.startsWith(".")?function(e){const t=e.split("/"),s=[];for(const e of t)".."===e?s.pop():e&&"."!==e&&s.push(e);return s.join("/")}(t.split("/").slice(0,-1).join("/")+"/"+e):e}(e,t),r=n(s);if(this.modules.has(r))return{code:this.modules.get(r),path:r,metadata:this.metadata.get(r)};if(this.modules.has(s))return{code:this.modules.get(s),path:s,metadata:this.metadata.get(s)};const a=n(s+"/index");if(this.modules.has(a))return{code:this.modules.get(a),path:a,metadata:this.metadata.get(a)};const i=await this.list();throw new o(e,i)}async exists(e,t){try{return await this.resolve(e,t),!0}catch{return!1}}async list(e){const t=Array.from(this.modules.keys());return e?t.filter(t=>t.startsWith(e)):t}clearCache(){this.modules.clear(),this.metadata.clear()}async getMetadata(e){const t=n(e);return this.metadata.get(t)||null}get size(){return this.modules.size}get isEmpty(){return 0===this.modules.size}exportModules(){const e={};return this.modules.forEach((t,s)=>{e[s]={code:t,metadata:this.metadata.get(s)}}),e}importModules(e){return Object.entries(e).forEach(([e,{code:t,metadata:s}])=>{this.modules.set(e,t),s&&this.metadata.set(e,s)}),this}}function c(e){const t=[...e];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}function u(e){return e.reduce((e,t)=>e+t,0)}function p(e){return new Promise(t=>setTimeout(t,e))}const m={sort_by:function(e,t){const s=[...e];if(!t)return s.sort();const n="string"==typeof t?e=>e?.[t]:t;return s.sort((e,t)=>{const s=n(e),r=n(t);return s<r?-1:s>r?1:0})},reverse:function(e){return[...e].reverse()},unique:function(e){return[...new Set(e)]},unique_by:function(e,t){const s="string"==typeof t?e=>e?.[t]:t,n=new Set,r=[];for(const t of e){const e=s(t);n.has(e)||(n.add(e),r.push(t))}return r},group_by:function(e,t){const s="string"==typeof t?e=>e?.[t]:t,n={};for(const t of e){const e=String(s(t));n[e]||(n[e]=[]),n[e].push(t)}return n},chunk:function(e,t=1){const s=[];for(let n=0;n<e.length;n+=t)s.push(e.slice(n,n+t));return s},flatten:function e(t,s=1){return s<=0?[...t]:t.reduce((t,n)=>Array.isArray(n)?t.concat(e(n,s-1)):t.concat(n),[])},first:function(e,t=1){return 1===t?e[0]:e.slice(0,t)},last:function(e,t=1){return 1===t?e[e.length-1]:e.slice(-t)},take:function(e,t){return e.slice(0,t)},drop:function(e,t){return e.slice(t)},shuffle:c,sample:function(e,t=1){const s=c(e);return 1===t?s[0]:s.slice(0,t)},zip:function(...e){const t=Math.min(...e.map(e=>e.length)),s=[];for(let n=0;n<t;n++)s.push(e.map(e=>e[n]));return s},partition:function(e,t){const s=[],n=[];for(const r of e)(t(r)?s:n).push(r);return[s,n]},keys:function(e){return Object.keys(e||{})},values:function(e){return Object.values(e||{})},entries:function(e){return Object.entries(e||{})},pick:function(e,t){const s={};for(const n of t)n in e&&(s[n]=e[n]);return s},omit:function(e,t){const s={...e};for(const e of t)delete s[e];return s},merge:function(...e){return Object.assign({},...e)},get:function(e,t,s){if("number"==typeof t){const n=e?.[t];return void 0===n?s:n}const n=String(t).split(".");let r=e;for(const e of n){if(null==r)return s;r=r[e]}return void 0===r?s:r},set:function(e,t,s){const n=t.split("."),r={...e};let o=r;for(let e=0;e<n.length-1;e++){const t=n[e];t in o&&"object"==typeof o[t]||(o[t]={}),o[t]={...o[t]},o=o[t]}return o[n[n.length-1]]=s,r},clone:function e(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t))return t.map(t=>e(t));const s={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=e(t[n]));return s},split:function(e,t=""){return e.split(t)},join:function(e,t=","){return e.join(t)},trim:function(e){return e.trim()},trim_start:function(e){return e.trimStart()},trim_end:function(e){return e.trimEnd()},replace_all:function(e,t,s){return e.split(t).join(s)},upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},starts_with:function(e,t){return e.startsWith(t)},ends_with:function(e,t){return e.endsWith(t)},includes:function(e,t){return e.includes(t)},pad_start:function(e,t,s=" "){return e.padStart(t,s)},pad_end:function(e,t,s=" "){return e.padEnd(t,s)},truncate:function(e,t,s="..."){return e.length<=t?e:e.slice(0,t-s.length)+s},map:async function(e,t){const s=[];for(let n=0;n<e.length;n++)s.push(await t(e[n],n));return s},filter:async function(e,t){const s=[];for(let n=0;n<e.length;n++)await t(e[n],n)&&s.push(e[n]);return s},reduce:async function(e,t,s){let n=arguments.length>2?s:e[0];for(let s=arguments.length>2?0:1;s<e.length;s++)n=await t(n,e[s],s);return n},find:async function(e,t){for(let s=0;s<e.length;s++)if(await t(e[s],s))return e[s]},find_index:async function(e,t){for(let s=0;s<e.length;s++)if(await t(e[s],s))return s;return-1},every:async function(e,t){for(let s=0;s<e.length;s++)if(!await t(e[s],s))return!1;return!0},some:async function(e,t){for(let s=0;s<e.length;s++)if(await t(e[s],s))return!0;return!1},count:async function(e,t){if(!t)return e.length;let s=0;for(const n of e)await t(n)&&s++;return s},is_array:function(e){return Array.isArray(e)},is_object:function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)},is_string:function(e){return"string"==typeof e},is_number:function(e){return"number"==typeof e&&!isNaN(e)},is_boolean:function(e){return"boolean"==typeof e},is_function:function(e){return"function"==typeof e},is_null:function(e){return null===e},is_empty:function(e){return null==e||(Array.isArray(e)||"string"==typeof e?0===e.length:"object"==typeof e&&0===Object.keys(e).length)},min:function(e){return 0===e.length?1/0:Math.min(...e)},max:function(e){return 0===e.length?-1/0:Math.max(...e)},sum:u,avg:function(e){return 0===e.length?0:u(e)/e.length},median:function(e){if(0===e.length)return 0;const t=[...e].sort((e,t)=>e-t),s=Math.floor(t.length/2);return t.length%2==0?(t[s-1]+t[s])/2:t[s]},round:function(e,t=0){const s=Math.pow(10,t);return Math.round(e*s)/s},floor:function(e){return Math.floor(e)},ceil:function(e){return Math.ceil(e)},abs:function(e){return Math.abs(e)},clamp:function(e,t,s){return Math.min(Math.max(e,t),s)},range:function(e,t,s=1){void 0===t&&(t=e,e=0);const n=[];if(s>0)for(let r=e;r<t;r+=s)n.push(r);else if(s<0)for(let r=e;r>t;r+=s)n.push(r);return n},sleep:p,wait:function(e){return p(e)},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},to_json:function(e,t=!1){return t?JSON.stringify(e,null,2):JSON.stringify(e)},from_json:function(e){return JSON.parse(e)},to_base64:function(e){return"undefined"!=typeof btoa?btoa(e):Buffer.from(e,"utf8").toString("base64")},from_base64:function(e){return"undefined"!=typeof atob?atob(e):Buffer.from(e,"base64").toString("utf8")}};var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y={exports:{}},h={exports:{}};!function(e){var t,s;t=f,s=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,s="boolean"==typeof(new RegExp).sticky;function n(e){return e&&"[object RegExp]"===t.call(e)}function r(e){return e&&"object"==typeof e&&!n(e)&&!Array.isArray(e)}function o(e){return new RegExp("|"+e).exec("").length-1}function a(e){return"("+e+")"}function i(e){return e.length?"(?:"+e.map(function(e){return"(?:"+e+")"}).join("|")+")":"(?!)"}function l(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function c(e,t){return e.length>t?e:Array(t-e.length+1).join(" ")+e}function u(t,s){if(r(s)||(s={match:s}),s.include)throw new Error("Matching rules cannot also include states");var o={defaultType:t,lineBreaks:!!s.error||!!s.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var a in s)e.call(s,a)&&(o[a]=s[a]);if("string"==typeof o.type&&t!==o.type)throw new Error("Type transform cannot be a string (type '"+o.type+"' for token '"+t+"')");var i=o.match;return o.match=Array.isArray(i)?i:i?[i]:[],o.match.sort(function(e,t){return n(e)&&n(t)?0:n(t)?-1:n(e)?1:t.length-e.length}),o}function p(e){return Array.isArray(e)?function(e){for(var t=[],s=0;s<e.length;s++){var n=e[s];if(n.include)for(var r=[].concat(n.include),o=0;o<r.length;o++)t.push({include:r[o]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));t.push(u(n.type,n))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),s=[],n=0;n<t.length;n++){var o=t[n],a=e[o],i=[].concat(a);if("include"!==o){var l=[];i.forEach(function(e){r(e)?(l.length&&s.push(u(o,l)),s.push(u(o,e)),l=[]):l.push(e)}),l.length&&s.push(u(o,l))}else for(var c=0;c<i.length;c++)s.push({include:i[c]})}return s}(e)}var m=u("error",{lineBreaks:!0,shouldThrow:!0});function f(e,t){for(var r=null,c=Object.create(null),u=!0,p=null,f=[],y=[],h=0;h<e.length;h++)e[h].fallback&&(u=!1);for(h=0;h<e.length;h++){var b=e[h];if(b.include)throw new Error("Inheritance is not allowed in stateless lexers");if(b.error||b.fallback){if(r)throw!b.fallback==!r.fallback?new Error("Multiple "+(b.fallback?"fallback":"error")+" rules not allowed (for token '"+b.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+b.defaultType+"')");r=b}var d=b.match.slice();if(u)for(;d.length&&"string"==typeof d[0]&&1===d[0].length;)c[d.shift().charCodeAt(0)]=b;if(b.pop||b.push||b.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+b.defaultType+"')");if(b.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+b.defaultType+"')")}if(0!==d.length){u=!1,f.push(b);for(var x=0;x<d.length;x++){var v=d[x];if(n(v))if(null===p)p=v.unicode;else if(p!==v.unicode&&!1===b.fallback)throw new Error("If one rule is /u then all must be")}var g=i(d.map(l)),E=new RegExp(g);if(E.test(""))throw new Error("RegExp matches empty string: "+E);if(o(g)>0)throw new Error("RegExp has capture groups: "+E+"\nUse (?: â€¦ ) instead");if(!b.lineBreaks&&E.test("\n"))throw new Error("Rule should declare lineBreaks: "+E);y.push(a(g))}}var w=r&&r.fallback,$=s&&!w?"ym":"gm",C=s||w?"":"|";return!0===p&&($+="u"),{regexp:new RegExp(i(y)+C,$),groups:f,fast:c,error:r||m}}function y(e,t,s){var n=e&&(e.push||e.next);if(n&&!s[n])throw new Error("Missing state '"+n+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!==+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var h=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};h.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedText=t?t.queuedText:"",this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},h.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},h.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},h.prototype.popState=function(){this.setState(this.stack.pop())},h.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var b=s?function(e,t){return e.exec(t)}:function(e,t){var s=e.exec(t);return 0===s[0].length?null:s};function d(){return this.value}if(h.prototype._getGroup=function(e){for(var t=this.groups.length,s=0;s<t;s++)if(void 0!==e[s+1])return this.groups[s];throw new Error("Cannot find token type for matched text")},h.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var s=this.buffer;if(e!==s.length){if(a=this.fast[s.charCodeAt(e)])return this._token(a,s.charAt(e),e);var n=this.re;n.lastIndex=e;var r=b(n,s),o=this.error;if(null==r)return this._token(o,s.slice(e,s.length),e);var a=this._getGroup(r),i=r[0];return o.fallback&&r.index!==e?(this.queuedGroup=a,this.queuedText=i,this._token(o,s.slice(e,r.index),e)):this._token(a,i,e)}},h.prototype._token=function(e,t,s){var n=0;if(e.lineBreaks){var r=/\n/g,o=1;if("\n"===t)n=1;else for(;r.exec(t);)n++,o=r.lastIndex}var a={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:d,offset:s,lineBreaks:n,line:this.line,col:this.col},i=t.length;if(this.index+=i,this.line+=n,0!==n?this.col=i-o+1:this.col+=i,e.shouldThrow)throw new Error(this.formatError(a,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),a},"undefined"!=typeof Symbol&&Symbol.iterator){var x=function(e){this.lexer=e};x.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},x.prototype[Symbol.iterator]=function(){return this},h.prototype[Symbol.iterator]=function(){return new x(this)}}return h.prototype.formatError=function(e,t){if(null==e){var s=this.buffer.slice(this.index);e={text:s,offset:this.index,lineBreaks:-1===s.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(e.line-2,1),r=e.line+2,o=String(r).length,a=function(e,t){for(var s=e.length,n=0;;){var r=e.lastIndexOf("\n",s-1);if(-1===r)break;if(s=r,++n===t)break;if(0===s)break}var o=n<t?0:s+1;return e.substring(o).split("\n")}(this.buffer,this.line-e.line+2+1).slice(0,5),i=[];i.push(t+" at line "+e.line+" col "+e.col+":"),i.push("");for(var l=0;l<a.length;l++){var u=a[l],p=n+l;i.push(c(String(p),o)+"  "+u),p===e.line&&i.push(c("",o+e.col+1)+"^")}return i.join("\n")},h.prototype.clone=function(){return new h(this.states,this.state)},h.prototype.has=function(e){return!0},{compile:function(e){var t=f(p(e));return new h({start:t},"start")},states:function(e,t){var s=e.$all?p(e.$all):[];delete e.$all;var n=Object.getOwnPropertyNames(e);t||(t=n[0]);for(var r=Object.create(null),o=0;o<n.length;o++)r[v=n[o]]=p(e[v]).concat(s);for(o=0;o<n.length;o++)for(var a=r[v=n[o]],i=Object.create(null),l=0;l<a.length;l++){var c=a[l];if(c.include){var u=[l,1];if(c.include!==v&&!i[c.include]){i[c.include]=!0;var m=r[c.include];if(!m)throw new Error("Cannot include nonexistent state '"+c.include+"' (in state '"+v+"')");for(var b=0;b<m.length;b++){var d=m[b];-1===a.indexOf(d)&&u.push(d)}}a.splice.apply(a,u),l--}}var x=Object.create(null);for(o=0;o<n.length;o++){var v;x[v=n[o]]=f(r[v],!0)}for(o=0;o<n.length;o++){var g=n[o],E=x[g],w=E.groups;for(l=0;l<w.length;l++)y(w[l],g,x);var $=Object.getOwnPropertyNames(E.fast);for(l=0;l<$.length;l++)y(E.fast[$[l]],g,x)}return new h(x,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t="undefined"!=typeof Map,s=t?new Map:Object.create(null),n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var o=n[r],a=e[o];(Array.isArray(a)?a:[a]).forEach(function(e){if("string"!=typeof e)throw new Error("keyword must be string (in keyword '"+o+"')");t?s.set(e,o):s[e]=o})}return function(e){return t?s.get(e):s[e]}}}},e.exports?e.exports=s():t.moo=s()}(h);var b=h.exports;!function(e){!function(){function t(e){return e[0]}const s=b,n=s.compile({WS:/[ \t\r]+/u,NL:{match:/\n/u,lineBreaks:!0},lineComment:/\/\/.*$/u,blockComment:{match:/\/\*[^]*?\*\//u,lineBreaks:!0},string:[{match:/"(?:[^"\\]|\\[^])*"/u,value:e=>e.slice(1,-1).replace(/\\(.)/g,(e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";case"r":return"\r";case"\\":return"\\";case'"':return'"';case"'":return"'";default:return t}})},{match:/'(?:[^'\\]|\\[^])*'/u,value:e=>e.slice(1,-1).replace(/\\(.)/g,(e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";case"r":return"\r";case"\\":return"\\";case'"':return'"';case"'":return"'";default:return t}})}],templateLiteral:{match:/`(?:[^`\\]|\\[^])*`/u,value:e=>e.slice(1,-1)},regex:{match:/\/(?:\\[^]|[^\s\/])(?:[^\/\\\r\n]|\\[^])*\/[gimsuy]*/u,value:e=>{const t=e.lastIndexOf("/");return{pattern:e.slice(1,t),flags:e.slice(t+1)}}},number:{match:/(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/u,value:e=>parseFloat(e)},identifier:{match:/[\p{L}\p{Nl}$_][\p{L}\p{Mn}\p{Mc}\p{Nd}\p{Pc}$_]*/u,type:s.keywords({let:"let",const:"const",var:"var",if:"if",else:"else",for:"for",while:"while",do:"do",break:"break",continue:"continue",return:"return",function:"function",class:"class",extends:"extends",constructor:"constructor",async:"async",await:"await",import:"import",export:"export",from:"from",as:"as",try:"try",catch:"catch",finally:"finally",throw:"throw",true:"true",false:"false",null:"null",undefined:"undefined",this:"this",super:"super",new:"new",typeof:"typeof",instanceof:"instanceof",in:"in",of:"of"})},"+=":/\+=/u,"-=":/-=/u,"*=":/\*=/u,"/=":/\/=/u,"===":/===/u,"!==":/!==/u,"==":/==/u,"!=":/!=/u,"<=":/<=/u,">=":/>=/u,"<<":/<</u,">>":/>>/u,">>>":/>>>/u,"&&":/&&/u,"||":/\|\|/u,"??":/\?\?/u,"?.":/\?\./u,"...":/\.\.\./u,"++":/\+\+/u,"--":/--/u,"**":/\*\*/u,"|>":/\|>/u,"->":/->/u,"=>":/=>/u,"=":/=/u,"<":/</u,">":/>/u,"+":/\+/u,"-":/-/u,"*":/\*/u,"/":/\//u,"%":/%/u,"&":/&/u,"|":/\|/u,"^":/\^/u,"~":/~/u,"!":/!/u,"?":/\?/u,":":/:/u,"(":/\(/u,")":/\)/u,"[":/\[/u,"]":/\]/u,"{":/\{/u,"}":/\}/u,",":/,/u,".":/\./u,";":/;/u});var r;function o(e,t={}){return{type:e,...t}}function a(e,t,s){return o("BinaryExpression",{operator:t,left:e,right:s})}function i(e){return o("Identifier",{name:e})}function l(e,t){return o("Literal",{value:e,raw:t})}n.next=(r=n.next,()=>{let e;for(;(e=r.call(n))&&("WS"===e.type||"lineComment"===e.type||"blockComment"===e.type););return e});var c={Lexer:n,ParserRules:[{name:"Program",symbols:["StatementList"],postprocess:e=>o("Program",{body:e[0]})},{name:"StatementList",symbols:[],postprocess:()=>[]},{name:"StatementList",symbols:["Statement"],postprocess:e=>[e[0]]},{name:"StatementList",symbols:["StatementList",n.has("NL")?{type:"NL"}:NL,"Statement"],postprocess:e=>[...e[0],e[2]]},{name:"StatementList",symbols:["StatementList",n.has("NL")?{type:"NL"}:NL],postprocess:e=>e[0]},{name:"Statement",symbols:["Declaration"],postprocess:t},{name:"Statement",symbols:["LabeledStatement"],postprocess:t},{name:"Statement",symbols:["ControlStatement"],postprocess:t},{name:"Statement",symbols:["ExpressionStatement"],postprocess:t},{name:"Statement",symbols:["Block"],postprocess:t},{name:"Statement",symbols:["PipelineContinuation"],postprocess:t},{name:"Statement",symbols:["MemberContinuation"],postprocess:t},{name:"PipelineContinuation$subexpression$1",symbols:[{literal:"|>"}]},{name:"PipelineContinuation$subexpression$1",symbols:[{literal:"->"}]},{name:"PipelineContinuation$ebnf$1",symbols:[]},{name:"PipelineContinuation$ebnf$1",symbols:["PipelineContinuation$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PipelineContinuation",symbols:["PipelineContinuation$subexpression$1","PipelineContinuation$ebnf$1","AssignmentExpression"],postprocess:e=>o("PipelineContinuation",{operator:e[0][0].value,right:e[2]})},{name:"MemberContinuation$ebnf$1",symbols:["Arguments"],postprocess:t},{name:"MemberContinuation$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"MemberContinuation",symbols:[{literal:"."},"PropertyName","MemberContinuation$ebnf$1"],postprocess:e=>o("MemberContinuation",{property:i(e[1].value),arguments:e[2]||null})},{name:"MemberContinuation$ebnf$2",symbols:["Arguments"],postprocess:t},{name:"MemberContinuation$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"MemberContinuation",symbols:[{literal:"?."},"PropertyName","MemberContinuation$ebnf$2"],postprocess:e=>o("MemberContinuation",{property:i(e[1].value),arguments:e[2]||null,optional:!0})},{name:"LabeledStatement",symbols:[n.has("identifier")?{type:"identifier"}:identifier,{literal:":"},"LoopStatement"],postprocess:e=>o("LabeledStatement",{label:i(e[0].value),body:e[2]})},{name:"LoopStatement",symbols:["WhileStatement"],postprocess:t},{name:"LoopStatement",symbols:["DoWhileStatement"],postprocess:t},{name:"LoopStatement",symbols:["ForStatement"],postprocess:t},{name:"Declaration",symbols:["VariableDeclaration"],postprocess:t},{name:"Declaration",symbols:["FunctionDeclaration"],postprocess:t},{name:"Declaration",symbols:["ClassDeclaration"],postprocess:t},{name:"Declaration",symbols:["ImportDeclaration"],postprocess:t},{name:"Declaration",symbols:["ExportDeclaration"],postprocess:t},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"let"}]},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"const"}]},{name:"VariableDeclaration$subexpression$1",symbols:[{literal:"var"}]},{name:"VariableDeclaration",symbols:["VariableDeclaration$subexpression$1","VariableDeclaratorList"],postprocess:e=>o("VariableDeclaration",{kind:e[0][0].value,declarations:e[1]})},{name:"VariableDeclaratorList",symbols:["VariableDeclarator"],postprocess:e=>[e[0]]},{name:"VariableDeclaratorList",symbols:["VariableDeclaratorList",{literal:","},"VariableDeclarator"],postprocess:e=>[...e[0],e[2]]},{name:"VariableDeclarator$ebnf$1$subexpression$1",symbols:[{literal:"="},"AssignmentExpression"]},{name:"VariableDeclarator$ebnf$1",symbols:["VariableDeclarator$ebnf$1$subexpression$1"],postprocess:t},{name:"VariableDeclarator$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"VariableDeclarator",symbols:["BindingPattern","VariableDeclarator$ebnf$1"],postprocess:e=>o("VariableDeclarator",{id:e[0],init:e[1]?e[1][1]:null})},{name:"BindingPattern",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>i(e[0].value)},{name:"BindingPattern",symbols:["ArrayPattern"],postprocess:t},{name:"BindingPattern",symbols:["ObjectPattern"],postprocess:t},{name:"ArrayPattern",symbols:[{literal:"["},"ArrayPatternElementList",{literal:"]"}],postprocess:e=>o("ArrayPattern",{elements:e[1]})},{name:"ArrayPatternElementList",symbols:[],postprocess:()=>[]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElement"],postprocess:e=>[e[0]]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElementList",{literal:","},"ArrayPatternElement"],postprocess:e=>[...e[0],e[2]]},{name:"ArrayPatternElementList",symbols:["ArrayPatternElementList",{literal:","}],postprocess:e=>[...e[0],null]},{name:"ArrayPatternElement",symbols:["BindingPattern"],postprocess:t},{name:"ArrayPatternElement",symbols:[{literal:"..."},"BindingPattern"],postprocess:e=>o("RestElement",{argument:e[1]})},{name:"ObjectPattern",symbols:[{literal:"{"},"ObjectPatternPropertyList",{literal:"}"}],postprocess:e=>o("ObjectPattern",{properties:e[1]})},{name:"ObjectPatternPropertyList",symbols:[],postprocess:()=>[]},{name:"ObjectPatternPropertyList",symbols:["ObjectPatternProperty"],postprocess:e=>[e[0]]},{name:"ObjectPatternPropertyList",symbols:["ObjectPatternPropertyList",{literal:","},"ObjectPatternProperty"],postprocess:e=>[...e[0],e[2]]},{name:"ObjectPatternProperty",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>o("Property",{key:i(e[0].value),value:i(e[0].value),shorthand:!0})},{name:"ObjectPatternProperty",symbols:["PropertyKey",{literal:":"},"BindingPattern"],postprocess:e=>o("Property",{key:e[0],value:e[2],shorthand:!1})},{name:"FunctionDeclaration$ebnf$1",symbols:[{literal:"async"}],postprocess:t},{name:"FunctionDeclaration$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"FunctionDeclaration",symbols:["FunctionDeclaration$ebnf$1",{literal:"function"},n.has("identifier")?{type:"identifier"}:identifier,{literal:"("},"ParameterList",{literal:")"},"Block"],postprocess:e=>o("FunctionDeclaration",{async:!!e[0],id:i(e[2].value),params:e[4],body:e[6]})},{name:"ParameterList",symbols:[],postprocess:()=>[]},{name:"ParameterList",symbols:["Parameter"],postprocess:e=>[e[0]]},{name:"ParameterList",symbols:["ParameterList",{literal:","},"Parameter"],postprocess:e=>[...e[0],e[2]]},{name:"Parameter",symbols:["BindingPattern"],postprocess:t},{name:"Parameter",symbols:["BindingPattern",{literal:"="},"AssignmentExpression"],postprocess:e=>o("AssignmentPattern",{left:e[0],right:e[2]})},{name:"Parameter",symbols:[{literal:"..."},"BindingPattern"],postprocess:e=>o("RestElement",{argument:e[1]})},{name:"ClassDeclaration$ebnf$1$subexpression$1",symbols:[{literal:"extends"},n.has("identifier")?{type:"identifier"}:identifier]},{name:"ClassDeclaration$ebnf$1",symbols:["ClassDeclaration$ebnf$1$subexpression$1"],postprocess:t},{name:"ClassDeclaration$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ClassDeclaration",symbols:[{literal:"class"},n.has("identifier")?{type:"identifier"}:identifier,"ClassDeclaration$ebnf$1","ClassBody"],postprocess:e=>o("ClassDeclaration",{id:i(e[1].value),superClass:e[2]?i(e[2][1].value):null,body:e[3]})},{name:"ClassBody",symbols:[{literal:"{"},"ClassMemberListWithNewlines",{literal:"}"}],postprocess:e=>o("ClassBody",{body:e[1]})},{name:"ClassMemberListWithNewlines$ebnf$1",symbols:[]},{name:"ClassMemberListWithNewlines$ebnf$1",symbols:["ClassMemberListWithNewlines$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberListWithNewlines$ebnf$2",symbols:["ClassMemberNonEmpty"],postprocess:t},{name:"ClassMemberListWithNewlines$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"ClassMemberListWithNewlines$ebnf$3",symbols:[]},{name:"ClassMemberListWithNewlines$ebnf$3",symbols:["ClassMemberListWithNewlines$ebnf$3",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberListWithNewlines",symbols:["ClassMemberListWithNewlines$ebnf$1","ClassMemberListWithNewlines$ebnf$2","ClassMemberListWithNewlines$ebnf$3"],postprocess:e=>e[1]?e[1]:[]},{name:"ClassMemberNonEmpty",symbols:["ClassMember"],postprocess:e=>[e[0]]},{name:"ClassMemberNonEmpty$ebnf$1",symbols:[n.has("NL")?{type:"NL"}:NL]},{name:"ClassMemberNonEmpty$ebnf$1",symbols:["ClassMemberNonEmpty$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ClassMemberNonEmpty",symbols:["ClassMember","ClassMemberNonEmpty$ebnf$1","ClassMemberNonEmpty"],postprocess:e=>[e[0],...e[2]]},{name:"ClassMember",symbols:["MethodDefinition"],postprocess:t},{name:"ClassMember",symbols:["PropertyDefinition"],postprocess:t},{name:"MethodDefinition$ebnf$1",symbols:[{literal:"async"}],postprocess:t},{name:"MethodDefinition$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"MethodDefinition",symbols:["MethodDefinition$ebnf$1","PropertyKey",{literal:"("},"ParameterList",{literal:")"},"Block"],postprocess:e=>o("MethodDefinition",{async:!!e[0],kind:"method",key:e[1],params:e[3],body:e[5]})},{name:"MethodDefinition",symbols:[{literal:"constructor"},{literal:"("},"ParameterList",{literal:")"},"Block"],postprocess:e=>o("MethodDefinition",{kind:"constructor",key:i("constructor"),params:e[2],body:e[4]})},{name:"PropertyDefinition",symbols:["PropertyKey",{literal:"="},"AssignmentExpression"],postprocess:e=>o("PropertyDefinition",{key:e[0],value:e[2]})},{name:"ImportDeclaration",symbols:[{literal:"import"},{literal:"{"},"ImportsList",{literal:"}"},{literal:"from"},n.has("string")?{type:"string"}:string],postprocess:e=>o("ImportDeclaration",{specifiers:e[2],source:l(e[5].value,e[5].text)})},{name:"ImportsList",symbols:[],postprocess:()=>[]},{name:"ImportsList",symbols:["ImportSpecifier"],postprocess:e=>[e[0]]},{name:"ImportsList",symbols:["ImportsList",{literal:","},"ImportSpecifier"],postprocess:e=>[...e[0],e[2]]},{name:"ImportSpecifier$ebnf$1$subexpression$1",symbols:[{literal:"as"},n.has("identifier")?{type:"identifier"}:identifier]},{name:"ImportSpecifier$ebnf$1",symbols:["ImportSpecifier$ebnf$1$subexpression$1"],postprocess:t},{name:"ImportSpecifier$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ImportSpecifier",symbols:[n.has("identifier")?{type:"identifier"}:identifier,"ImportSpecifier$ebnf$1"],postprocess:e=>o("ImportSpecifier",{imported:i(e[0].value),local:i(e[1]?e[1][1].value:e[0].value)})},{name:"ExportDeclaration",symbols:[{literal:"export"},"Declaration"],postprocess:e=>o("ExportNamedDeclaration",{declaration:e[1]})},{name:"ExportDeclaration",symbols:[{literal:"export"},{literal:"{"},"ExportsList",{literal:"}"}],postprocess:e=>o("ExportNamedDeclaration",{specifiers:e[2],source:null})},{name:"ExportsList",symbols:[],postprocess:()=>[]},{name:"ExportsList",symbols:["ExportSpecifier"],postprocess:e=>[e[0]]},{name:"ExportsList",symbols:["ExportsList",{literal:","},"ExportSpecifier"],postprocess:e=>[...e[0],e[2]]},{name:"ExportSpecifier$ebnf$1$subexpression$1",symbols:[{literal:"as"},n.has("identifier")?{type:"identifier"}:identifier]},{name:"ExportSpecifier$ebnf$1",symbols:["ExportSpecifier$ebnf$1$subexpression$1"],postprocess:t},{name:"ExportSpecifier$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ExportSpecifier",symbols:[n.has("identifier")?{type:"identifier"}:identifier,"ExportSpecifier$ebnf$1"],postprocess:e=>o("ExportSpecifier",{local:i(e[0].value),exported:i(e[1]?e[1][1].value:e[0].value)})},{name:"ControlStatement",symbols:["IfStatement"],postprocess:t},{name:"ControlStatement",symbols:["WhileStatement"],postprocess:t},{name:"ControlStatement",symbols:["DoWhileStatement"],postprocess:t},{name:"ControlStatement",symbols:["ForStatement"],postprocess:t},{name:"ControlStatement",symbols:["TryStatement"],postprocess:t},{name:"ControlStatement",symbols:["ThrowStatement"],postprocess:t},{name:"ControlStatement",symbols:["ReturnStatement"],postprocess:t},{name:"ControlStatement",symbols:["BreakStatement"],postprocess:t},{name:"ControlStatement",symbols:["ContinueStatement"],postprocess:t},{name:"IfStatement$ebnf$1$subexpression$1",symbols:[{literal:"else"},"Statement"]},{name:"IfStatement$ebnf$1",symbols:["IfStatement$ebnf$1$subexpression$1"],postprocess:t},{name:"IfStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"IfStatement",symbols:[{literal:"if"},{literal:"("},"Expression",{literal:")"},"Statement","IfStatement$ebnf$1"],postprocess:e=>o("IfStatement",{test:e[2],consequent:e[4],alternate:e[5]?e[5][1]:null})},{name:"WhileStatement",symbols:[{literal:"while"},{literal:"("},"Expression",{literal:")"},"Statement"],postprocess:e=>o("WhileStatement",{test:e[2],body:e[4]})},{name:"DoWhileStatement",symbols:[{literal:"do"},"Statement",{literal:"while"},{literal:"("},"Expression",{literal:")"}],postprocess:e=>o("DoWhileStatement",{body:e[1],test:e[4]})},{name:"ForStatement$subexpression$1",symbols:["VariableDeclaration"]},{name:"ForStatement$subexpression$1",symbols:["Expression"]},{name:"ForStatement$subexpression$1",symbols:[]},{name:"ForStatement$subexpression$2",symbols:["Expression"]},{name:"ForStatement$subexpression$2",symbols:[]},{name:"ForStatement$subexpression$3",symbols:["Expression"]},{name:"ForStatement$subexpression$3",symbols:[]},{name:"ForStatement",symbols:[{literal:"for"},{literal:"("},"ForStatement$subexpression$1",{literal:";"},"ForStatement$subexpression$2",{literal:";"},"ForStatement$subexpression$3",{literal:")"},"Statement"],postprocess:e=>o("ForStatement",{init:e[2]?e[2][0]:null,test:e[4]?e[4][0]:null,update:e[6]?e[6][0]:null,body:e[8]})},{name:"ForStatement$subexpression$4",symbols:[{literal:"let"}]},{name:"ForStatement$subexpression$4",symbols:[{literal:"const"}]},{name:"ForStatement$subexpression$4",symbols:[{literal:"var"}]},{name:"ForStatement",symbols:[{literal:"for"},{literal:"("},"ForStatement$subexpression$4","BindingPattern",{literal:"of"},"Expression",{literal:")"},"Statement"],postprocess:e=>o("ForOfStatement",{left:o("VariableDeclaration",{kind:e[2][0].value,declarations:[o("VariableDeclarator",{id:e[3],init:null})]}),right:e[5],body:e[7]})},{name:"TryStatement",symbols:[{literal:"try"},"Block","CatchFinally"],postprocess:e=>o("TryStatement",{block:e[1],handler:e[2].handler,finalizer:e[2].finalizer})},{name:"CatchFinally$ebnf$1$subexpression$1",symbols:[{literal:"("},"BindingPattern",{literal:")"}]},{name:"CatchFinally$ebnf$1",symbols:["CatchFinally$ebnf$1$subexpression$1"],postprocess:t},{name:"CatchFinally$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"CatchFinally$ebnf$2$subexpression$1",symbols:[{literal:"finally"},"Block"]},{name:"CatchFinally$ebnf$2",symbols:["CatchFinally$ebnf$2$subexpression$1"],postprocess:t},{name:"CatchFinally$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"CatchFinally",symbols:[{literal:"catch"},"CatchFinally$ebnf$1","Block","CatchFinally$ebnf$2"],postprocess:e=>({handler:o("CatchClause",{param:e[1]?e[1][1]:null,body:e[2]}),finalizer:e[3]?e[3][1]:null})},{name:"CatchFinally",symbols:[{literal:"finally"},"Block"],postprocess:e=>({handler:null,finalizer:e[1]})},{name:"ThrowStatement",symbols:[{literal:"throw"},"Expression"],postprocess:e=>o("ThrowStatement",{argument:e[1]})},{name:"ReturnStatement$ebnf$1",symbols:["Expression"],postprocess:t},{name:"ReturnStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ReturnStatement",symbols:[{literal:"return"},"ReturnStatement$ebnf$1"],postprocess:e=>o("ReturnStatement",{argument:e[1]})},{name:"BreakStatement$ebnf$1",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:t},{name:"BreakStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"BreakStatement",symbols:[{literal:"break"},"BreakStatement$ebnf$1"],postprocess:e=>o("BreakStatement",{label:e[1]?i(e[1].value):null})},{name:"ContinueStatement$ebnf$1",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:t},{name:"ContinueStatement$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ContinueStatement",symbols:[{literal:"continue"},"ContinueStatement$ebnf$1"],postprocess:e=>o("ContinueStatement",{label:e[1]?i(e[1].value):null})},{name:"ExpressionStatement",symbols:["Expression"],postprocess:e=>o("ExpressionStatement",{expression:e[0]})},{name:"Expression",symbols:["AssignmentExpression"],postprocess:t},{name:"AssignmentExpression",symbols:["PipelineExpression"],postprocess:t},{name:"AssignmentExpression",symbols:["ArrowFunction"],postprocess:t},{name:"AssignmentExpression",symbols:["LeftHandSideExpression","AssignmentOperator","AssignmentExpression"],postprocess:e=>o("AssignmentExpression",{operator:e[1],left:e[0],right:e[2]})},{name:"PipelineExpression",symbols:["ConditionalExpression"],postprocess:t},{name:"PipelineExpression$subexpression$1",symbols:[{literal:"|>"}]},{name:"PipelineExpression$subexpression$1",symbols:[{literal:"->"}]},{name:"PipelineExpression",symbols:["PipelineExpression","PipelineExpression$subexpression$1","ConditionalExpression"],postprocess:e=>{return t=e[0],s=e[1][0].value,n=e[2],o("PipelineExpression",{operator:s,left:t,right:n});var t,s,n}},{name:"AssignmentOperator",symbols:[{literal:"="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"+="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"-="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"*="}],postprocess:e=>e[0].value},{name:"AssignmentOperator",symbols:[{literal:"/="}],postprocess:e=>e[0].value},{name:"ArrowFunction",symbols:["ArrowParameters",{literal:"=>"},"ArrowBody"],postprocess:e=>o("ArrowFunctionExpression",{async:!1,params:e[0],body:e[2]})},{name:"ArrowFunction",symbols:[{literal:"async"},"ArrowParameters",{literal:"=>"},"ArrowBody"],postprocess:e=>o("ArrowFunctionExpression",{async:!0,params:e[1],body:e[3]})},{name:"ArrowParameters",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>[i(e[0].value)]},{name:"ArrowParameters",symbols:[{literal:"("},"ParameterList",{literal:")"}],postprocess:e=>e[1]},{name:"ArrowBody",symbols:["Block"],postprocess:t},{name:"ArrowBody",symbols:["AssignmentExpression"],postprocess:t},{name:"ConditionalExpression",symbols:["LogicalOrExpression"],postprocess:t},{name:"ConditionalExpression",symbols:["LogicalOrExpression",{literal:"?"},"AssignmentExpression",{literal:":"},"ConditionalExpression"],postprocess:e=>o("ConditionalExpression",{test:e[0],consequent:e[2],alternate:e[4]})},{name:"LogicalOrExpression",symbols:["LogicalAndExpression"],postprocess:t},{name:"LogicalOrExpression$subexpression$1",symbols:[{literal:"||"}]},{name:"LogicalOrExpression$subexpression$1",symbols:[{literal:"??"}]},{name:"LogicalOrExpression",symbols:["LogicalOrExpression","LogicalOrExpression$subexpression$1","LogicalAndExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"LogicalAndExpression",symbols:["EqualityExpression"],postprocess:t},{name:"LogicalAndExpression",symbols:["LogicalAndExpression",{literal:"&&"},"EqualityExpression"],postprocess:e=>a(e[0],e[1].value,e[2])},{name:"EqualityExpression",symbols:["RelationalExpression"],postprocess:t},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"=="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"!="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"==="}]},{name:"EqualityExpression$subexpression$1",symbols:[{literal:"!=="}]},{name:"EqualityExpression",symbols:["EqualityExpression","EqualityExpression$subexpression$1","RelationalExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"RelationalExpression",symbols:["AdditiveExpression"],postprocess:t},{name:"RelationalExpression$subexpression$1",symbols:[{literal:"<"}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:">"}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:"<="}]},{name:"RelationalExpression$subexpression$1",symbols:[{literal:">="}]},{name:"RelationalExpression",symbols:["RelationalExpression","RelationalExpression$subexpression$1","AdditiveExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"RelationalExpression$subexpression$2",symbols:[{literal:"instanceof"}]},{name:"RelationalExpression$subexpression$2",symbols:[{literal:"in"}]},{name:"RelationalExpression",symbols:["RelationalExpression","RelationalExpression$subexpression$2","AdditiveExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"AdditiveExpression",symbols:["MultiplicativeExpression"],postprocess:t},{name:"AdditiveExpression$subexpression$1",symbols:[{literal:"+"}]},{name:"AdditiveExpression$subexpression$1",symbols:[{literal:"-"}]},{name:"AdditiveExpression",symbols:["AdditiveExpression","AdditiveExpression$subexpression$1","MultiplicativeExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"MultiplicativeExpression",symbols:["ExponentiationExpression"],postprocess:t},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"*"}]},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"/"}]},{name:"MultiplicativeExpression$subexpression$1",symbols:[{literal:"%"}]},{name:"MultiplicativeExpression",symbols:["MultiplicativeExpression","MultiplicativeExpression$subexpression$1","ExponentiationExpression"],postprocess:e=>a(e[0],e[1][0].value,e[2])},{name:"ExponentiationExpression",symbols:["UnaryExpression"],postprocess:t},{name:"ExponentiationExpression",symbols:["UnaryExpression",{literal:"**"},"ExponentiationExpression"],postprocess:e=>a(e[0],e[1].value,e[2])},{name:"UnaryExpression",symbols:["PostfixExpression"],postprocess:t},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"!"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"+"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"-"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"~"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"typeof"}]},{name:"UnaryExpression$subexpression$1",symbols:[{literal:"await"}]},{name:"UnaryExpression",symbols:["UnaryExpression$subexpression$1","UnaryExpression"],postprocess:e=>function(e,t,s=!0){return o("UnaryExpression",{operator:e,argument:t,prefix:s})}(e[0][0].value,e[1])},{name:"UnaryExpression$subexpression$2",symbols:[{literal:"++"}]},{name:"UnaryExpression$subexpression$2",symbols:[{literal:"--"}]},{name:"UnaryExpression",symbols:["UnaryExpression$subexpression$2","UnaryExpression"],postprocess:e=>o("UpdateExpression",{operator:e[0][0].value,argument:e[1],prefix:!0})},{name:"PostfixExpression",symbols:["LeftHandSideExpression"],postprocess:t},{name:"PostfixExpression$subexpression$1",symbols:[{literal:"++"}]},{name:"PostfixExpression$subexpression$1",symbols:[{literal:"--"}]},{name:"PostfixExpression",symbols:["LeftHandSideExpression","PostfixExpression$subexpression$1"],postprocess:e=>o("UpdateExpression",{operator:e[1][0].value,argument:e[0],prefix:!1})},{name:"LeftHandSideExpression",symbols:["CallExpression"],postprocess:t},{name:"LeftHandSideExpression",symbols:["NewExpression"],postprocess:t},{name:"CallExpression",symbols:["MemberExpression","Arguments"],postprocess:e=>o("CallExpression",{callee:e[0],arguments:e[1]})},{name:"CallExpression",symbols:["CallExpression","Arguments"],postprocess:e=>o("CallExpression",{callee:e[0],arguments:e[1]})},{name:"CallExpression",symbols:["CallExpression",{literal:"["},"Expression",{literal:"]"}],postprocess:e=>o("MemberExpression",{object:e[0],property:e[2],computed:!0})},{name:"CallExpression$ebnf$1",symbols:[]},{name:"CallExpression$ebnf$1",symbols:["CallExpression$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"CallExpression",symbols:["CallExpression","CallExpression$ebnf$1",{literal:"."},"PropertyName"],postprocess:e=>o("MemberExpression",{object:e[0],property:i(e[3].value),computed:!1})},{name:"CallExpression$ebnf$2",symbols:[]},{name:"CallExpression$ebnf$2",symbols:["CallExpression$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"CallExpression",symbols:["CallExpression","CallExpression$ebnf$2",{literal:"?."},"OptionalMemberAccess"],postprocess:e=>o("MemberExpression",{object:e[0],property:e[3].property,computed:e[3].computed,optional:!0})},{name:"NewExpression$ebnf$1",symbols:["Arguments"],postprocess:t},{name:"NewExpression$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"NewExpression",symbols:[{literal:"new"},"MemberExpression","NewExpression$ebnf$1"],postprocess:e=>o("NewExpression",{callee:e[1],arguments:e[2]||[]})},{name:"NewExpression",symbols:["MemberExpression"],postprocess:t},{name:"MemberExpression",symbols:["PrimaryExpression"],postprocess:t},{name:"MemberExpression",symbols:["MemberExpression",{literal:"["},"Expression",{literal:"]"}],postprocess:e=>o("MemberExpression",{object:e[0],property:e[2],computed:!0})},{name:"MemberExpression$ebnf$1",symbols:[]},{name:"MemberExpression$ebnf$1",symbols:["MemberExpression$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MemberExpression",symbols:["MemberExpression","MemberExpression$ebnf$1",{literal:"."},"PropertyName"],postprocess:e=>o("MemberExpression",{object:e[0],property:i(e[3].value),computed:!1})},{name:"MemberExpression$ebnf$2",symbols:[]},{name:"MemberExpression$ebnf$2",symbols:["MemberExpression$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MemberExpression",symbols:["MemberExpression","MemberExpression$ebnf$2",{literal:"?."},"OptionalMemberAccess"],postprocess:e=>o("MemberExpression",{object:e[0],property:e[3].property,computed:e[3].computed,optional:!0})},{name:"OptionalMemberAccess",symbols:["PropertyName"],postprocess:e=>({property:i(e[0].value),computed:!1})},{name:"OptionalMemberAccess",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>({property:e[1],computed:!0})},{name:"PropertyName",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>e[0]},{name:"PropertyName",symbols:["ReservedKeyword"],postprocess:e=>e[0]},{name:"ReservedKeyword",symbols:[{literal:"let"}],postprocess:e=>({value:"let"})},{name:"ReservedKeyword",symbols:[{literal:"const"}],postprocess:e=>({value:"const"})},{name:"ReservedKeyword",symbols:[{literal:"var"}],postprocess:e=>({value:"var"})},{name:"ReservedKeyword",symbols:[{literal:"if"}],postprocess:e=>({value:"if"})},{name:"ReservedKeyword",symbols:[{literal:"else"}],postprocess:e=>({value:"else"})},{name:"ReservedKeyword",symbols:[{literal:"for"}],postprocess:e=>({value:"for"})},{name:"ReservedKeyword",symbols:[{literal:"while"}],postprocess:e=>({value:"while"})},{name:"ReservedKeyword",symbols:[{literal:"do"}],postprocess:e=>({value:"do"})},{name:"ReservedKeyword",symbols:[{literal:"break"}],postprocess:e=>({value:"break"})},{name:"ReservedKeyword",symbols:[{literal:"continue"}],postprocess:e=>({value:"continue"})},{name:"ReservedKeyword",symbols:[{literal:"return"}],postprocess:e=>({value:"return"})},{name:"ReservedKeyword",symbols:[{literal:"function"}],postprocess:e=>({value:"function"})},{name:"ReservedKeyword",symbols:[{literal:"class"}],postprocess:e=>({value:"class"})},{name:"ReservedKeyword",symbols:[{literal:"extends"}],postprocess:e=>({value:"extends"})},{name:"ReservedKeyword",symbols:[{literal:"constructor"}],postprocess:e=>({value:"constructor"})},{name:"ReservedKeyword",symbols:[{literal:"async"}],postprocess:e=>({value:"async"})},{name:"ReservedKeyword",symbols:[{literal:"await"}],postprocess:e=>({value:"await"})},{name:"ReservedKeyword",symbols:[{literal:"import"}],postprocess:e=>({value:"import"})},{name:"ReservedKeyword",symbols:[{literal:"export"}],postprocess:e=>({value:"export"})},{name:"ReservedKeyword",symbols:[{literal:"from"}],postprocess:e=>({value:"from"})},{name:"ReservedKeyword",symbols:[{literal:"as"}],postprocess:e=>({value:"as"})},{name:"ReservedKeyword",symbols:[{literal:"try"}],postprocess:e=>({value:"try"})},{name:"ReservedKeyword",symbols:[{literal:"catch"}],postprocess:e=>({value:"catch"})},{name:"ReservedKeyword",symbols:[{literal:"finally"}],postprocess:e=>({value:"finally"})},{name:"ReservedKeyword",symbols:[{literal:"throw"}],postprocess:e=>({value:"throw"})},{name:"ReservedKeyword",symbols:[{literal:"true"}],postprocess:e=>({value:"true"})},{name:"ReservedKeyword",symbols:[{literal:"false"}],postprocess:e=>({value:"false"})},{name:"ReservedKeyword",symbols:[{literal:"null"}],postprocess:e=>({value:"null"})},{name:"ReservedKeyword",symbols:[{literal:"undefined"}],postprocess:e=>({value:"undefined"})},{name:"ReservedKeyword",symbols:[{literal:"this"}],postprocess:e=>({value:"this"})},{name:"ReservedKeyword",symbols:[{literal:"super"}],postprocess:e=>({value:"super"})},{name:"ReservedKeyword",symbols:[{literal:"new"}],postprocess:e=>({value:"new"})},{name:"ReservedKeyword",symbols:[{literal:"typeof"}],postprocess:e=>({value:"typeof"})},{name:"ReservedKeyword",symbols:[{literal:"instanceof"}],postprocess:e=>({value:"instanceof"})},{name:"ReservedKeyword",symbols:[{literal:"in"}],postprocess:e=>({value:"in"})},{name:"ReservedKeyword",symbols:[{literal:"of"}],postprocess:e=>({value:"of"})},{name:"Arguments",symbols:[{literal:"("},"ArgumentList",{literal:")"}],postprocess:e=>e[1]},{name:"ArgumentList",symbols:[],postprocess:()=>[]},{name:"ArgumentList",symbols:["AssignmentExpression"],postprocess:e=>[e[0]]},{name:"ArgumentList",symbols:["ArgumentList",{literal:","},"AssignmentExpression"],postprocess:e=>[...e[0],e[2]]},{name:"ArgumentList",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>[o("SpreadElement",{argument:e[1]})]},{name:"ArgumentList",symbols:["ArgumentList",{literal:","},{literal:"..."},"AssignmentExpression"],postprocess:e=>[...e[0],o("SpreadElement",{argument:e[3]})]},{name:"PrimaryExpression",symbols:[{literal:"this"}],postprocess:()=>o("ThisExpression")},{name:"PrimaryExpression",symbols:[{literal:"super"}],postprocess:()=>o("Super")},{name:"PrimaryExpression",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>i(e[0].value)},{name:"PrimaryExpression",symbols:["Literal"],postprocess:t},{name:"PrimaryExpression",symbols:["ArrayLiteral"],postprocess:t},{name:"PrimaryExpression",symbols:["ObjectLiteral"],postprocess:t},{name:"PrimaryExpression",symbols:["FunctionExpression"],postprocess:t},{name:"PrimaryExpression",symbols:["TemplateLiteral"],postprocess:t},{name:"PrimaryExpression",symbols:[{literal:"("},"Expression",{literal:")"}],postprocess:e=>e[1]},{name:"FunctionExpression",symbols:[{literal:"function"},{literal:"("},"ParameterList",{literal:")"},"Block"],postprocess:e=>o("FunctionExpression",{async:!1,id:null,params:e[2],body:e[4]})},{name:"FunctionExpression",symbols:[{literal:"async"},{literal:"function"},{literal:"("},"ParameterList",{literal:")"},"Block"],postprocess:e=>o("FunctionExpression",{async:!0,id:null,params:e[3],body:e[5]})},{name:"Literal",symbols:[n.has("number")?{type:"number"}:number],postprocess:e=>l(e[0].value,e[0].text)},{name:"Literal",symbols:[n.has("string")?{type:"string"}:string],postprocess:e=>l(e[0].value,e[0].text)},{name:"Literal",symbols:[n.has("regex")?{type:"regex"}:regex],postprocess:e=>{return t=e[0].value.pattern,s=e[0].value.flags,o("RegexLiteral",{pattern:t,flags:s});var t,s}},{name:"Literal",symbols:[{literal:"true"}],postprocess:()=>l(!0,"true")},{name:"Literal",symbols:[{literal:"false"}],postprocess:()=>l(!1,"false")},{name:"Literal",symbols:[{literal:"null"}],postprocess:()=>l(null,"null")},{name:"Literal",symbols:[{literal:"undefined"}],postprocess:()=>l(void 0,"undefined")},{name:"TemplateLiteral",symbols:[n.has("templateLiteral")?{type:"templateLiteral"}:templateLiteral],postprocess:e=>o("TemplateLiteral",{quasis:[o("TemplateElement",{value:{cooked:e[0].value,raw:e[0].value}})],expressions:[]})},{name:"ArrayLiteral$ebnf$1",symbols:[]},{name:"ArrayLiteral$ebnf$1",symbols:["ArrayLiteral$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrayLiteral$ebnf$2",symbols:[]},{name:"ArrayLiteral$ebnf$2",symbols:["ArrayLiteral$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ArrayLiteral",symbols:[{literal:"["},"ArrayLiteral$ebnf$1","ElementList","ArrayLiteral$ebnf$2",{literal:"]"}],postprocess:e=>o("ArrayExpression",{elements:e[2]})},{name:"ElementList",symbols:[],postprocess:()=>[]},{name:"ElementList",symbols:["Element"],postprocess:e=>[e[0]]},{name:"ElementList$ebnf$1",symbols:[]},{name:"ElementList$ebnf$1",symbols:["ElementList$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList$ebnf$2",symbols:[]},{name:"ElementList$ebnf$2",symbols:["ElementList$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList",symbols:["ElementList","ElementList$ebnf$1",{literal:","},"ElementList$ebnf$2","Element"],postprocess:e=>[...e[0],e[4]]},{name:"ElementList$ebnf$3",symbols:[]},{name:"ElementList$ebnf$3",symbols:["ElementList$ebnf$3",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ElementList",symbols:["ElementList","ElementList$ebnf$3",{literal:","}],postprocess:e=>[...e[0],null]},{name:"Element",symbols:["AssignmentExpression"],postprocess:t},{name:"Element",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>o("SpreadElement",{argument:e[1]})},{name:"ObjectLiteral$ebnf$1",symbols:[]},{name:"ObjectLiteral$ebnf$1",symbols:["ObjectLiteral$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral",symbols:[{literal:"{"},"ObjectLiteral$ebnf$1",{literal:"}"}],postprocess:()=>o("ObjectExpression",{properties:[]})},{name:"ObjectLiteral$ebnf$2",symbols:[]},{name:"ObjectLiteral$ebnf$2",symbols:["ObjectLiteral$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral$ebnf$3",symbols:[]},{name:"ObjectLiteral$ebnf$3",symbols:["ObjectLiteral$ebnf$3",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ObjectLiteral",symbols:[{literal:"{"},"ObjectLiteral$ebnf$2","PropertyDefinitionList","ObjectLiteral$ebnf$3",{literal:"}"}],postprocess:e=>o("ObjectExpression",{properties:e[2]})},{name:"PropertyDefinitionList",symbols:["PropertyDef"],postprocess:e=>[e[0]]},{name:"PropertyDefinitionList$ebnf$1",symbols:[]},{name:"PropertyDefinitionList$ebnf$1",symbols:["PropertyDefinitionList$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList$ebnf$2",symbols:[]},{name:"PropertyDefinitionList$ebnf$2",symbols:["PropertyDefinitionList$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList",symbols:["PropertyDefinitionList","PropertyDefinitionList$ebnf$1",{literal:","},"PropertyDefinitionList$ebnf$2","PropertyDef"],postprocess:e=>[...e[0],e[4]]},{name:"PropertyDefinitionList$ebnf$3",symbols:[]},{name:"PropertyDefinitionList$ebnf$3",symbols:["PropertyDefinitionList$ebnf$3",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDefinitionList",symbols:["PropertyDefinitionList","PropertyDefinitionList$ebnf$3",{literal:","}],postprocess:e=>e[0]},{name:"PropertyDef$ebnf$1",symbols:[]},{name:"PropertyDef$ebnf$1",symbols:["PropertyDef$ebnf$1",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDef$ebnf$2",symbols:[]},{name:"PropertyDef$ebnf$2",symbols:["PropertyDef$ebnf$2",n.has("NL")?{type:"NL"}:NL],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PropertyDef",symbols:["ObjectPropertyKey","PropertyDef$ebnf$1",{literal:":"},"PropertyDef$ebnf$2","AssignmentExpression"],postprocess:e=>o("Property",{key:e[0],value:e[4],shorthand:!1})},{name:"PropertyDef",symbols:["PropertyName"],postprocess:e=>o("Property",{key:i(e[0].value),value:i(e[0].value),shorthand:!0})},{name:"PropertyDef",symbols:[{literal:"..."},"AssignmentExpression"],postprocess:e=>o("SpreadElement",{argument:e[1]})},{name:"ObjectPropertyKey",symbols:["PropertyName"],postprocess:e=>i(e[0].value)},{name:"ObjectPropertyKey",symbols:[n.has("string")?{type:"string"}:string],postprocess:e=>l(e[0].value,e[0].text)},{name:"ObjectPropertyKey",symbols:[n.has("number")?{type:"number"}:number],postprocess:e=>l(e[0].value,e[0].text)},{name:"ObjectPropertyKey",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>e[1]},{name:"PropertyKey",symbols:[n.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>i(e[0].value)},{name:"PropertyKey",symbols:[n.has("string")?{type:"string"}:string],postprocess:e=>l(e[0].value,e[0].text)},{name:"PropertyKey",symbols:[n.has("number")?{type:"number"}:number],postprocess:e=>l(e[0].value,e[0].text)},{name:"PropertyKey",symbols:[{literal:"["},"Expression",{literal:"]"}],postprocess:e=>e[1]},{name:"Block",symbols:[{literal:"{"},"StatementList",{literal:"}"}],postprocess:e=>o("BlockStatement",{body:e[1]})}],ParserStart:"Program"};e.exports=c}()}(y);var d=y.exports,x=t({__proto__:null},[d]);class v{constructor(e={}){this.lastPipelineValue=void 0,this.globalModuleCache=new Map,this.consoleLogs=[],this.moduleResolver=e.moduleResolver||new l,this.globalContext=e.globalContext||this.createContext(),this.currentContext=this.globalContext,this.bindBuiltins(),e.functions&&Object.entries(e.functions).forEach(([e,t])=>{this.bindFunction(e,t)})}createContext(e){return{variables:new Map,variableKinds:new Map,functions:new Map,classes:new Map,exports:new Map,parent:e,moduleCache:new Map}}bindBuiltins(){this.bindFunction("log",(...e)=>{this.consoleLogs.push({type:"log",args:e,timestamp:Date.now()}),console.log(...e)}),this.bindFunction("error",(...e)=>{this.consoleLogs.push({type:"error",args:e,timestamp:Date.now()}),console.error(...e)}),this.bindFunction("warn",(...e)=>{this.consoleLogs.push({type:"warn",args:e,timestamp:Date.now()}),console.warn(...e)}),this.bindFunction("Number",e=>Number(e)),this.bindFunction("String",e=>String(e)),this.bindFunction("Boolean",e=>Boolean(e)),this.bindFunction("isNaN",e=>isNaN(e)),this.bindFunction("isFinite",e=>isFinite(e)),this.bindFunction("isInteger",e=>Number.isInteger(e)),Object.entries(m).forEach(([e,t])=>{this.bindFunction(e,t)});const e=function(t){if(!(this instanceof e))return new Error(t);const s=new Error(t);return Object.setPrototypeOf(this,s),this.message=t||"",this.name="Error",this};this.bindFunction("Error",e),this.currentContext.variables.set("Error",e),this.currentContext.variables.set("Infinity",1/0),this.currentContext.variables.set("NaN",NaN),this.currentContext.variables.set("undefined",void 0),this.currentContext.variables.set("Date",Date),this.currentContext.variables.set("RegExp",RegExp),this.currentContext.variables.set("Promise",{all:e=>Promise.all(e),race:e=>Promise.race(e),resolve:e=>Promise.resolve(e),reject:e=>Promise.reject(e)}),this.bindFunction("filter",async(e,t)=>{const s=[];for(let n=0;n<e.length;n++){const r=t(e[n],n,e);(r instanceof Promise?await r:r)&&s.push(e[n])}return s}),this.bindFunction("map",async(e,t)=>{const s=[];for(let n=0;n<e.length;n++){const r=t(e[n],n,e);s.push(r instanceof Promise?await r:r)}return s}),this.bindFunction("reduce",async(e,t,s)=>{let n=void 0!==s?s:e[0];for(let r=void 0!==s?0:1;r<e.length;r++){const s=t(n,e[r],r,e);n=s instanceof Promise?await s:s}return n}),this.bindFunction("forEach",async(e,t)=>{for(let s=0;s<e.length;s++)await t(e[s],s,e)}),this.bindFunction("find",async(e,t)=>{for(let s=0;s<e.length;s++)if(await t(e[s],s,e))return e[s]}),this.bindFunction("some",async(e,t)=>{for(let s=0;s<e.length;s++)if(await t(e[s],s,e))return!0;return!1}),this.bindFunction("every",async(e,t)=>{for(let s=0;s<e.length;s++)if(!await t(e[s],s,e))return!1;return!0}),this.bindFunction("sort",async(e,t)=>{if(!t)return[...e].sort();const s=[...e];for(let e=0;e<s.length-1;e++)for(let n=e+1;n<s.length;n++){await t(s[e],s[n])>0&&([s[e],s[n]]=[s[n],s[e]])}return s}),this.bindFunction("slice",(e,t,s)=>e.slice(t,s)),this.bindFunction("concat",(...e)=>[].concat(...e)),this.bindFunction("join",(e,t)=>e.join(t)),this.bindFunction("includes",(e,t)=>e.includes(t)),this.bindFunction("indexOf",(e,t)=>Array.isArray(e)?e.indexOf(t):-1),this.bindFunction("push",(e,...t)=>(e.push(...t),e)),this.bindFunction("forEach",(e,t)=>{Array.isArray(e)&&e.forEach(t)}),this.bindFunction("pop",e=>e.pop()),this.bindFunction("shift",e=>e.shift()),this.bindFunction("unshift",(e,...t)=>(e.unshift(...t),e)),this.bindFunction("assign",Object.assign),this.bindFunction("freeze",Object.freeze),this.bindFunction("seal",Object.seal),this.bindFunction("toUpperCase",e=>e.toUpperCase()),this.bindFunction("toLowerCase",e=>e.toLowerCase()),this.bindFunction("trim",e=>e.trim()),this.bindFunction("split",(e,t)=>void 0!==t?e.split(t):e.split("")),this.bindFunction("replace",(e,t,s)=>e.replace(t,s)),this.bindFunction("substring",(e,t,s)=>e.substring(t,s)),this.bindFunction("charAt",(e,t)=>e.charAt(t)),this.bindFunction("charCodeAt",(e,t)=>e.charCodeAt(t)),this.bindFunction("startsWith",(e,t)=>e.startsWith(t)),this.bindFunction("endsWith",(e,t)=>e.endsWith(t)),this.bindFunction("repeat",(e,t)=>e.repeat(t)),this.bindFunction("padStart",(e,t,s)=>e.padStart(t,s)),this.bindFunction("padEnd",(e,t,s)=>e.padEnd(t,s)),this.bindFunction("pow",Math.pow),this.bindFunction("sqrt",Math.sqrt),this.bindFunction("random",Math.random),this.bindFunction("typeof",e=>typeof e),this.bindFunction("isArray",Array.isArray),this.bindFunction("isNaN",isNaN),this.bindFunction("isFinite",isFinite),this.bindFunction("parseInt",parseInt),this.bindFunction("parseFloat",parseFloat),this.bindFunction("parseJSON",JSON.parse),this.bindFunction("stringify",JSON.stringify),this.bindFunction("wait",e=>new Promise(t=>setTimeout(t,e))),this.bindFunction("Promise",Promise)}bindFunction(e,t){this.globalContext.functions.set(e,t)}setVariable(e,t){this.globalContext.variables.set(e,t)}async execute(e,t,s){this.consoleLogs=[];const n=new d.nearley.Parser(d.nearley.Grammar.fromCompiled(d.grammar));try{if(n.feed(e),0===n.results.length)throw new r("No parse found",{type:"ParseError"});n.results.length>1&&console.warn("Ambiguous grammar detected, using first parse");const o=n.results[0],a=t||this.globalContext,i=this.currentContext;this.currentContext=a;try{const e=await this.evaluateNode(o);return s?.withMetadata?{result:e,metadata:{logs:[...this.consoleLogs]}}:e}finally{this.currentContext=i}}catch(e){if(e&&"object"==typeof e&&"return"===e.type)return s?.withMetadata?{result:e.value,metadata:{logs:[...this.consoleLogs]}}:e.value;if(e instanceof r)throw e;const t=e instanceof Error?e.message:JSON.stringify(e);throw new r(`Parse error: ${t}`,{type:"ParseError"},e instanceof Error?e:void 0)}}createSyncFunction(e){const t=this.currentContext,s=this.currentContext.variables.get("this"),n=this,r=function(...o){const a=n.createContext(t);e.id&&e.id.name&&a.variables.set(e.id.name,r),"ArrowFunctionExpression"===e.type?a.variables.set("this",s):a.variables.set("this",this),e.params.forEach((e,t)=>{if("Identifier"===e.type)a.variables.set(e.name,o[t]);else if("RestElement"===e.type)a.variables.set(e.argument.name,o.slice(t));else if("AssignmentPattern"===e.type){const s=void 0!==o[t]?o[t]:n.evaluateNodeSync(e.right);"Identifier"===e.left.type&&a.variables.set(e.left.name,s)}});const i=n.currentContext;n.currentContext=a;try{const t=e.body;if("ArrowFunctionExpression"===e.type&&"BlockStatement"!==t.type)return n.evaluateNodeSync(t);let s;for(const e of t.body)try{s=n.evaluateNodeSync(e)}catch(e){if("return"===e.type)return e.value;throw e}return s}finally{n.currentContext=i}};return r}evaluateNodeSync(e){if(e)switch(e.type){case"Literal":return e.value;case"RegexLiteral":return new RegExp(e.pattern,e.flags);case"Identifier":return this.evaluateIdentifier(e);case"MemberExpression":const t=this.evaluateNodeSync(e.object);if(e.optional&&null==t)return;if(!e.optional&&null==t)throw new Error(`Cannot read properties of ${t} (reading '${e.computed?"computed property":e.property.name}')`);return t[e.computed?this.evaluateNodeSync(e.property):e.property.name];case"BinaryExpression":const s=this.evaluateNodeSync(e.left),n=this.evaluateNodeSync(e.right);switch(e.operator){case"+":return s+n;case"-":return s-n;case"*":return s*n;case"/":return s/n;case"%":return s%n;case"==":return s==n;case"!=":return s!=n;case"===":return s===n;case"!==":return s!==n;case"<":return s<n;case"<=":return s<=n;case">":return s>n;case">=":return s>=n;case"&&":return s&&n;case"||":return s||n;default:throw new Error(`Unknown operator: ${e.operator}`)}case"UnaryExpression":const r=this.evaluateNodeSync(e.argument);switch(e.operator){case"!":return!r;case"-":return-r;case"+":return+r;case"typeof":return typeof r;default:throw new Error(`Unknown unary operator: ${e.operator}`)}case"AssignmentExpression":const o=this.evaluateNodeSync(e.right);if("MemberExpression"===e.left.type){this.evaluateNodeSync(e.left.object)[e.left.computed?this.evaluateNodeSync(e.left.property):e.left.property.name]=o}else"Identifier"===e.left.type&&this.currentContext.variables.set(e.left.name,o);return o;case"ConditionalExpression":return this.evaluateNodeSync(e.test)?this.evaluateNodeSync(e.consequent):this.evaluateNodeSync(e.alternate);case"BlockStatement":let a;for(const t of e.body)a=this.evaluateNodeSync(t);return a;case"ExpressionStatement":return this.evaluateNodeSync(e.expression);case"ReturnStatement":throw{type:"return",value:e.argument?this.evaluateNodeSync(e.argument):void 0};case"IfStatement":return this.evaluateNodeSync(e.test)?this.evaluateNodeSync(e.consequent):e.alternate?this.evaluateNodeSync(e.alternate):void 0;case"CallExpression":let i,l=null;if("MemberExpression"===e.callee.type){const t=this.evaluateNodeSync(e.callee.object),s=e.callee.computed?this.evaluateNodeSync(e.callee.property):e.callee.property.name;i=t?.[s],l=t}else i=this.evaluateNodeSync(e.callee);if("function"!=typeof i)throw new Error(`Not a function: ${e.callee.name||"expression"}`);const c=e.arguments.map(e=>{if("SpreadElement"===e.type){return this.evaluateNodeSync(e.argument)}return this.evaluateNodeSync(e)}),u=c.map(e=>void 0===e&&void 0!==this.lastPipelineValue?this.lastPipelineValue:e),p=[];for(let t=0;t<u.length;t++)"SpreadElement"===e.arguments[t].type?p.push(...u[t]):p.push(u[t]);return i.apply(l,p);case"ThrowStatement":throw this.evaluateNodeSync(e.argument);case"ThisExpression":return this.currentContext.variables.get("this");case"ArrowFunctionExpression":case"FunctionExpression":return this.createSyncFunction(e);case"ObjectExpression":const m={};for(const t of e.properties)if("SpreadElement"===t.type){const e=this.evaluateNodeSync(t.argument);Object.assign(m,e)}else{const e=t.computed?this.evaluateNodeSync(t.key):"Identifier"===t.key.type?t.key.name:this.evaluateNodeSync(t.key);t.shorthand?m[e]=this.evaluateIdentifier(t.key):m[e]=this.evaluateNodeSync(t.value)}return m;case"ArrayExpression":const f=[];for(const t of e.elements)if(null===t)f.push(void 0);else if("SpreadElement"===t.type){const e=this.evaluateNodeSync(t.argument);f.push(...e)}else f.push(this.evaluateNodeSync(t));return f;case"PipelineExpression":const y=this.evaluateNodeSync(e.left),h=this.lastPipelineValue;this.lastPipelineValue=y;try{return this.evaluateNodeSync(e.right)}finally{this.lastPipelineValue=h}default:throw new Error(`Cannot evaluate node type synchronously: ${e.type}`)}}async evaluateNode(e){if(e)switch(e.type){case"Program":return this.evaluateProgram(e);case"VariableDeclaration":return this.evaluateVariableDeclaration(e);case"FunctionDeclaration":return this.evaluateFunctionDeclaration(e);case"ClassDeclaration":return this.evaluateClassDeclaration(e);case"ExpressionStatement":return this.evaluateNode(e.expression);case"BlockStatement":return this.evaluateBlock(e);case"IfStatement":return this.evaluateIfStatement(e);case"ForStatement":case"ForOfStatement":case"ForInStatement":return this.evaluateForStatement(e);case"WhileStatement":return this.evaluateWhileStatement(e);case"DoWhileStatement":return this.evaluateDoWhileStatement(e);case"SwitchStatement":return this.evaluateSwitchStatement(e);case"BreakStatement":throw{type:"break",label:e.label};case"ContinueStatement":throw{type:"continue",label:e.label};case"LabeledStatement":return this.evaluateLabeledStatement(e);case"ReturnStatement":throw{type:"return",value:e.argument?await this.evaluateNode(e.argument):void 0};case"ThrowStatement":throw await this.evaluateNode(e.argument);case"TryStatement":return this.evaluateTryStatement(e);case"ImportDeclaration":return this.evaluateImport(e);case"ExportNamedDeclaration":return this.evaluateExport(e);case"Identifier":return this.evaluateIdentifier(e);case"Literal":return e.value;case"RegexLiteral":return new RegExp(e.pattern,e.flags);case"TemplateLiteral":return this.evaluateTemplateLiteral(e);case"ArrayExpression":return this.evaluateArrayExpression(e);case"ObjectExpression":return this.evaluateObjectExpression(e);case"FunctionExpression":case"ArrowFunctionExpression":return this.createFunction(e);case"CallExpression":return this.evaluateCallExpression(e);case"NewExpression":return this.evaluateNewExpression(e);case"MemberExpression":return this.evaluateMemberExpression(e);case"BinaryExpression":return this.evaluateBinaryExpression(e);case"UnaryExpression":return this.evaluateUnaryExpression(e);case"AssignmentExpression":return this.evaluateAssignmentExpression(e);case"UpdateExpression":return this.evaluateUpdateExpression(e);case"ConditionalExpression":return this.evaluateConditionalExpression(e);case"PipelineExpression":return this.evaluatePipelineExpression(e);case"ThisExpression":return this.currentContext.variables.get("this");case"Super":return this.currentContext.variables.get("__super__");case"SpreadElement":const t=await this.evaluateNode(e.argument);if(!Array.isArray(t))throw new a("array",t,"spread operator");return t;default:throw new r(`Unknown node type: ${e.type}`,{type:"RuntimeError"})}}async evaluateProgram(e){const t=this.processContinuations(e.body);let s;this.hoistVarDeclarations(t);for(const e of t)s=await this.evaluateNode(e);return s}processContinuations(e){const t=[];for(let s=0;s<e.length;s++){const n=e[s];if("PipelineContinuation"===n.type||"MemberContinuation"===n.type){if(t.length>0){const e=t[t.length-1];if("ExpressionStatement"===e.type){if("AssignmentExpression"===e.expression.type){if("PipelineContinuation"===n.type)e.expression.right={type:"PipelineExpression",operator:n.operator,left:e.expression.right,right:n.right};else if("MemberContinuation"===n.type){const t={type:"MemberExpression",object:e.expression.right,property:n.property,computed:!1,optional:n.optional};e.expression.right=n.arguments?{type:"CallExpression",callee:t,arguments:n.arguments}:t}}else if("PipelineContinuation"===n.type)e.expression={type:"PipelineExpression",operator:n.operator,left:e.expression,right:n.right};else if("MemberContinuation"===n.type){const t={type:"MemberExpression",object:e.expression,property:n.property,computed:!1,optional:n.optional};e.expression=n.arguments?{type:"CallExpression",callee:t,arguments:n.arguments}:t}continue}if("VariableDeclaration"===e.type&&e.declarations&&e.declarations.length>0){const t=e.declarations[e.declarations.length-1];if(t.init){if("PipelineContinuation"===n.type)t.init={type:"PipelineExpression",operator:n.operator,left:t.init,right:n.right};else if("MemberContinuation"===n.type){const e={type:"MemberExpression",object:t.init,property:n.property,computed:!1,optional:n.optional};t.init=n.arguments?{type:"CallExpression",callee:e,arguments:n.arguments}:e}continue}}if("ReturnStatement"===e.type&&e.argument){if("PipelineContinuation"===n.type)e.argument={type:"PipelineExpression",operator:n.operator,left:e.argument,right:n.right};else if("MemberContinuation"===n.type){const t={type:"MemberExpression",object:e.argument,property:n.property,computed:!1,optional:n.optional};e.argument=n.arguments?{type:"CallExpression",callee:t,arguments:n.arguments}:t}continue}}throw new Error(`Unexpected continuation operator at statement ${s+1}`)}t.push(n)}return t}hoistVarDeclarations(e){for(const t of e)if("VariableDeclaration"===t.type&&"var"===t.kind)for(const e of t.declarations)this.hoistVarPattern(e.id);else"FunctionDeclaration"===t.type&&this.currentContext.functions.set(t.id.name,this.createFunction(t))}hoistVarPattern(e){if("Identifier"===e.type)this.currentContext.variables.has(e.name)||(this.currentContext.variables.set(e.name,void 0),this.currentContext.variableKinds.set(e.name,"var"));else if("ObjectPattern"===e.type)for(const t of e.properties)if("Property"===t.type)if(t.shorthand&&"string"==typeof t.value)this.currentContext.variables.has(t.value)||(this.currentContext.variables.set(t.value,void 0),this.currentContext.variableKinds.set(t.value,"var"));else{const e="string"==typeof t.value?{type:"Identifier",name:t.value}:t.value;this.hoistVarPattern(e)}else"RestElement"===t.type&&(this.currentContext.variables.has(t.argument)||(this.currentContext.variables.set(t.argument,void 0),this.currentContext.variableKinds.set(t.argument,"var")));else if("ArrayPattern"===e.type)for(const t of e.elements)if(t)if("RestElement"===t.type){const e=t.argument.name||t.argument;this.currentContext.variables.has(e)||(this.currentContext.variables.set(e,void 0),this.currentContext.variableKinds.set(e,"var"))}else this.hoistVarPattern(t)}async evaluateVariableDeclaration(e){for(const t of e.declarations){const s=t.init?await this.evaluateNode(t.init):void 0;this.assignPattern(t.id,s,e.kind)}}assignPattern(e,t,s){if("Identifier"===e.type)if("var"===s){let s=this.currentContext;for(;s;){if(s.variables.has(e.name)){s.variables.set(e.name,t);break}s=s.parent}s||(this.currentContext.variables.set(e.name,t),this.currentContext.variableKinds.set(e.name,"var"))}else this.currentContext.variables.set(e.name,t),s&&this.currentContext.variableKinds.set(e.name,s);else if("ObjectPattern"===e.type){if(null==t)throw new TypeError("Cannot destructure 'null' or 'undefined'");for(const n of e.properties)if("Property"===n.type){const e="Identifier"===n.key.type?n.key.name:n.key.value;if(n.shorthand&&"string"==typeof n.value)this.currentContext.variables.set(n.value,t[e]),s&&this.currentContext.variableKinds.set(n.value,s);else{const r="string"==typeof n.value?{type:"Identifier",name:n.value}:n.value;this.assignPattern(r,t[e],s)}}else if("RestElement"===n.type){const r={...t};for(const t of e.properties)if("Property"===t.type){delete r["Identifier"===t.key.type?t.key.name:t.key.value]}this.currentContext.variables.set(n.argument,r),s&&this.currentContext.variableKinds.set(n.argument,s)}}else if("ArrayPattern"===e.type){if(null==t)throw new TypeError("Cannot destructure 'null' or 'undefined'");const n=Array.isArray(t)?t:[];let r=0;for(const t of e.elements)t&&("RestElement"===t.type?(this.currentContext.variables.set(t.argument.name||t.argument,n.slice(r)),s&&this.currentContext.variableKinds.set(t.argument.name||t.argument,s)):this.assignPattern(t,n[r],s)),r++}}async evaluateFunctionDeclaration(e){const t=this.createFunction(e);this.currentContext.functions.set(e.id.name,t)}createFunction(e){const t=e.params||[],s=e.body,n=e.async,r=this.currentContext,o="ArrowFunctionExpression"===e.type?this.currentContext.variables.get("this"):void 0;if(!n&&"ArrowFunctionExpression"===e.type&&"BlockStatement"!==s.type){return(...e)=>{const n=this.createContext(r);n.variables.set("this",o);const a=this.currentContext;this.currentContext=n;for(let s=0;s<t.length;s++){const r=t[s];if("RestElement"===r.type)n.variables.set(r.argument.name||r.argument,e.slice(s));else if("Identifier"===r.type)n.variables.set(r.name,e[s]);else if("AssignmentPattern"===r.type){const t=void 0!==e[s]?e[s]:this.evaluateNodeSync(r.right);"Identifier"===r.left.type&&n.variables.set(r.left.name,t)}}try{return this.evaluateNodeSync(s)}finally{this.currentContext=a}}}const a=this,i=async function(...n){const l=a.createContext(r);e.id&&e.id.name&&l.variables.set(e.id.name,i),"ArrowFunctionExpression"===e.type?l.variables.set("this",o):l.variables.set("this",this);const c=a.currentContext;a.currentContext=l;for(let e=0;e<t.length;e++){const s=t[e];if("RestElement"===s.type){l.variables.set(s.argument.name||s.argument,n.slice(e));break}if("AssignmentPattern"===s.type){const t=e<n.length&&void 0!==n[e]?n[e]:await a.evaluateNode(s.right);a.assignPattern(s.left,t)}else a.assignPattern(s,n[e])}try{return"BlockStatement"===s.type?(a.hoistVarDeclarations(s.body),void await a.evaluateBlock(s)):await a.evaluateNode(s)}catch(e){if("return"===e?.type)return e.value;throw e}finally{a.currentContext=c}};return n?i:(...e)=>{const t=i(...e);return t instanceof Promise?t:Promise.resolve(t)}}async evaluateClassDeclaration(e){const t=e.id.name,s=e.superClass?this.evaluateIdentifier(e.superClass):null,n=e.body.body.find(e=>"constructor"===e.kind),r=this,o=function(...e){return(async()=>{const t=Object.create(o.prototype);if(n){const o=r.createContext(r.currentContext);o.variables.set("this",t),s&&o.variables.set("__super__",async(...e)=>{const n=await s(...e);Object.assign(t,n),n instanceof Error&&(void 0!==n.message&&(t.message=n.message),void 0!==n.name&&(t.name=n.name),void 0!==n.stack&&(t.stack=n.stack))});for(let t=0;t<n.params.length;t++){const s=n.params[t];"Identifier"===s.type&&o.variables.set(s.name,e[t])}const a=r.currentContext;r.currentContext=o;try{for(const e of n.body.body)await r.evaluateNode(e)}finally{r.currentContext=a}}return t})()};s&&(o.prototype=Object.create(s.prototype),o.prototype.constructor=o);for(const t of e.body.body)if("MethodDefinition"===t.type&&"constructor"!==t.kind){const e=t.key.name;if("get"===t.kind||"set"===t.kind){const s=t.static?o:o.prototype,n=Object.getOwnPropertyDescriptor(s,e)||{configurable:!0,enumerable:!0};"get"===t.kind?n.get=function(){const e=r.createContext(r.currentContext);e.variables.set("this",this);const s=r.currentContext;r.currentContext=e;try{let e;for(const s of t.body.body)try{e=r.evaluateNodeSync(s)}catch(e){if("return"===e.type)return e.value;throw e}return e}finally{r.currentContext=s}}:n.set=function(e){const s=r.createContext(r.currentContext);if(s.variables.set("this",this),t.params.length>0){const n=t.params[0];"Identifier"===n.type&&s.variables.set(n.name,e)}const n=r.currentContext;r.currentContext=s;try{for(const e of t.body.body)if("ExpressionStatement"===e.type)r.evaluateNodeSync(e.expression);else if("IfStatement"===e.type){r.evaluateNodeSync(e.test)?r.evaluateNodeSync(e.consequent):e.alternate&&r.evaluateNodeSync(e.alternate)}else if("ThrowStatement"===e.type)throw r.evaluateNodeSync(e.argument)}finally{r.currentContext=n}},Object.defineProperty(s,e,n)}else{const s=async function(...e){const s=r.createContext(r.currentContext);s.variables.set("this",t.static?o:this);for(let n=0;n<t.params.length;n++){const o=t.params[n];if("Identifier"===o.type)s.variables.set(o.name,e[n]);else if("AssignmentPattern"===o.type){const t=n<e.length&&void 0!==e[n]?e[n]:await r.evaluateNode(o.right);"Identifier"===o.left.type&&s.variables.set(o.left.name,t)}}const n=r.currentContext;r.currentContext=s;try{let e;for(const s of t.body.body)try{e=await r.evaluateNode(s)}catch(e){if("return"===e.type)return e.value;throw e}return e}finally{r.currentContext=n}};t.static?o[e]=s:o.prototype[e]=s}}this.currentContext.classes.set(t,o),this.currentContext.variables.set(t,o)}async evaluateBlock(e){const t=this.createContext(this.currentContext),s=this.currentContext;this.currentContext=t;try{e._processedBody||(e._processedBody=this.processContinuations(e.body));const t=e._processedBody;let s;for(const e of t)s=await this.evaluateNode(e);return s}finally{this.currentContext=s}}async evaluateIfStatement(e){return await this.evaluateNode(e.test)?await this.evaluateNode(e.consequent):e.alternate?await this.evaluateNode(e.alternate):void 0}async evaluateForStatement(e){if("ForOfStatement"===e.type){const t=await this.evaluateNode(e.right);for(const s of t){"VariableDeclaration"===e.left.type&&this.assignPattern(e.left.declarations[0].id,s);try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}}else if("ForInStatement"===e.type){const t=await this.evaluateNode(e.right);for(const s in t){"VariableDeclaration"===e.left.type&&this.assignPattern(e.left.declarations[0].id,s);try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}}else for(e.init&&await this.evaluateNode(e.init);!e.test||await this.evaluateNode(e.test);){try{await this.evaluateNode(e.body)}catch(t){if("break"===t.type&&!t.label)break;if("continue"===t.type&&!t.label){e.update&&await this.evaluateNode(e.update);continue}throw t}e.update&&await this.evaluateNode(e.update)}}async evaluateWhileStatement(e){for(;await this.evaluateNode(e.test);)try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}async evaluateDoWhileStatement(e){do{try{await this.evaluateNode(e.body)}catch(e){if("break"===e.type&&!e.label)break;if("continue"===e.type&&!e.label)continue;throw e}}while(await this.evaluateNode(e.test))}async evaluateLabeledStatement(e){try{return await this.evaluateNode(e.body)}catch(t){if(("break"===t.type||"continue"===t.type)&&t.label===e.label){if("break"===t.type)return;throw t}throw t}}async evaluateSwitchStatement(e){const t=await this.evaluateNode(e.discriminant);let s=!1;for(const n of e.cases){if(!s)if(null===n.test)s=!0;else{t===await this.evaluateNode(n.test)&&(s=!0)}if(s)try{for(const e of n.consequent)await this.evaluateNode(e)}catch(e){if("break"===e.type)break;throw e}}}async evaluateTryStatement(e){let t;try{t=await this.evaluateNode(e.block)}catch(s){if(s&&"object"==typeof s&&("break"===s.type||"continue"===s.type||"return"===s.type))throw s;if(!e.handler)throw s;e.handler.param&&this.assignPattern(e.handler.param,s),t=await this.evaluateNode(e.handler.body)}finally{if(e.finalizer){t=await this.evaluateNode(e.finalizer)}}return t}evaluateIdentifier(e){const t=e.name;if("_"===t)return this.lastPipelineValue;if("this"===t&&console.log("Looking up this, context has:",this.currentContext.variables.has("this"),"value:",this.currentContext.variables.get("this")),this.currentContext.variables.has(t))return this.currentContext.variables.get(t);let s=this.currentContext.parent;for(;s;){if(s.variables.has(t))return s.variables.get(t);s=s.parent}if(this.currentContext.functions.has(t))return this.currentContext.functions.get(t);if(this.globalContext.functions.has(t))return this.globalContext.functions.get(t);if(this.currentContext.classes.has(t))return this.currentContext.classes.get(t);throw new i(t,[...this.currentContext.variables.keys()])}async evaluateCallExpression(e){if("Super"===e.callee.type){const t=this.currentContext.variables.get("__super__");if(!t)throw new r("super() can only be called in a derived class constructor",{type:"RuntimeError"});const s=[];for(const t of e.arguments)if("SpreadElement"===t.type){const e=await this.evaluateNode(t.argument);s.push(...e)}else s.push(await this.evaluateNode(t));return t(...s)}let t,s=null;if("MemberExpression"===e.callee.type){const n=await this.evaluateNode(e.callee.object),r=e.callee.computed?await this.evaluateNode(e.callee.property):e.callee.property.name;t=n?.[r],s=n}else t=await this.evaluateNode(e.callee);if("function"!=typeof t)throw new a("function",t,"call expression");const n=[];for(const t of e.arguments)if("SpreadElement"===t.type){const e=await this.evaluateNode(t.argument);n.push(...e)}else n.push(await this.evaluateNode(t));const o=n.map(e=>void 0===e&&void 0!==this.lastPipelineValue?this.lastPipelineValue:e);return t.apply(s,o)}async evaluatePipelineExpression(e){let t=await this.evaluateNode(e.left);this.lastPipelineValue=t;const s=await this.evaluateNode(e.right);return t="function"==typeof s?await s(t):s,this.lastPipelineValue=t,t}async evaluateBinaryExpression(e){const t=await this.evaluateNode(e.left),s=await this.evaluateNode(e.right);switch(e.operator){case"+":return t+s;case"-":return t-s;case"*":return t*s;case"/":return t/s;case"%":return t%s;case"**":return t**s;case"==":return t==s;case"!=":return t!=s;case"===":return t===s;case"!==":return t!==s;case"<":return t<s;case">":return t>s;case"<=":return t<=s;case">=":return t>=s;case"&&":return t&&s;case"||":return t||s;case"??":return t??s;default:throw new r(`Unknown binary operator: ${e.operator}`,{type:"RuntimeError"})}}async evaluateUnaryExpression(e){if("++"===e.operator||"--"===e.operator){if("Identifier"!==e.argument.type)throw new r("Prefix increment/decrement only supports identifiers",{type:"RuntimeError"});const t=e.argument.name,s=this.evaluateIdentifier(e.argument)||0,n="++"===e.operator?s+1:s-1;let o=this.currentContext;for(;o;){if(o.variables.has(t)){o.variables.set(t,n);break}o=o.parent}return o||this.currentContext.variables.set(t,n),n}if("typeof"===e.operator){if("Identifier"===e.argument.type){const t=e.argument.name;let s=this.currentContext;for(;s;){if(s.variables.has(t)){return typeof s.variables.get(t)}if(s.functions.has(t))return"function";s=s.parent}return this.currentContext.functions.has(t)?"function":"undefined"}return typeof await this.evaluateNode(e.argument)}const t=await this.evaluateNode(e.argument);switch(e.operator){case"!":return!t;case"+":return+t;case"-":return-t;case"await":return await t;default:throw new r(`Unknown unary operator: ${e.operator}`,{type:"RuntimeError"})}}async evaluateAssignmentExpression(e){const t=await this.evaluateNode(e.right);if("Identifier"===e.left.type){const s=e.left.name;switch(e.operator){case"=":let n=this.currentContext,o=!1;for(;n;){if(n.variables.has(s)){if("const"===n.variableKinds.get(s))throw new r(`Cannot reassign const variable "${s}"`);n.variables.set(s,t),o=!0;break}n=n.parent}return o||this.currentContext.variables.set(s,t),t;case"+=":const a=(this.evaluateIdentifier(e.left)||0)+t;let i=this.currentContext;for(;i;){if(i.variables.has(s)){if("const"===i.variableKinds.get(s))throw new r(`Cannot reassign const variable "${s}"`);i.variables.set(s,a);break}i=i.parent}return i||this.currentContext.variables.set(s,a),a;case"-=":const l=(this.evaluateIdentifier(e.left)||0)-t;let c=this.currentContext;for(;c;){if(c.variables.has(s)){if("const"===c.variableKinds.get(s))throw new r(`Cannot reassign const variable "${s}"`);c.variables.set(s,l);break}c=c.parent}return c||this.currentContext.variables.set(s,l),l;case"*=":const u=(this.evaluateIdentifier(e.left)||0)*t;let p=this.currentContext;for(;p;){if(p.variables.has(s)){if("const"===p.variableKinds.get(s))throw new r(`Cannot reassign const variable "${s}"`);p.variables.set(s,u);break}p=p.parent}return p||this.currentContext.variables.set(s,u),u;case"/=":const m=this.evaluateIdentifier(e.left)||0;if(0===t)throw new r("Division by zero in /= operation");const f=m/t;let y=this.currentContext;for(;y;){if(y.variables.has(s)){if("const"===y.variableKinds.get(s))throw new r(`Cannot reassign const variable "${s}"`);y.variables.set(s,f);break}y=y.parent}return y||this.currentContext.variables.set(s,f),f;default:throw new r(`Assignment operator ${e.operator} not implemented`,{type:"RuntimeError"})}}else if("MemberExpression"===e.left.type){const s=await this.evaluateNode(e.left.object),n=e.left.computed?await this.evaluateNode(e.left.property):e.left.property.name;if(null==s)throw new r(`Cannot set property '${n}' on null or undefined`,{type:"RuntimeError"});switch(e.operator){case"=":return s[n]=t,t;case"+=":return s[n]=(s[n]||0)+t,s[n];case"-=":return s[n]=(s[n]||0)-t,s[n];case"*=":return s[n]=(s[n]||0)*t,s[n];case"/=":if(0===t)throw new r("Division by zero in /= operation");return s[n]=(s[n]||0)/t,s[n];default:throw new r(`Assignment operator ${e.operator} not implemented for member expressions`,{type:"RuntimeError"})}}throw new r("Complex assignment patterns not yet implemented",{type:"RuntimeError"})}async evaluateUpdateExpression(e){if("Identifier"===e.argument.type){const t=e.argument.name,s=this.evaluateIdentifier(e.argument)||0,n="++"===e.operator?s+1:s-1;let o=this.currentContext;for(;o;){if(o.variables.has(t)){if("const"===o.variableKinds.get(t))throw new r(`Cannot reassign const variable "${t}"`);o.variables.set(t,n);break}o=o.parent}return o||this.currentContext.variables.set(t,n),e.prefix?n:s}if("MemberExpression"===e.argument.type){const t=await this.evaluateNode(e.argument.object),s=e.argument.computed?await this.evaluateNode(e.argument.property):e.argument.property.name;if(null==t)throw new r(`Cannot update property '${s}' on null or undefined`,{type:"RuntimeError"});const n=t[s]||0,o="++"===e.operator?n+1:n-1;return t[s]=o,e.prefix?o:n}throw new r("Update expression only supports identifiers and member expressions",{type:"RuntimeError"})}async evaluateConditionalExpression(e){return await this.evaluateNode(e.test)?await this.evaluateNode(e.consequent):await this.evaluateNode(e.alternate)}async evaluateMemberExpression(e){const t=await this.evaluateNode(e.object);if(e.optional&&null==t)return;if(!e.optional&&null==t){const s=e.computed?"computed property":e.property.name;throw new Error(`Cannot read properties of ${t} (reading '${s}')`)}return t[e.computed?await this.evaluateNode(e.property):e.property.name]}async evaluateNewExpression(e){const t=await this.evaluateNode(e.callee);if("function"!=typeof t)throw new a("constructor",t,"new expression");const s=[];for(const t of e.arguments)s.push(await this.evaluateNode(t));if(t===Date||t===Error||t===Array||t===Object||t===RegExp||t===Map||t===Set||t===Promise)return new t(...s);return await t(...s)}async evaluateArrayExpression(e){const t=[];for(const s of e.elements)if(s)if("SpreadElement"===s.type){const e=await this.evaluateNode(s.argument);t.push(...e)}else t.push(await this.evaluateNode(s));else t.push(void 0);return t}async evaluateObjectExpression(e){const t={};for(const s of e.properties)if("SpreadElement"===s.type){const e=await this.evaluateNode(s.argument);Object.assign(t,e)}else if("Property"===s.type){const e=s.computed?await this.evaluateNode(s.key):s.key.name||s.key.value||s.key;s.shorthand?t[e]=this.evaluateIdentifier({name:e}):t[e]=await this.evaluateNode(s.value)}return t}async evaluateTemplateLiteral(e){if(e.quasis&&e.quasis.length>0){const t=e.quasis[0].value.raw;return t.includes("${")?await this.interpolateTemplate(t):t}const t=e.raw||e.value;if("string"==typeof t&&t.startsWith("`")&&t.endsWith("`")){const e=t.slice(1,-1);return await this.interpolateTemplate(e)}return e.value||""}async interpolateTemplate(e){const t=/\$\{([^}]+)\}/g;let s,n=e;const r=[];for(;null!==(s=t.exec(e));){const e=s[1];try{const t=e.trim(),n=await this.evaluateTemplateExpression(t);r.push({start:s.index,end:s.index+s[0].length,value:String(n)})}catch(t){console.warn(`Failed to evaluate template expression: ${e}`)}}for(let e=r.length-1;e>=0;e--){const t=r[e];n=n.slice(0,t.start)+t.value+n.slice(t.end)}return n}async evaluateTemplateExpression(e){if(/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e))return this.evaluateIdentifier({name:e});const t=e.match(/^(.+?)\s*([\+\-\*\/])\s*(.+)$/);if(t){const s=await this.evaluateTemplateExpression(t[1].trim()),n=await this.evaluateTemplateExpression(t[3].trim());switch(t[2]){case"+":return s+n;case"-":return s-n;case"*":return s*n;case"/":return s/n;default:return e}}if(e.includes(".")){const t=e.split(".");let s=await this.evaluateTemplateExpression(t[0]);for(let e=1;e<t.length;e++)s=s[t[e]];return s}const s=Number(e);return isNaN(s)?e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e:s}async evaluateImport(e){const t=e.source.value||e.source,s=await this.importModule(t);for(const t of e.specifiers)if("ImportNamespaceSpecifier"===t.type){const e=t.local.name||t.local;this.currentContext.variables.set(e,s)}else if("ImportSpecifier"===t.type){const e=t.imported.name||t.imported,n=t.local.name||t.local,r=s[e];this.currentContext.variables.set(n,r)}}async evaluateExport(e){if(e.declaration)if(await this.evaluateNode(e.declaration),"VariableDeclaration"===e.declaration.type){for(const t of e.declaration.declarations)if("Identifier"===t.id.type){const e=this.currentContext.variables.get(t.id.name);this.currentContext.exports.set(t.id.name,e),this.currentContext.moduleExports&&(this.currentContext.moduleExports[t.id.name]=e)}}else if("FunctionDeclaration"===e.declaration.type){const t=this.currentContext.functions.get(e.declaration.id.name);this.currentContext.exports.set(e.declaration.id.name,t),this.currentContext.moduleExports&&(this.currentContext.moduleExports[e.declaration.id.name]=t)}else if("ClassDeclaration"===e.declaration.type){const t=this.currentContext.classes.get(e.declaration.id.name);this.currentContext.exports.set(e.declaration.id.name,t),this.currentContext.moduleExports&&(this.currentContext.moduleExports[e.declaration.id.name]=t)}for(const t of e.specifiers||[]){const e=this.currentContext.variables.get(t.local)||this.currentContext.functions.get(t.local)||this.currentContext.classes.get(t.local);this.currentContext.exports.set(t.exported,e),this.currentContext.moduleExports&&(this.currentContext.moduleExports[t.exported]=e)}}async importModule(e){if(this.globalModuleCache.has(e))return this.globalModuleCache.get(e);const t={};this.globalModuleCache.set(e,t);const{code:s}=await this.moduleResolver.resolve(e),n=this.createContext(this.globalContext);return n.moduleExports=t,await this.execute(s,n),n.exports.forEach((e,s)=>{t[s]=e}),t}}class g extends v{constructor(e={}){super(e),this.operationCounter=0,this.contextIdMap=new Map,this.idContextMap=new Map,this.nextContextId=0,this.pauseCheckInterval=e.pauseCheckInterval??10,this.executionState={type:"completed",callStack:[]}}pause(){"running"===this.executionState.type&&(this.executionState.pauseRequested=!0)}async resume(){if("paused"!==this.executionState.type)throw new Error("Interpreter is not paused");this.executionState.type="running",this.executionState.pauseRequested=!1;try{const e=await this.resumeFromCallStack();return this.executionState.type="completed",this.executionState.result=e,e}catch(e){throw this.executionState.type="error",this.executionState.error=e,e}}async checkPause(){if(this.operationCounter++,this.operationCounter%this.pauseCheckInterval===0&&await new Promise(e=>setTimeout(e,0)),this.executionState.pauseRequested)throw this.executionState.type="paused",this.executionState.pauseRequested=!1,{type:"pause",state:this.executionState}}async evaluateNode(e){await this.checkPause(),this.executionState.currentNode=e;let t;["FunctionDeclaration","FunctionExpression","ArrowFunctionExpression","BlockStatement","ForStatement","WhileStatement","DoWhileStatement"].includes(e.type)&&(t={type:this.getFrameType(e.type),node:e,context:this.currentContext,name:e.id?.name},this.executionState.callStack.push(t));try{const s=await super.evaluateNode(e);return t&&this.executionState.callStack.pop(),s}catch(e){if(e&&"object"==typeof e&&"pause"===e.type)throw e;throw t&&this.executionState.callStack.pop(),e}}async execute(e,t){this.executionState={type:"running",callStack:[]};const{grammar:s,nearley:n}=await Promise.resolve().then(function(){return x}),r=new n.Parser(n.Grammar.fromCompiled(s));try{if(r.feed(e),0===r.results.length)throw new Error("No parse found");r.results.length>1&&console.warn("Ambiguous grammar detected, using first parse");const s=r.results[0],n=t||this.globalContext,o=this.currentContext;this.currentContext=n;try{const e=await this.evaluateNode(s);return this.executionState.type="completed",this.executionState.result=e,e}finally{this.currentContext=o}}catch(e){if(e&&"object"==typeof e&&"pause"===e.type)return;if(e&&"object"==typeof e&&"return"===e.type)return this.executionState.type="completed",this.executionState.result=e.value,e.value;throw this.executionState.type="error",this.executionState.error=e,e}}getExecutionState(){return{...this.executionState}}serialize(){return this.assignContextIds(this.globalContext),{version:"1.0.0",globalContext:this.serializeContext(this.globalContext),currentContext:this.serializeContext(this.currentContext),executionState:this.serializeExecutionState(),moduleCache:Array.from(this.globalModuleCache.entries()),lastPipelineValue:this.lastPipelineValue,customFunctions:Array.from(this.globalContext.functions.keys())}}static async deserialize(e,t={}){const s=new g({moduleResolver:t.moduleResolver||new l,functions:t.functions});return s.deserializeContexts(e),e.moduleCache.forEach(([e,t])=>{s.globalModuleCache.set(e,t)}),s.executionState=s.deserializeExecutionState(e.executionState),s.lastPipelineValue=e.lastPipelineValue,s}assignContextIds(e,t=new Set){if(t.has(e))return;t.add(e);const s="ctx_"+this.nextContextId++;this.contextIdMap.set(e,s),this.idContextMap.set(s,e),e.parent&&this.assignContextIds(e.parent,t)}serializeContext(e){const t=e.parent?this.contextIdMap.get(e.parent):void 0;return{variables:Array.from(e.variables.entries()).map(([e,t])=>[e,this.serializeValue(t)]),variableKinds:Array.from(e.variableKinds.entries()),functionNames:Array.from(e.functions.keys()),classNames:Array.from(e.classes.keys()),exports:Array.from(e.exports.entries()).map(([e,t])=>[e,this.serializeValue(t)]),parentId:t,moduleCache:Array.from(e.moduleCache.entries())}}serializeValue(e){if(void 0===e)return{__type:"undefined"};if(null===e)return null;if("function"==typeof e)return{__type:"function",name:e.name||"anonymous"};if(e instanceof Date)return{__type:"Date",value:e.toISOString()};if(e instanceof RegExp)return{__type:"RegExp",source:e.source,flags:e.flags};if(e instanceof Map)return{__type:"Map",entries:Array.from(e.entries())};if(e instanceof Set)return{__type:"Set",values:Array.from(e.values())};if("object"==typeof e)try{return JSON.parse(JSON.stringify(e))}catch{return{__type:"circular_reference"}}return e}deserializeValue(e){if(e&&"object"==typeof e&&"__type"in e)switch(e.__type){case"undefined":return;case"function":return()=>{throw new Error(`Function ${e.name} needs to be re-bound`)};case"Date":return new Date(e.value);case"RegExp":return new RegExp(e.source,e.flags);case"Map":return new Map(e.entries);case"Set":return new Set(e.values);case"circular_reference":return null}return e}serializeExecutionState(){return{...this.executionState,callStack:this.executionState.callStack.map(e=>({...e,context:this.serializeContext(e.context)}))}}deserializeExecutionState(e){return{...e,callStack:e.callStack.map(e=>({...e,context:this.idContextMap.get(e.context.parentId)||this.currentContext}))}}deserializeContexts(e){const t=new Map,s=this.createContext();if(this.restoreContextData(s,e.globalContext),t.set("global",s),this.globalContext=s,e.currentContext===e.globalContext)this.currentContext=s;else{const s=this.createContext();this.restoreContextData(s,e.currentContext),t.set("current",s),this.currentContext=s}e.currentContext.parentId&&(this.currentContext.parent=t.get(e.currentContext.parentId))}restoreContextData(e,t){t.variables.forEach(([t,s])=>{const n=this.deserializeValue(s);e.variables.set(t,n)}),t.variableKinds.forEach(([t,s])=>{e.variableKinds.set(t,s)}),t.variables.some(([e])=>"Date"===e)&&e.variables.set("Date",Date),t.variables.some(([e])=>"Error"===e)&&e.variables.set("Error",Error),t.exports.forEach(([t,s])=>{e.exports.set(t,this.deserializeValue(s))}),t.moduleCache.forEach(([t,s])=>{e.moduleCache.set(t,s)})}getFrameType(e){switch(e){case"FunctionDeclaration":case"FunctionExpression":case"ArrowFunctionExpression":return"function";case"BlockStatement":default:return"block";case"ForStatement":case"WhileStatement":case"DoWhileStatement":return"loop";case"Program":return"program"}}async resumeFromCallStack(){const e=this.executionState.callStack[this.executionState.callStack.length-1];if(!e)throw new Error("No frame to resume from");return this.currentContext=e.context,this.evaluateNode(e.node)}getCallStackTrace(){return this.executionState.callStack.map(e=>{const t=e.name||"<anonymous>";return`${e.type}: ${t}`})}getCurrentVariables(){const e={};let t=this.currentContext;for(;t;)t.variables.forEach((t,s)=>{s in e||(e[s]=t)}),t=t.parent;return e}isPaused(){return"paused"===this.executionState.type}isRunning(){return"running"===this.executionState.type}isCompleted(){return"completed"===this.executionState.type}hasError(){return"error"===this.executionState.type}}class E{validate(e,t={}){try{const s=new d.nearley.Parser(d.nearley.Grammar.fromCompiled(d.grammar));return s.feed(e),0===s.results.length?{valid:!1,error:{message:"No valid parse found",line:0,column:0}}:(s.results.length>1&&console.warn(`Grammar ambiguity: ${s.results.length} possible parses found`),{valid:!0,ast:t.includeAST?s.results[0]:void 0})}catch(t){return this.formatError(t,e)}}formatError(e,t){const s=e.message||e.toString(),n=s.match(/line (\d+) col (\d+)/),r=n?parseInt(n[1]):0,o=n?parseInt(n[2]):0,a=t.split("\n");let i,l="";if(n&&r>0){l=`Parse error: Syntax error at line ${r} col ${o}:\n\n`;const e=Math.max(0,r-3),t=Math.min(a.length,r);for(let s=e;s<t;s++){const e=s+1,t=a[s];l+=`${String(e).padStart(String(r).length," ")} ${t}\n`}l+=" ".repeat(String(r).length+o)+"^\n";const n=s.match(/Unexpected (.+?) token: "(.+?)"/);n&&(l+=`Unexpected ${n[1]} token: "${n[2]}". `);const i=s.match(/Instead, I was expecting to see one of the following:([\s\S]*)/);if(i){l+="Instead, I was expecting to see one of the following:\n";const e=i[1].trim(),t=e.split("\n").slice(0,10);for(const e of t)e.trim()&&(l+="\n"+e);e.split("\n").length>10&&(l+="\n... and more")}}else l=s;return(s.includes("Unexpected identifier")||s.includes("Unexpected /"))&&r>0&&a[r-1]&&a[r-1].includes("match(")?i='This appears to be a regex pattern containing HTML tags (e.g., </a>). The parser may be interpreting "</" as operators. Try escaping the forward slash in closing tags: "<\\/a>" instead of "</a>".':s.includes("Unexpected ) token")||s.includes("Unexpected }")?i="Check for missing commas between object properties, or a missing closing brace/bracket earlier in the code.":s.includes("Unexpected NL token")&&s.includes("=>")?i='Arrow functions with newlines require braces. Change "=> \\n expression" to either "=> expression" (single line) or "=> { return expression }" (with braces).':s.includes("Unexpected NL token")&&s.includes("ArrowBody")?i="Multi-line arrow function bodies must use braces. Wrap your expression in { return ... }":s.includes("Unexpected identifier")?i="Check for missing operators, commas, or semicolons between statements.":(s.includes("|>")||s.includes("->"))&&(i="Pipeline operators must be followed by a valid expression or function call."),{valid:!1,error:{message:l,line:r,column:o,suggestion:i}}}checkSyntaxPatterns(e){return{hasMultilineArrows:/=>\s*\n\s*[^{]/.test(e),hasPipelines:/\|>|->/.test(e),hasAsyncAwait:/\basync\b|\bawait\b/.test(e),hasClasses:/\bclass\b/.test(e),hasModules:/\bimport\b|\bexport\b/.test(e)}}suggestFixes(e){const t=[];return this.checkSyntaxPatterns(e).hasMultilineArrows&&t.push("Found multi-line arrow functions without braces. Consider using braces for multi-line arrow function bodies."),/\)\s*\n\s*{/.test(e)&&!/"function"/.test(e)&&t.push("Found newline between closing parenthesis and opening brace. This might cause parsing issues in some contexts."),/,\s*}/.test(e)&&t.push("Found trailing comma before closing brace. While valid in JavaScript, ensure Wang supports this."),t}}const w=new E;e.CircularDependencyError=class extends r{constructor(e){super(`Circular dependency detected:\n   ${e.join(" â†’ ")} â†’ ${e[0]}`,{type:"ModuleError",suggestions:["Move shared code to a separate module","Use dynamic imports for one direction","Refactor to remove the circular dependency"]})}},e.FunctionNotFoundError=class extends r{constructor(e,t){const s=[],n=t.filter(t=>t.includes(e)||e.includes(t)).slice(0,5);n.length>0&&s.push(`Available similar functions: ${n.join(", ")}`),s.push("Check the function name spelling"),s.push("Ensure the function is imported or defined"),s.push(`Available functions: ${t.slice(0,10).join(", ")}...`),super(`Function "${e}" is not defined`,{type:"RuntimeError",suggestions:s})}},e.InMemoryModuleResolver=l,e.ModuleNotFoundError=o,e.ModuleResolver=s,e.PausableWangInterpreter=g,e.TypeMismatchError=a,e.UndefinedVariableError=i,e.VERSION="0.1.0",e.WangError=r,e.WangInterpreter=v,e.WangValidator=E,e.createInterpreter=function(e){return new v(e)},e.validator=w});
//# sourceMappingURL=wang.min.js.map
