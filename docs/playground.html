<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wang Playground - Interactive IDE</title>
    <meta name="description" content="Interactive Wang language playground with professional IDE features">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'mono': ['JetBrains Mono', 'Monaco', 'Consolas', 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <!-- Monaco Editor -->
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Monaco overrides for dark mode */
        .dark .monaco-editor,
        .dark .monaco-editor-background,
        .dark .monaco-editor .inputarea.ime-input {
            background-color: #111827 !important;
        }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dark .glass {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        /* Panel resize handle */
        .resize-handle {
            position: relative;
            cursor: col-resize;
            user-select: none;
        }
        
        .resize-handle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 30px;
            background: currentColor;
            border-radius: 3px;
            opacity: 0.3;
            transition: opacity 0.2s;
        }
        
        .resize-handle:hover::after {
            opacity: 0.6;
        }
        
        /* Mobile and Tablet Responsive Styles */
        @media (max-width: 768px) {
            .resize-handle {
                display: none;
            }
            
            #editor-panel,
            #output-panel {
                flex: 1 !important;
            }
            
            .mobile-tab-active {
                display: block !important;
            }
            
            .mobile-tab-inactive {
                display: none !important;
            }
        }
        
        @media (max-width: 640px) {
            /* Hide desktop-only elements */
            .desktop-only {
                display: none !important;
            }
            
            /* Stack layout for mobile */
            .mobile-stack {
                flex-direction: column !important;
            }
            
            /* Touch-friendly sizes */
            button {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 4px;
        }
        
        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans overflow-hidden">
    <!-- Main Container -->
    <div class="h-full flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2 flex items-center justify-between flex-shrink-0">
            <div class="flex items-center gap-3">
                <div class="text-emerald-500 dark:text-emerald-400">
                    <i class="fas fa-code text-xl"></i>
                </div>
                <h1 class="text-lg font-semibold hidden sm:block">Wang Playground</h1>
                <h1 class="text-lg font-semibold sm:hidden">Wang</h1>
                <span class="text-xs px-2 py-1 bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300 rounded-full hidden sm:inline">v0.14</span>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- Run Button -->
                <button id="run-btn" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg flex items-center gap-2 transition-colors">
                    <i class="fas fa-play text-sm"></i>
                    <span class="hidden sm:inline">Run</span>
                    <kbd class="hidden md:inline text-xs bg-emerald-600 px-1 py-0.5 rounded">Ctrl+Enter</kbd>
                </button>
                
                <!-- Validate Button -->
                <button id="validate-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg flex items-center gap-2 transition-colors">
                    <i class="fas fa-check-circle text-sm"></i>
                    <span class="hidden sm:inline">Validate</span>
                </button>
                
                <!-- Examples Dropdown -->
                <div class="relative">
                    <button id="examples-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg flex items-center gap-2 transition-colors">
                        <i class="fas fa-book text-sm"></i>
                        <span class="hidden sm:inline">Examples</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div id="examples-menu" class="absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hidden z-50 max-h-96 overflow-y-auto">
                        <div class="p-2 space-y-1">
                            <div class="px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Basics</div>
                            <button data-example="hello" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Hello World</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Basic Wang syntax</div>
                            </button>
                            <button data-example="variables" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Variables & Types</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">let, const, var declarations</div>
                            </button>
                            
                            <div class="px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mt-2">Advanced</div>
                            <button data-example="pipeline" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Pipeline Operations</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Using |> and -> operators</div>
                            </button>
                            <button data-example="async" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Async/Await</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Asynchronous operations</div>
                            </button>
                            <button data-example="class" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Classes</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">OOP with inheritance</div>
                            </button>
                            <button data-example="modules" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Modules</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Import/export system</div>
                            </button>
                            
                            <div class="px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mt-2">Patterns</div>
                            <button data-example="chaining" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Method Chaining</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Optional chaining & nullish coalescing</div>
                            </button>
                            <button data-example="destructuring" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Destructuring</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Array & object destructuring</div>
                            </button>
                            <button data-example="errorhandling" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                                <div class="font-medium text-sm">Error Handling</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Try/catch patterns</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Separator -->
                <div class="w-px h-8 bg-gray-300 dark:bg-gray-600"></div>
                
                <!-- Import/Export Buttons -->
                <button id="import-btn" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors" title="Import code">
                    <i class="fas fa-file-import"></i>
                </button>
                
                <button id="export-btn" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors" title="Export code">
                    <i class="fas fa-file-export"></i>
                </button>
                
                <!-- Share Button -->
                <button id="share-btn" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors" title="Share URL">
                    <i class="fas fa-share-nodes"></i>
                </button>
                
                <!-- Settings Button -->
                <button id="settings-btn" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <i class="fas fa-cog"></i>
                </button>
                
                <!-- Theme Toggle -->
                <button id="theme-btn" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
                
                <!-- GitHub Link -->
                <a href="https://github.com/artpar/wang" target="_blank" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </header>
        
        <!-- Mobile Tab Switcher (hidden on desktop) -->
        <div class="hidden mobile-tabs bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-2 py-1 sm:hidden">
            <div class="flex gap-2">
                <button class="mobile-tab-btn px-3 py-1 rounded text-sm font-medium bg-emerald-500 text-white" data-panel="editor">Editor</button>
                <button class="mobile-tab-btn px-3 py-1 rounded text-sm font-medium bg-gray-200 dark:bg-gray-700" data-panel="output">Output</button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="flex-1 flex overflow-hidden mobile-stack">
            <!-- Sidebar -->
            <aside id="sidebar" class="w-12 bg-gray-100 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col items-center py-2 gap-1 flex-shrink-0">
                <button class="sidebar-btn p-2.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-emerald-500" title="Editor">
                    <i class="fas fa-code"></i>
                </button>
                <button class="sidebar-btn p-2.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700" title="Output">
                    <i class="fas fa-terminal"></i>
                </button>
                <button class="sidebar-btn p-2.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700" title="Console">
                    <i class="fas fa-bug"></i>
                </button>
                <button class="sidebar-btn p-2.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700" title="Files">
                    <i class="fas fa-folder"></i>
                </button>
                
                <div class="flex-1"></div>
                
                <button id="shortcuts-btn" class="sidebar-btn p-2.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700" title="Shortcuts">
                    <i class="fas fa-keyboard"></i>
                </button>
            </aside>
            
            <!-- Editor and Output Panels -->
            <div class="flex-1 flex overflow-hidden mobile-stack">
                <!-- Editor Panel -->
                <div id="editor-panel" class="flex flex-col bg-white dark:bg-gray-900 mobile-tab-active" style="flex: 2;">
                    <!-- Editor Header -->
                    <div class="bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-3 py-1 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium">main.wang</span>
                            <span id="modified-indicator" class="text-xs text-orange-500 hidden">●</span>
                        </div>
                        <div class="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400">
                            <span id="cursor-position">Ln 1, Col 1</span>
                            <span id="selection-info"></span>
                            <span id="exec-time" class="hidden">
                                <i class="fas fa-clock text-emerald-500"></i>
                                <span id="exec-time-value">0ms</span>
                            </span>
                        </div>
                    </div>
                    <!-- Monaco Editor Container -->
                    <div id="editor-container" class="flex-1"></div>
                </div>
                
                <!-- Resizer -->
                <div id="resizer" class="resize-handle w-1 bg-gray-200 dark:bg-gray-700 hover:bg-emerald-500 transition-colors"></div>
                
                <!-- Output Panel -->
                <div id="output-panel" class="flex flex-col bg-white dark:bg-gray-900 mobile-tab-inactive" style="flex: 1;">
                    <!-- Output Header -->
                    <div class="bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-3 py-1 flex items-center justify-between">
                        <div class="flex gap-4">
                            <button class="tab-btn text-sm font-medium text-emerald-500 border-b-2 border-emerald-500 pb-1" data-tab="output">Output</button>
                            <button class="tab-btn text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 pb-1" data-tab="ast">AST</button>
                            <button class="tab-btn text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 pb-1" data-tab="console">Console</button>
                            <button class="tab-btn text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 pb-1" data-tab="debug">Debug</button>
                        </div>
                        <div class="flex gap-2">
                            <button id="export-output" class="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors" title="Export output">
                                <i class="fas fa-download text-xs"></i>
                            </button>
                            <button id="clear-output" class="p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors" title="Clear output">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Output Container -->
                    <div id="output-container" class="flex-1 overflow-y-auto p-4 font-mono text-sm">
                        <div class="text-gray-500 dark:text-gray-400">
                            <i class="fas fa-info-circle"></i> Ready. Press <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">Ctrl+Enter</kbd> to run your code.
                        </div>
                    </div>
                    
                    <!-- Debug Panel (hidden by default) -->
                    <div id="debug-container" class="hidden flex-1 overflow-y-auto p-4">
                        <div class="space-y-4">
                            <!-- Debug Controls -->
                            <div class="flex gap-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                <button id="debug-run" class="px-3 py-1 bg-emerald-500 hover:bg-emerald-600 text-white rounded text-sm" title="Run with debugger">
                                    <i class="fas fa-bug"></i> Debug
                                </button>
                                <button id="debug-step" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded text-sm disabled:opacity-50" disabled>
                                    <i class="fas fa-step-forward"></i> Step
                                </button>
                                <button id="debug-continue" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded text-sm disabled:opacity-50" disabled>
                                    <i class="fas fa-play"></i> Continue
                                </button>
                                <button id="debug-stop" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded text-sm disabled:opacity-50" disabled>
                                    <i class="fas fa-stop"></i> Stop
                                </button>
                            </div>
                            
                            <!-- Variables -->
                            <div>
                                <h3 class="text-sm font-semibold mb-2">Variables</h3>
                                <div id="debug-variables" class="bg-gray-50 dark:bg-gray-800 rounded p-2 font-mono text-xs">
                                    <div class="text-gray-500 dark:text-gray-400">No variables to display</div>
                                </div>
                            </div>
                            
                            <!-- Call Stack -->
                            <div>
                                <h3 class="text-sm font-semibold mb-2">Call Stack</h3>
                                <div id="debug-callstack" class="bg-gray-50 dark:bg-gray-800 rounded p-2 font-mono text-xs">
                                    <div class="text-gray-500 dark:text-gray-400">No call stack</div>
                                </div>
                            </div>
                            
                            <!-- Breakpoints -->
                            <div>
                                <h3 class="text-sm font-semibold mb-2">Breakpoints</h3>
                                <div id="debug-breakpoints" class="bg-gray-50 dark:bg-gray-800 rounded p-2 text-xs">
                                    <div class="text-gray-500 dark:text-gray-400">Click in the gutter to add breakpoints</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <footer class="bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-1 flex items-center justify-between text-xs flex-shrink-0">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-1">
                    <div id="status-indicator" class="w-2 h-2 rounded-full bg-gray-400"></div>
                    <span id="status-text">Ready</span>
                </div>
                <span class="text-gray-500 dark:text-gray-400">Wang Language</span>
            </div>
            <div class="flex items-center gap-4 text-gray-500 dark:text-gray-400">
                <span>UTF-8</span>
                <span>Spaces: 2</span>
                <span id="memory-usage"></span>
            </div>
        </footer>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                <h2 class="text-lg font-semibold">Settings</h2>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Font Size</label>
                    <select id="font-size" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="12">12px</option>
                        <option value="14" selected>14px</option>
                        <option value="16">16px</option>
                        <option value="18">18px</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Tab Size</label>
                    <select id="tab-size" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="2" selected>2 spaces</option>
                        <option value="4">4 spaces</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-sm font-medium">Word Wrap</label>
                    <button id="word-wrap" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 dark:bg-gray-600 transition-colors">
                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
                    </button>
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-sm font-medium">Auto Save</label>
                    <button id="auto-save" class="relative inline-flex h-6 w-11 items-center rounded-full bg-emerald-500 transition-colors">
                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
                    </button>
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-sm font-medium">Clear on Run</label>
                    <button id="clear-on-run" class="relative inline-flex h-6 w-11 items-center rounded-full bg-emerald-500 transition-colors">
                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
                    </button>
                </div>
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 px-6 py-3 flex justify-end">
                <button id="close-settings" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- Floating Action Button (Mobile) -->
    <button id="fab-run" class="fixed bottom-6 right-6 w-14 h-14 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full shadow-lg flex items-center justify-center z-40 sm:hidden transition-all transform hover:scale-110">
        <i class="fas fa-play"></i>
    </button>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex flex-col items-center gap-3">
            <div class="w-12 h-12 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
            <span class="text-sm font-medium">Compiling...</span>
        </div>
    </div>
    
    <!-- Shortcuts Modal -->
    <div id="shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                <h2 class="text-lg font-semibold">Keyboard Shortcuts</h2>
            </div>
            <div class="p-6 space-y-2">
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Run code</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+Enter</kbd>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Save to localStorage</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+S</kbd>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Toggle comment</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+/</kbd>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Find</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+F</kbd>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Replace</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+H</kbd>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-sm">Settings</span>
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl+,</kbd>
                </div>
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 px-6 py-3 flex justify-end">
                <button id="close-shortcuts" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- Load Wang Language from CDN (always latest) -->
    <script src="https://unpkg.com/wang-lang@latest/dist/browser/wang.min.js"></script>
    <script>
        // Wait for UMD module to load
        if (typeof Wang === 'undefined') {
            console.error('Wang failed to load from CDN');
            document.body.innerHTML = '<div style="color: red; padding: 20px; text-align: center;">Error: Failed to load Wang library from CDN. Please refresh the page.</div>' + document.body.innerHTML;
        } else {
            console.log('Wang loaded successfully:', Wang);
        }
    </script>
    
    <!-- Load Monaco Editor -->
    <script>
        var require = { paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.nls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.js"></script>
    
    <!-- Application Script -->
    <script>
        // Web Worker for non-blocking compilation
        let validationWorker = null;
        let compilationCache = new Map();
        let outputHistory = [];
        let currentHistoryIndex = -1;
        let breakpoints = new Set();
        let debuggerState = {
            enabled: false,
            stepping: false,
            currentLine: null,
            variables: {},
            callStack: []
        };
        
        // Initialize when everything is loaded
        function initializeApp() {
            if (typeof Wang === 'undefined' || typeof monaco === 'undefined') {
                console.log('Waiting for dependencies...', { Wang: typeof Wang, monaco: typeof monaco });
                setTimeout(initializeApp, 100);
                return;
            }
            
            console.log('Initializing app with Wang:', Wang);
            
            // Theme management
            const theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            }
            
            // Register Wang language with enhanced syntax highlighting
            monaco.languages.register({ id: 'wang' });
            monaco.languages.setMonarchTokensProvider('wang', {
                defaultToken: 'invalid',
                tokenPostfix: '.wang',
                
                keywords: [
                    'let', 'const', 'var', 'if', 'else', 'for', 'while', 'do',
                    'break', 'continue', 'return', 'function', 'class', 'extends',
                    'constructor', 'async', 'await', 'import', 'export', 'from', 'as',
                    'try', 'catch', 'finally', 'throw', 'this', 'super', 'new',
                    'typeof', 'instanceof', 'in', 'of'
                ],
                
                operators: [
                    '|>', '->', '=>', '+=', '-=', '*=', '/=', '===', '!==',
                    '==', '!=', '<=', '>=', '<<', '>>', '>>>', '&&', '||', '??',
                    '?.', '...', '++', '--', '**', '+', '-', '*', '/', '%',
                    '&', '|', '^', '~', '!', '?', ':', '=', '<', '>'
                ],
                
                symbols: /[=><!~?:&|+\-*\/\^%]+/,
                escapes: /\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,
                
                tokenizer: {
                    root: [
                        // Identifiers and keywords
                        [/[a-zA-Z_$][\w$]*/, {
                            cases: {
                                '@keywords': 'keyword',
                                'true|false|null|undefined': 'constant.language',
                                '@default': 'identifier'
                            }
                        }],
                        
                        // Whitespace and comments
                        [/[ \t\r\n]+/, 'white'],
                        [/\/\*/, 'comment', '@comment'],
                        [/\/\/.*$/, 'comment'],
                        
                        // Delimiters and operators
                        [/[{}()\[\]]/, '@brackets'],
                        [/[<>](?!@symbols)/, '@brackets'],
                        [/@symbols/, {
                            cases: {
                                '@operators': 'operator',
                                '@default': ''
                            }
                        }],
                        
                        // Numbers
                        [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float'],
                        [/0[xX][0-9a-fA-F]+/, 'number.hex'],
                        [/\d+/, 'number'],
                        
                        // Delimiter
                        [/[;,.]/, 'delimiter'],
                        
                        // Strings
                        [/"([^"\\]|\\.)*$/, 'string.invalid'],
                        [/'([^'\\]|\\.)*$/, 'string.invalid'],
                        [/"/, 'string', '@string_double'],
                        [/'/, 'string', '@string_single'],
                        
                        // Template literals
                        [/`/, 'string.template', '@template'],
                        
                        // Regular expressions
                        [/\/(?=([^\/\\]|\\.)+\/)/, 'regexp', '@regexp'],
                    ],
                    
                    whitespace: [
                        [/[ \t\r\n]+/, ''],
                        [/\/\*/, 'comment', '@comment'],
                        [/\/\/.*$/, 'comment'],
                    ],
                    
                    comment: [
                        [/[^\/*]+/, 'comment'],
                        [/\*\//, 'comment', '@pop'],
                        [/[\/*]/, 'comment']
                    ],
                    
                    string_double: [
                        [/[^\\"]+/, 'string'],
                        [/@escapes/, 'string.escape'],
                        [/\\./, 'string.escape.invalid'],
                        [/"/, 'string', '@pop']
                    ],
                    
                    string_single: [
                        [/[^\\']+/, 'string'],
                        [/@escapes/, 'string.escape'],
                        [/\\./, 'string.escape.invalid'],
                        [/'/, 'string', '@pop']
                    ],
                    
                    template: [
                        [/[^`\\$]+/, 'string.template'],
                        [/@escapes/, 'string.escape'],
                        [/\\./, 'string.escape.invalid'],
                        [/\${/, { token: 'delimiter.bracket', next: '@templateExpression' }],
                        [/`/, 'string.template', '@pop']
                    ],
                    
                    templateExpression: [
                        [/}/, { token: 'delimiter.bracket', next: '@pop' }],
                        { include: 'root' }
                    ],
                    
                    regexp: [
                        [/(\{)(\d+(?:,\d*)?)(\})/, ['regexp.escape.control', 'regexp.escape.control', 'regexp.escape.control']],
                        [/(\[)([^\]\\]|\\.)*(\])/, 'regexp.escape.control'],
                        [/(\()(\?:|\?=|\?!)/, ['regexp.escape.control', 'regexp.escape.control']],
                        [/[()]/, 'regexp.escape.control'],
                        [/@escapes/, 'regexp.escape'],
                        [/\\./, 'regexp.escape'],
                        [/\/[gimsuy]*/, { token: 'regexp', bracket: '@close', next: '@pop' }],
                        [/./, 'regexp']
                    ],
                },
            });
            
            // Configure language features
            monaco.languages.setLanguageConfiguration('wang', {
                comments: {
                    lineComment: '//',
                    blockComment: ['/*', '*/']
                },
                brackets: [
                    ['{', '}'],
                    ['[', ']'],
                    ['(', ')']
                ],
                autoClosingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"', notIn: ['string'] },
                    { open: "'", close: "'", notIn: ['string'] },
                    { open: '`', close: '`', notIn: ['string'] },
                    { open: '/*', close: '*/' }
                ],
                surroundingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"' },
                    { open: "'", close: "'" },
                    { open: '`', close: '`' }
                ],
                folding: {
                    markers: {
                        start: new RegExp("^\\s*//\\s*#?region\\b"),
                        end: new RegExp("^\\s*//\\s*#?endregion\\b")
                    }
                },
                indentationRules: {
                    increaseIndentPattern: new RegExp('^.*(\\{[^}]*|\\([^)]*|\\[[^\\]]*)$'),
                    decreaseIndentPattern: new RegExp('^\\s*(\\}|\\)|\\])')
                }
            });
            
            // Define custom Wang theme
            monaco.editor.defineTheme('wang-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'keyword', foreground: 'ff79c6' },
                    { token: 'keyword.operator.pipeline', foreground: 'ff79c6', fontStyle: 'bold' },
                    { token: 'operator', foreground: 'ffb86c' },
                    { token: 'string', foreground: '50fa7b' },
                    { token: 'string.template', foreground: '50fa7b' },
                    { token: 'string.escape', foreground: 'f1fa8c' },
                    { token: 'comment', foreground: '6272a4', fontStyle: 'italic' },
                    { token: 'number', foreground: 'bd93f9' },
                    { token: 'number.float', foreground: 'bd93f9' },
                    { token: 'number.hex', foreground: 'bd93f9' },
                    { token: 'constant.language', foreground: 'bd93f9' },
                    { token: 'regexp', foreground: 'ff5555' },
                    { token: 'identifier', foreground: 'f8f8f2' },
                    { token: 'delimiter', foreground: 'f8f8f2' },
                    { token: 'delimiter.bracket', foreground: 'ff79c6' }
                ],
                colors: {
                    'editor.background': '#1e1f29',
                    'editor.foreground': '#f8f8f2',
                    'editor.lineHighlightBackground': '#282a36',
                    'editor.selectionBackground': '#44475a',
                    'editorCursor.foreground': '#50fa7b',
                    'editorWhitespace.foreground': '#3B3A32'
                }
            });
            
            monaco.editor.defineTheme('wang-light', {
                base: 'vs',
                inherit: true,
                rules: [
                    { token: 'keyword', foreground: 'd73a49' },
                    { token: 'keyword.operator.pipeline', foreground: 'd73a49', fontStyle: 'bold' },
                    { token: 'operator', foreground: 'a626a4' },
                    { token: 'string', foreground: '50a14f' },
                    { token: 'string.template', foreground: '50a14f' },
                    { token: 'comment', foreground: '969896', fontStyle: 'italic' },
                    { token: 'number', foreground: '986801' },
                    { token: 'constant.language', foreground: '0184bc' },
                    { token: 'regexp', foreground: 'c18401' }
                ]
            });
            
            // Create Monaco editor with debugging features
            const editor = monaco.editor.create(document.getElementById('editor-container'), {
                glyphMargin: true,  // Enable glyph margin for breakpoints
                value: localStorage.getItem('wang-code') || `// Welcome to Wang Playground!
// Wang is a modern workflow language with pipeline operators

let message = "Hello, Wang!"
log(message)

// Pipeline example
let numbers = [1, 2, 3, 4, 5]
let result = numbers 
    |> filter(_, x => x > 2)
    |> map(_, x => x * 2)
log("Result:", result)

// Try pressing Ctrl+Enter to run!`,
                language: 'wang',
                theme: theme === 'dark' ? 'wang-dark' : 'wang-light',
                fontSize: 14,
                minimap: { enabled: false },
                automaticLayout: true,
                lineNumbers: 'on',
                scrollBeyondLastLine: false,
                wordWrap: 'off',
                tabSize: 2,
                insertSpaces: true,
                folding: true,
                bracketPairColorization: { enabled: true }
            });
            
            // Breakpoint handling
            editor.onMouseDown((e) => {
                if (e.target.type === monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN) {
                    const lineNumber = e.target.position.lineNumber;
                    toggleBreakpoint(lineNumber);
                }
            });
            
            function toggleBreakpoint(lineNumber) {
                const model = editor.getModel();
                const decorations = [];
                
                if (breakpoints.has(lineNumber)) {
                    breakpoints.delete(lineNumber);
                } else {
                    breakpoints.add(lineNumber);
                    decorations.push({
                        range: new monaco.Range(lineNumber, 1, lineNumber, 1),
                        options: {
                            isWholeLine: true,
                            glyphMarginClassName: 'fa fa-circle text-red-500',
                            glyphMarginHoverMessage: { value: 'Breakpoint' }
                        }
                    });
                }
                
                // Update decorations
                updateBreakpointDecorations();
            }
            
            function updateBreakpointDecorations() {
                const decorations = [];
                breakpoints.forEach(lineNumber => {
                    decorations.push({
                        range: new monaco.Range(lineNumber, 1, lineNumber, 1),
                        options: {
                            isWholeLine: true,
                            glyphMarginClassName: 'fa fa-circle text-red-500',
                            glyphMarginHoverMessage: { value: 'Breakpoint' }
                        }
                    });
                });
                editor.deltaDecorations([], decorations);
            }
            
            // Helper functions (define early for error messages)
            function addOutput(type, message) {
                const container = document.getElementById('output-container');
                const entry = document.createElement('div');
                entry.className = `mb-2 p-2 rounded ${
                    type === 'error' ? 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300' :
                    type === 'warning' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300' :
                    type === 'success' ? 'bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300' :
                    'bg-gray-100 dark:bg-gray-800'
                }`;
                
                const timestamp = new Date().toLocaleTimeString();
                entry.innerHTML = `
                    <div class="text-xs opacity-75 mb-1">${timestamp}</div>
                    <div class="whitespace-pre-wrap break-words">${message}</div>
                `;
                container.appendChild(entry);
                container.scrollTop = container.scrollHeight;
                
                // Add to history
                outputHistory.push({ type, message, timestamp });
                if (outputHistory.length > 100) outputHistory.shift(); // Keep last 100 entries
            }
            
            // Initialize Wang interpreter
            const { WangInterpreter, InMemoryModuleResolver, WangValidator } = Wang;
            
            if (!WangInterpreter || !InMemoryModuleResolver || !WangValidator) {
                console.error('Wang components not found:', Wang);
                console.error('Available exports:', Object.keys(Wang));
                addOutput('error', 'Failed to initialize Wang components. Please refresh the page.');
                return;
            }
            const resolver = new InMemoryModuleResolver();
            
            const interpreter = new WangInterpreter({
                moduleResolver: resolver,
                functions: {
                    log: (...args) => {
                        addOutput('log', args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '));
                    },
                    error: (...args) => {
                        addOutput('error', args.join(' '));
                    },
                    warn: (...args) => {
                        addOutput('warning', args.join(' '));
                    },
                    clear: () => {
                        clearOutput();
                    },
                    now: () => Date.now(),
                    filter: (arr, fn) => arr.filter(fn),
                    map: (arr, fn) => arr.map(fn),
                    reduce: (arr, fn, init) => arr.reduce(fn, init)
                }
            });
            
            // Set built-in objects
            interpreter.setVariable('Math', Math);
            interpreter.setVariable('JSON', JSON);
            interpreter.setVariable('Date', Date);
            interpreter.setVariable('console', {
                log: (...args) => addOutput('log', args.join(' ')),
                error: (...args) => addOutput('error', args.join(' ')),
                warn: (...args) => addOutput('warning', args.join(' '))
            });
            
            const validator = new WangValidator();
            
            function clearOutput() {
                document.getElementById('output-container').innerHTML = '';
                currentHistoryIndex = outputHistory.length - 1;
            }
            
            // Export output functionality
            function exportOutput() {
                const content = outputHistory.map(h => `[${h.timestamp}] ${h.type.toUpperCase()}: ${h.message}`).join('\n');
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `wang-output-${Date.now()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            // Import/Export code functionality
            function exportCode() {
                const code = editor.getValue();
                const blob = new Blob([code], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'wang-code.wang';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            function importCode() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.wang,.txt,.js';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const text = await file.text();
                        editor.setValue(text);
                        addOutput('success', `Imported ${file.name}`);
                    }
                };
                input.click();
            }
            
            function updateStatus(state, text) {
                const indicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');
                const loadingOverlay = document.getElementById('loading-overlay');
                
                indicator.className = `w-2 h-2 rounded-full ${
                    state === 'running' ? 'bg-yellow-500 animate-pulse' :
                    state === 'success' ? 'bg-emerald-500' :
                    state === 'error' ? 'bg-red-500' :
                    'bg-gray-400'
                }`;
                statusText.textContent = text;
                
                // Show/hide loading overlay on mobile
                if (window.innerWidth < 640) {
                    if (state === 'running') {
                        loadingOverlay.classList.remove('hidden');
                        loadingOverlay.classList.add('flex');
                    } else {
                        loadingOverlay.classList.add('hidden');
                        loadingOverlay.classList.remove('flex');
                    }
                }
            }
            
            // Run code with caching
            async function runCode() {
                const code = editor.getValue();
                const cacheKey = btoa(code);
                
                if (document.getElementById('clear-on-run').classList.contains('bg-emerald-500')) {
                    clearOutput();
                }
                
                const startTime = performance.now();
                updateStatus('running', 'Running...');
                document.getElementById('exec-time').classList.remove('hidden');
                
                // Check cache for previously compiled code
                let cached = compilationCache.get(cacheKey);
                
                try {
                    const result = await interpreter.execute(code);
                    
                    const executionTime = Math.round(performance.now() - startTime);
                    document.getElementById('exec-time-value').textContent = `${executionTime}ms`;
                    
                    // Update memory usage
                    if (performance.memory) {
                        const mb = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                        document.getElementById('memory-usage').textContent = `Memory: ${mb}MB`;
                    }
                    
                    if (result !== undefined && result !== null) {
                        addOutput('success', `Result: ${typeof result === 'object' ? JSON.stringify(result, null, 2) : result}`);
                    }
                    
                    // Cache successful compilation
                    compilationCache.set(cacheKey, { code, timestamp: Date.now() });
                    
                    // Clean old cache entries (keep last 50)
                    if (compilationCache.size > 50) {
                        const firstKey = compilationCache.keys().next().value;
                        compilationCache.delete(firstKey);
                    }
                    
                    updateStatus('success', 'Success');
                } catch (error) {
                    addOutput('error', error.message || error.toString());
                    updateStatus('error', 'Error');
                }
            }
            
            // Validate code
            function validateCode() {
                const code = editor.getValue();
                const result = validator.validate(code, { includeAST: true });
                
                if (result.valid) {
                    addOutput('success', '✅ Valid Wang code');
                    if (result.ast) {
                        addOutput('log', 'AST: ' + JSON.stringify(result.ast, null, 2));
                    }
                } else {
                    addOutput('error', `❌ ${result.error.message}`);
                    if (result.error.suggestion) {
                        addOutput('warning', `💡 ${result.error.suggestion}`);
                    }
                }
            }
            
            // Expanded examples
            const examples = {
                variables: `// Variables and Types in Wang
let mutable = "can be changed"
const immutable = "cannot be changed"
var hoisted = "old style variable"

// Data types
let string = "Hello"
let number = 42
let float = 3.14
let boolean = true
let array = [1, 2, 3]
let object = { name: "Wang", version: "0.14" }

log("String:", string)
log("Number:", number)
log("Array:", array)
log("Object:", object)`,

                modules: `// Module system in Wang
// Note: In playground, modules are simulated

// Export syntax
export function greet(name) {
    return \`Hello, \${name}!\`
}

export const PI = 3.14159

export class Calculator {
    add(a, b) { return a + b }
    subtract(a, b) { return a - b }
}

// Import syntax (simulated)
// import { greet, PI } from "./module"

log(greet("Wang"))
log("PI =", PI)`,

                chaining: `// Method Chaining and Optional Chaining
let data = {
    users: [
        { name: "Alice", profile: { age: 30, city: "NYC" } },
        { name: "Bob" },
        { name: "Charlie", profile: { age: 25 } }
    ]
}

// Optional chaining with ?.
let firstAge = data.users?.[0]?.profile?.age
log("First user age:", firstAge)

// Nullish coalescing with ??
let secondAge = data.users?.[1]?.profile?.age ?? "Unknown"
log("Second user age:", secondAge)

// Method chaining
let result = [1, 2, 3, 4, 5]
    |> filter(_, x => x > 2)
    |> map(_, x => x * 2)
log("Chained result:", result)`,

                destructuring: `// Destructuring in Wang

// Array destructuring
let [first, second, ...rest] = [1, 2, 3, 4, 5]
log("First:", first)
log("Second:", second)
log("Rest:", rest)

// Object destructuring
let user = {
    name: "Alice",
    age: 30,
    city: "NYC",
    skills: ["JS", "Wang", "Python"]
}

let { name, age, city } = user
log(\`\${name} is \${age} years old from \${city}\`)

// Nested destructuring
let { skills: [primary, ...others] } = user
log("Primary skill:", primary)
log("Other skills:", others)`,

                errorhandling: `// Error Handling in Wang

function riskyOperation(value) {
    if (value < 0) {
        throw new Error("Value cannot be negative")
    }
    return value * 2
}

// Try-catch-finally
try {
    log("Trying safe operation...")
    let result = riskyOperation(5)
    log("Success:", result)
    
    log("\nTrying risky operation...")
    result = riskyOperation(-1)
    log("This won't execute")
} catch (error) {
    log("Caught error:", error.message)
} finally {
    log("Cleanup: This always runs")
}

// Async error handling
async function fetchData() {
    try {
        await new Promise((resolve, reject) => {
            setTimeout(() => reject(new Error("Network error")), 1000)
        })
    } catch (error) {
        log("Async error:", error.message)
        return { fallback: true }
    }
}

await fetchData()`,

                
                hello: `// Hello World in Wang
let greeting = "Hello, Wang Language!"
log(greeting)

// String interpolation
let name = "Developer"
let message = \`Welcome, \${name}!\`
log(message)`,
                
                pipeline: `// Pipeline operators in Wang
let data = [1, 2, 3, 4, 5]

// Using the pipe operator |>
let doubled = data |> map(_, x => x * 2)
log("Doubled:", doubled)

// Chain operations
let result = data 
    |> filter(_, x => x > 2)
    |> map(_, x => x * 3)
log("Result:", result)`,
                
                async: `// Async/Await in Wang
async function fetchData() {
    log("Starting async operation...")
    await new Promise(resolve => setTimeout(resolve, 1000))
    return { status: "success", data: [1, 2, 3] }
}

let result = await fetchData()
log("Result:", result)`,
                
                class: `// Classes in Wang
class Animal {
    constructor(name) {
        this.name = name
    }
    
    speak() {
        log(\`\${this.name} makes a sound\`)
    }
}

class Dog extends Animal {
    constructor(name, breed) {
        super(name)
        this.breed = breed
    }
    
    speak() {
        log(\`\${this.name} the \${this.breed} barks!\`)
    }
}

let pet = new Dog("Max", "Golden Retriever")
pet.speak()`
            };
            
            // Event listeners
            document.getElementById('run-btn').addEventListener('click', runCode);
            document.getElementById('fab-run')?.addEventListener('click', runCode);
            document.getElementById('validate-btn').addEventListener('click', validateCode);
            document.getElementById('clear-output').addEventListener('click', clearOutput);
            document.getElementById('export-output').addEventListener('click', exportOutput);
            document.getElementById('import-btn').addEventListener('click', importCode);
            document.getElementById('export-btn').addEventListener('click', exportCode);
            
            // Examples
            document.getElementById('examples-btn').addEventListener('click', () => {
                document.getElementById('examples-menu').classList.toggle('hidden');
            });
            
            document.querySelectorAll('[data-example]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const example = examples[btn.dataset.example];
                    if (example) {
                        editor.setValue(example);
                        document.getElementById('examples-menu').classList.add('hidden');
                    }
                });
            });
            
            // Theme toggle
            document.getElementById('theme-btn').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                monaco.editor.setTheme(isDark ? 'wang-dark' : 'wang-light');
            });
            
            // Settings
            document.getElementById('settings-btn').addEventListener('click', () => {
                document.getElementById('settings-modal').classList.remove('hidden');
                document.getElementById('settings-modal').classList.add('flex');
            });
            
            document.getElementById('close-settings').addEventListener('click', () => {
                document.getElementById('settings-modal').classList.add('hidden');
                document.getElementById('settings-modal').classList.remove('flex');
            });
            
            // Shortcuts modal
            document.getElementById('shortcuts-btn').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.remove('hidden');
                document.getElementById('shortcuts-modal').classList.add('flex');
            });
            
            document.getElementById('close-shortcuts').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.add('hidden');
                document.getElementById('shortcuts-modal').classList.remove('flex');
            });
            
            // Tab switching for output panel
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    
                    // Update tab styles
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('text-emerald-500', 'border-b-2', 'border-emerald-500');
                        b.classList.add('text-gray-500');
                    });
                    btn.classList.add('text-emerald-500', 'border-b-2', 'border-emerald-500');
                    btn.classList.remove('text-gray-500');
                    
                    // Show/hide containers
                    document.getElementById('output-container').classList.toggle('hidden', tab !== 'output');
                    document.getElementById('debug-container').classList.toggle('hidden', tab !== 'debug');
                    
                    // Handle AST and Console tabs
                    if (tab === 'ast') {
                        document.getElementById('output-container').classList.remove('hidden');
                        addOutput('log', 'AST view: Run validation to see the Abstract Syntax Tree');
                    } else if (tab === 'console') {
                        document.getElementById('output-container').classList.remove('hidden');
                        addOutput('log', 'Console: All log outputs will appear here');
                    }
                });
            });
            
            // Debug functionality
            document.getElementById('debug-run')?.addEventListener('click', () => {
                debuggerState.enabled = true;
                addOutput('log', '🐛 Debugger started. Set breakpoints by clicking in the gutter.');
                runCode();
            });
            
            // Update breakpoints display
            function updateBreakpointsDisplay() {
                const container = document.getElementById('debug-breakpoints');
                if (breakpoints.size === 0) {
                    container.innerHTML = '<div class="text-gray-500 dark:text-gray-400">Click in the gutter to add breakpoints</div>';
                } else {
                    container.innerHTML = Array.from(breakpoints).map(line => 
                        `<div class="flex items-center justify-between py-1">
                            <span>Line ${line}</span>
                            <button onclick="breakpoints.delete(${line}); updateBreakpointDecorations(); updateBreakpointsDisplay();" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>`
                    ).join('');
                }
            }
            
            // Toggle switches
            document.querySelectorAll('#word-wrap, #auto-save, #clear-on-run').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const isOn = toggle.classList.contains('bg-emerald-500');
                    if (isOn) {
                        toggle.classList.remove('bg-emerald-500');
                        toggle.classList.add('bg-gray-300', 'dark:bg-gray-600');
                        toggle.querySelector('span').style.transform = 'translateX(0.25rem)';
                    } else {
                        toggle.classList.add('bg-emerald-500');
                        toggle.classList.remove('bg-gray-300', 'dark:bg-gray-600');
                        toggle.querySelector('span').style.transform = 'translateX(1.5rem)';
                    }
                    
                    if (toggle.id === 'word-wrap') {
                        editor.updateOptions({ wordWrap: !isOn ? 'on' : 'off' });
                    }
                });
            });
            
            // Share functionality
            document.getElementById('share-btn').addEventListener('click', () => {
                const code = editor.getValue();
                const encoded = btoa(encodeURIComponent(code));
                const url = `${window.location.origin}${window.location.pathname}#code=${encoded}`;
                
                navigator.clipboard.writeText(url).then(() => {
                    addOutput('success', 'Share URL copied to clipboard!');
                });
            });
            
            // Panel resizing
            const resizer = document.getElementById('resizer');
            const editorPanel = document.getElementById('editor-panel');
            const outputPanel = document.getElementById('output-panel');
            let isResizing = false;
            
            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                const container = editorPanel.parentElement;
                const containerWidth = container.offsetWidth;
                const pointerRelativeXpos = e.clientX - container.offsetLeft;
                const editorWidth = Math.max(200, Math.min(containerWidth - 200, pointerRelativeXpos));
                
                editorPanel.style.flex = `0 0 ${editorWidth}px`;
                outputPanel.style.flex = '1';
            });
            
            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.cursor = '';
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    runCode();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    localStorage.setItem('wang-code', editor.getValue());
                    addOutput('success', 'Code saved to localStorage');
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === ',') {
                    e.preventDefault();
                    document.getElementById('settings-btn').click();
                }
                
                if (e.key === 'Escape') {
                    document.getElementById('settings-modal').classList.add('hidden');
                    document.getElementById('shortcuts-modal').classList.add('hidden');
                    document.getElementById('examples-menu').classList.add('hidden');
                }
            });
            
            // Auto-save and real-time validation
            let validationTimeout = null;
            editor.onDidChangeModelContent(() => {
                document.getElementById('modified-indicator').classList.remove('hidden');
                if (document.getElementById('auto-save').classList.contains('bg-emerald-500')) {
                    localStorage.setItem('wang-code', editor.getValue());
                    setTimeout(() => {
                        document.getElementById('modified-indicator').classList.add('hidden');
                    }, 1000);
                }
                
                // Debounced validation for real-time error checking
                clearTimeout(validationTimeout);
                validationTimeout = setTimeout(() => {
                    const code = editor.getValue();
                    const result = validator.validate(code);
                    
                    // Clear previous error decorations
                    monaco.editor.setModelMarkers(editor.getModel(), 'wang', []);
                    
                    if (!result.valid && result.error) {
                        // Add error decoration
                        const line = result.error.line || 1;
                        const column = result.error.column || 1;
                        monaco.editor.setModelMarkers(editor.getModel(), 'wang', [{
                            startLineNumber: line,
                            startColumn: column,
                            endLineNumber: line,
                            endColumn: column + 1,
                            message: result.error.message,
                            severity: monaco.MarkerSeverity.Error
                        }]);
                    }
                }, 500); // Validate after 500ms of no typing
            });
            
            // Update cursor position
            editor.onDidChangeCursorPosition((e) => {
                document.getElementById('cursor-position').textContent = `Ln ${e.position.lineNumber}, Col ${e.position.column}`;
            });
            
            // Update selection info
            editor.onDidChangeCursorSelection((e) => {
                const selection = e.selection;
                const model = editor.getModel();
                const selectedText = model.getValueInRange(selection);
                
                if (selectedText.length > 0) {
                    document.getElementById('selection-info').textContent = `${selectedText.length} chars selected`;
                } else {
                    document.getElementById('selection-info').textContent = '';
                }
            });
            
            // Load shared code
            if (window.location.hash.startsWith('#code=')) {
                try {
                    const encoded = window.location.hash.slice(6);
                    const code = decodeURIComponent(atob(encoded));
                    editor.setValue(code);
                } catch (e) {
                    console.error('Failed to load shared code:', e);
                }
            }
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#examples-btn') && !e.target.closest('#examples-menu')) {
                    document.getElementById('examples-menu').classList.add('hidden');
                }
            });
            
            // Mobile responsive handling
            function setupMobileUI() {
                const isMobile = window.innerWidth < 768;
                const mobileTabsContainer = document.querySelector('.mobile-tabs');
                const sidebar = document.getElementById('sidebar');
                
                if (isMobile) {
                    // Show mobile tabs
                    if (mobileTabsContainer) {
                        mobileTabsContainer.classList.remove('hidden');
                    }
                    
                    // Hide sidebar on mobile
                    if (sidebar) {
                        sidebar.classList.add('hidden');
                    }
                    
                    // Setup mobile tab switching
                    document.querySelectorAll('.mobile-tab-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const panel = btn.dataset.panel;
                            
                            // Update button styles
                            document.querySelectorAll('.mobile-tab-btn').forEach(b => {
                                b.classList.remove('bg-emerald-500', 'text-white');
                                b.classList.add('bg-gray-200', 'dark:bg-gray-700');
                            });
                            btn.classList.add('bg-emerald-500', 'text-white');
                            btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                            
                            // Show/hide panels
                            if (panel === 'editor') {
                                document.getElementById('editor-panel').classList.remove('mobile-tab-inactive');
                                document.getElementById('editor-panel').classList.add('mobile-tab-active');
                                document.getElementById('output-panel').classList.add('mobile-tab-inactive');
                                document.getElementById('output-panel').classList.remove('mobile-tab-active');
                            } else {
                                document.getElementById('output-panel').classList.remove('mobile-tab-inactive');
                                document.getElementById('output-panel').classList.add('mobile-tab-active');
                                document.getElementById('editor-panel').classList.add('mobile-tab-inactive');
                                document.getElementById('editor-panel').classList.remove('mobile-tab-active');
                            }
                        });
                    });
                    
                    // Disable panel resizing on mobile
                    document.getElementById('resizer').style.display = 'none';
                } else {
                    // Desktop mode
                    if (mobileTabsContainer) {
                        mobileTabsContainer.classList.add('hidden');
                    }
                    if (sidebar) {
                        sidebar.classList.remove('hidden');
                    }
                    
                    // Reset panel visibility
                    document.getElementById('editor-panel').classList.remove('mobile-tab-inactive', 'mobile-tab-active');
                    document.getElementById('output-panel').classList.remove('mobile-tab-inactive', 'mobile-tab-active');
                    document.getElementById('resizer').style.display = '';
                }
            }
            
            // Setup on load and resize
            setupMobileUI();
            window.addEventListener('resize', setupMobileUI);
            
            // Touch gesture support for swipe between panels on mobile
            let touchStartX = 0;
            let touchEndX = 0;
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchEndX - touchStartX;
                
                if (Math.abs(diff) > swipeThreshold && window.innerWidth < 768) {
                    const editorActive = !document.getElementById('editor-panel').classList.contains('mobile-tab-inactive');
                    
                    if (diff > 0 && !editorActive) {
                        // Swipe right - show editor
                        document.querySelector('.mobile-tab-btn[data-panel="editor"]').click();
                    } else if (diff < 0 && editorActive) {
                        // Swipe left - show output
                        document.querySelector('.mobile-tab-btn[data-panel="output"]').click();
                    }
                }
            }
            
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }
        
        // Start initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>