<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wang Language - Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .tagline {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .nav-links {
            margin-top: 15px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            margin: 0 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            display: inline-block;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.3);
        }

        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .playground {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .panel-header {
            background: #4a5568;
            color: white;
            padding: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-container, .output-container {
            height: 400px;
            position: relative;
        }

        #editor, #output {
            width: 100%;
            height: 100%;
            border: none;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
        }

        #editor {
            background: #1e1e1e;
            color: #d4d4d4;
        }

        #output {
            background: #f7fafc;
            color: #2d3748;
        }

        .controls {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary {
            background: #ed8936;
            color: white;
        }

        .btn-info {
            background: #4299e1;
            color: white;
        }

        select {
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .status {
            margin-left: auto;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
        }

        .status.loading {
            background: #bee3f8;
            color: #2c5282;
        }

        .examples {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .examples h2 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .example-btn {
            padding: 10px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
        }

        .example-btn:hover {
            background: #e2e8f0;
        }

        .example-btn strong {
            display: block;
            margin-bottom: 5px;
            color: #2d3748;
        }

        .example-btn small {
            color: #718096;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
            opacity: 0.9;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Wang Language</h1>
            <p class="tagline">CSP-Safe Workflow Programming for Browser Automation</p>
            <div class="nav-links">
                <a href="/">üìö Documentation</a>
                <a href="https://github.com/artpar/wang">üêô GitHub</a>
                <a href="https://www.npmjs.com/package/wang-lang">üì¶ NPM</a>
            </div>
        </header>

        <div class="playground">
            <div class="panel">
                <div class="panel-header">
                    <span>‚úèÔ∏è Code Editor</span>
                    <select id="examples">
                        <option value="">Load Example...</option>
                        <option value="hello">Hello World</option>
                        <option value="variables">Variables & Scoping</option>
                        <option value="functions">Functions & Arrows</option>
                        <option value="pipelines">Pipeline Operators</option>
                        <option value="classes">Classes & OOP</option>
                        <option value="async">Async/Await</option>
                        <option value="destructuring">Destructuring</option>
                        <option value="optional">Optional Chaining</option>
                        <option value="modules">Modules</option>
                    </select>
                </div>
                <div class="editor-container">
                    <textarea id="editor">// Welcome to Wang Language Playground!
// Wang is a CSP-safe language with JavaScript-like syntax

let message = "Hello, Wang!"
log(message)

// Try pipeline operators
[1, 2, 3, 4, 5]
  |> filter(_, n => n > 2)
  |> map(_, n => n * 2)
  |> reduce(_, (a, b) => a + b, 0)</textarea>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span>üìã Output</span>
                    <button class="btn-info" onclick="clearOutput()" style="padding: 5px 10px; font-size: 14px;">Clear</button>
                </div>
                <div class="output-container">
                    <textarea id="output" readonly placeholder="Output will appear here..."></textarea>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="runCode()">‚ñ∂Ô∏è Run Code</button>
            <button class="btn-secondary" onclick="validateCode()">‚úÖ Validate Only</button>
            <button class="btn-info" onclick="showAST()">üå≥ Show AST</button>
            <span id="status" class="status" style="display: none;"></span>
        </div>

        <div class="examples">
            <h2>Quick Examples</h2>
            <div class="example-grid">
                <button class="example-btn" onclick="loadExample('variables')">
                    <strong>Variables</strong>
                    <small>let, const, var, scoping</small>
                </button>
                <button class="example-btn" onclick="loadExample('functions')">
                    <strong>Functions</strong>
                    <small>Regular & arrow functions</small>
                </button>
                <button class="example-btn" onclick="loadExample('pipelines')">
                    <strong>Pipelines</strong>
                    <small>|> and -> operators</small>
                </button>
                <button class="example-btn" onclick="loadExample('classes')">
                    <strong>Classes</strong>
                    <small>OOP with inheritance</small>
                </button>
                <button class="example-btn" onclick="loadExample('async')">
                    <strong>Async/Await</strong>
                    <small>Asynchronous code</small>
                </button>
                <button class="example-btn" onclick="loadExample('optional')">
                    <strong>Optional Chaining</strong>
                    <small>Safe property access</small>
                </button>
            </div>
        </div>

        <footer>
            <p>Made with ‚ù§Ô∏è by the Wang Language team</p>
            <p><a href="https://github.com/artpar/wang">GitHub</a> | <a href="https://www.npmjs.com/package/wang-lang">NPM</a> | <a href="/">Documentation</a></p>
        </footer>
    </div>

    <script src="./wang.min.js"></script>
    <script>

        // Example code snippets
        const examples = {
            hello: `// Hello World in Wang
let greeting = "Hello, World!"
log(greeting)

// String interpolation with template literals
let name = "Wang"
let message = \`Welcome to \${name} Language!\`
log(message)`,

            variables: `// Variable declarations
let mutable = 10
const immutable = 20
var hoisted = 30

// Block scoping
{
  let inner = 40
  log("Inner scope:", inner)
}

// Compound assignments
let x = 5
x += 10  // 15
x -= 3   // 12
x *= 2   // 24
x /= 4   // 6
log("Final x:", x)

// Increment/Decrement
let counter = 0
counter++
++counter
log("Counter:", counter)`,

            functions: `// Regular function
function add(a, b) {
  return a + b
}

// Arrow function
let multiply = (a, b) => a * b

// Higher-order function
function operate(x, y, operation) {
  return operation(x, y)
}

log("Add:", add(5, 3))
log("Multiply:", multiply(4, 6))
log("Operate:", operate(10, 5, (a, b) => a - b))

// Closures
function makeCounter() {
  let count = 0
  return () => {
    count++
    return count
  }
}

let counter = makeCounter()
log("Count:", counter())
log("Count:", counter())`,

            pipelines: `// Pipeline operators
let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

// Pipe operator |>
let result = numbers
  |> filter(_, n => n % 2 === 0)
  |> map(_, n => n * n)
  |> reduce(_, (sum, n) => sum + n, 0)

log("Sum of squares of even numbers:", result)

// Arrow operator ->
let data = { values: [1, 2, 3] }
data.values
  |> map(_, x => x * 10)
  -> forEach(_, x => log("Value:", x))

// Method chaining with pipelines
class DataProcessor {
  constructor(data) {
    this.data = data
  }
  
  filter(predicate) {
    this.data = filter(this.data, predicate)
    return this
  }
  
  transform(fn) {
    this.data = map(this.data, fn)
    return this
  }
  
  get() {
    return this.data
  }
}

new DataProcessor([1, 2, 3, 4, 5])
  |> _.filter(n => n > 2)
  |> _.transform(n => n * 3)
  |> _.get()
  -> log("Processed:")`,

            classes: `// Class definition
class Animal {
  constructor(name) {
    this.name = name
  }
  
  speak() {
    return \`\${this.name} makes a sound\`
  }
}

// Inheritance
class Dog extends Animal {
  constructor(name, breed) {
    super(name)
    this.breed = breed
  }
  
  speak() {
    return \`\${this.name} barks\`
  }
  
  getInfo() {
    return \`\${this.name} is a \${this.breed}\`
  }
}

let dog = new Dog("Max", "Golden Retriever")
log(dog.speak())
log(dog.getInfo())

// Method chaining
class StringBuilder {
  constructor() {
    this.str = ""
  }
  
  append(text) {
    this.str = this.str + text
    return this
  }
  
  toString() {
    return this.str
  }
}

let message = new StringBuilder()
  .append("Hello")
  .append(" ")
  .append("World!")
  .toString()

log("Built string:", message)`,

            async: `// Async functions
async function fetchData(id) {
  log(\`Fetching data for id: \${id}\`)
  await delay(100)
  return { id: id, name: \`Item \${id}\` }
}

// Async with error handling
async function safeOperation() {
  try {
    let result = await fetchData(1)
    log("Success:", result.name)
    return result
  } catch (error) {
    log("Error:", error)
    return null
  }
}

// Run async code
await safeOperation()

// Promise handling
Promise.resolve(42)
  .then(x => x * 2)
  .then(x => log("Promise result:", x))

// Parallel async operations
let ids = [1, 2, 3]
let promises = map(ids, id => fetchData(id))
let results = await Promise.all(promises)
log("All results:", results)`,

            destructuring: `// Array destructuring
let [first, second, ...rest] = [1, 2, 3, 4, 5]
log("First:", first)
log("Second:", second)
log("Rest:", rest)

// Object destructuring
let person = {
  name: "Alice",
  age: 30,
  city: "Boston"
}

let { name, age } = person
log(\`\${name} is \${age} years old\`)

// Nested destructuring
let data = {
  user: {
    profile: {
      firstName: "Bob",
      lastName: "Smith"
    }
  }
}

let { user: { profile: { firstName } } } = data
log("First name:", firstName)

// Destructuring in parameters
function greet({ name, greeting = "Hello" }) {
  return \`\${greeting}, \${name}!\`
}

log(greet({ name: "Charlie" }))
log(greet({ name: "Dana", greeting: "Hi" }))

// Rest in objects
let { x, y, ...coords } = { x: 1, y: 2, z: 3, w: 4 }
log("Remaining coordinates:", coords)`,

            optional: `// Optional chaining with objects
let user = {
  profile: {
    name: "Alice",
    address: {
      city: "Boston"
    }
  }
}

log("City:", user?.profile?.address?.city)
log("Missing:", user?.profile?.phone?.number)

// Optional chaining with arrays
let data = {
  items: [
    { title: "First" },
    { title: "Second" },
    null,
    { title: "Fourth" }
  ]
}

log("Item 0:", data.items?.[0]?.title)
log("Item 2:", data.items?.[2]?.title)
log("Item 10:", data.items?.[10]?.title)

// Dynamic index with optional chaining
let index = 1
log("Dynamic access:", data.items?.[index]?.title)

// Nullish coalescing
let value = null
let defaultValue = value ?? "default"
log("With null:", defaultValue)

let zero = 0
let zeroDefault = zero ?? "default"
log("With zero:", zeroDefault)

// Combined with optional chaining
let settings = {}
let theme = settings?.appearance?.theme ?? "light"
log("Theme:", theme)`,

            modules: `// This example shows module syntax
// (Note: In playground, modules are simulated)

// Import named exports
// import { helper, utils } from "./helpers"

// Export function
export function processData(data) {
  return map(data, x => x * 2)
}

// Export class
export class DataManager {
  constructor() {
    this.data = []
  }
  
  add(item) {
    push(this.data, item)
  }
  
  getAll() {
    return this.data
  }
}

// Using the exports
let manager = new DataManager()
manager.add("item1")
manager.add("item2")
log("Manager data:", manager.getAll())

let numbers = [1, 2, 3]
log("Processed:", processData(numbers))`
        };

        // Access Wang from the global UMD bundle
        const { WangInterpreter, InMemoryModuleResolver, WangValidator } = Wang;
        
        // Create globals for easy access
        window.interpreter = null;
        window.validator = new WangValidator();

        // Standard library functions
        const stdlib = {
            // I/O
            log: (...args) => {
                const output = document.getElementById('output');
                output.value += args.map(a => 
                    typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)
                ).join(' ') + '\n';
            },
            
            // Array methods
            filter: (arr, predicate) => arr.filter(predicate),
            map: (arr, fn) => arr.map(fn),
            reduce: (arr, fn, initial) => arr.reduce(fn, initial),
            forEach: (arr, fn) => arr.forEach(fn),
            find: (arr, predicate) => arr.find(predicate),
            some: (arr, predicate) => arr.some(predicate),
            every: (arr, predicate) => arr.every(predicate),
            push: (arr, ...items) => { arr.push(...items); return arr; },
            pop: (arr) => arr.pop(),
            shift: (arr) => arr.shift(),
            unshift: (arr, ...items) => { arr.unshift(...items); return arr; },
            slice: (arr, start, end) => arr.slice(start, end),
            sort: (arr, compareFn) => [...arr].sort(compareFn),
            reverse: (arr) => [...arr].reverse(),
            
            // Async utilities
            delay: (ms) => new Promise(resolve => setTimeout(resolve, ms)),
            Promise: Promise,
            
            // Type conversion
            String: String,
            Number: Number,
            Boolean: Boolean,
            Array: Array,
            Object: Object,
            
            // Math
            Math: Math,
            parseInt: parseInt,
            parseFloat: parseFloat,
            isNaN: isNaN,
            isFinite: isFinite,
            
            // JSON
            JSON: JSON
        };

        window.runCode = async function() {
            const code = document.getElementById('editor').value;
            const output = document.getElementById('output');
            const status = document.getElementById('status');
            
            output.value = '';
            status.style.display = 'block';
            status.className = 'status loading';
            status.textContent = 'Running...';
            
            try {
                const resolver = new InMemoryModuleResolver();
                window.interpreter = new WangInterpreter({
                    moduleResolver: resolver,
                    functions: stdlib
                });
                
                const result = await interpreter.execute(code);
                
                if (result !== undefined) {
                    output.value += '‚Üí ' + (typeof result === 'object' ? 
                        JSON.stringify(result, null, 2) : String(result)) + '\n';
                }
                
                status.className = 'status success';
                status.textContent = '‚úÖ Executed successfully';
                setTimeout(() => status.style.display = 'none', 3000);
                
            } catch (error) {
                output.value = '‚ùå Error: ' + error.message + '\n';
                if (error.stack) {
                    output.value += '\nStack trace:\n' + error.stack;
                }
                
                status.className = 'status error';
                status.textContent = '‚ùå Execution failed';
                setTimeout(() => status.style.display = 'none', 5000);
            }
        };

        window.validateCode = function() {
            const code = document.getElementById('editor').value;
            const output = document.getElementById('output');
            const status = document.getElementById('status');
            
            output.value = '';
            status.style.display = 'block';
            
            const result = validator.validate(code);
            
            if (result.valid) {
                output.value = '‚úÖ Code is valid!\n\n';
                output.value += 'Statistics:\n';
                output.value += `- Lines: ${code.split('\n').length}\n`;
                output.value += `- Characters: ${code.length}\n`;
                
                status.className = 'status success';
                status.textContent = '‚úÖ Valid Wang code';
                
            } else {
                output.value = '‚ùå Validation errors:\n\n';
                result.errors.forEach(error => {
                    output.value += `Line ${error.line}, Column ${error.column}: ${error.message}\n`;
                });
                
                if (result.suggestions && result.suggestions.length > 0) {
                    output.value += '\nüí° Suggestions:\n';
                    result.suggestions.forEach(suggestion => {
                        output.value += `- ${suggestion}\n`;
                    });
                }
                
                status.className = 'status error';
                status.textContent = '‚ùå Invalid code';
            }
            
            setTimeout(() => status.style.display = 'none', 5000);
        };

        window.showAST = function() {
            const code = document.getElementById('editor').value;
            const output = document.getElementById('output');
            const status = document.getElementById('status');
            
            output.value = '';
            status.style.display = 'block';
            
            const result = validator.validate(code);
            
            if (result.valid) {
                output.value = 'üå≥ Abstract Syntax Tree:\n\n';
                output.value += JSON.stringify(result.ast, null, 2);
                
                status.className = 'status success';
                status.textContent = '‚úÖ AST generated';
                
            } else {
                output.value = '‚ùå Cannot generate AST - code has errors:\n\n';
                result.errors.forEach(error => {
                    output.value += `Line ${error.line}, Column ${error.column}: ${error.message}\n`;
                });
                
                status.className = 'status error';
                status.textContent = '‚ùå Parse error';
            }
            
            setTimeout(() => status.style.display = 'none', 5000);
        };

        window.clearOutput = function() {
            document.getElementById('output').value = '';
        };

        window.loadExample = function(name) {
            const code = examples[name];
            if (code) {
                document.getElementById('editor').value = code;
                document.getElementById('examples').value = name;
            }
        };

        // Handle example dropdown
        document.getElementById('examples').addEventListener('change', function(e) {
            if (e.target.value) {
                loadExample(e.target.value);
            }
        });

        // Run code on Ctrl+Enter
        document.getElementById('editor').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
        });
    </script>
</body>
</html>