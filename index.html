<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wang Playground - Professional IDE</title>
    <meta name="description" content="Interactive Wang language playground with professional IDE features">
    
    <!-- Monaco Editor CDN -->
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.css">
    
    <!-- Font for UI and code -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Color scheme - Dark theme by default */
            --bg-primary: #0d0e11;
            --bg-secondary: #16181d;
            --bg-tertiary: #1e2127;
            --bg-hover: #252930;
            --bg-active: #2d333b;
            
            --border-primary: #30363d;
            --border-secondary: #21262d;
            
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-tertiary: #6e7681;
            --text-link: #58a6ff;
            
            --accent-primary: #3fb950;
            --accent-secondary: #1f6feb;
            --accent-danger: #f85149;
            --accent-warning: #d29922;
            
            /* Layout dimensions */
            --header-height: 40px;
            --status-height: 24px;
            --sidebar-width: 48px;
            --panel-min-width: 200px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Light theme */
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --bg-tertiary: #f0f3f6;
            --bg-hover: #eaeef2;
            --bg-active: #d1d9e0;
            
            --border-primary: #d1d9e0;
            --border-secondary: #e2e8f0;
            
            --text-primary: #1a202c;
            --text-secondary: #57606a;
            --text-tertiary: #6e7781;
            --text-link: #0969da;
            
            --accent-primary: #1a7f37;
            --accent-secondary: #0969da;
            --accent-danger: #cf222e;
            --accent-warning: #9a6700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        /* Main Layout */
        .ide-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        
        /* Header Bar */
        .header-bar {
            display: flex;
            align-items: center;
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            padding: 0 12px;
            gap: 12px;
            z-index: 100;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-title svg {
            width: 20px;
            height: 20px;
            fill: var(--accent-primary);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: inherit;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--accent-primary);
            filter: brightness(1.1);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-primary);
        }
        
        .btn-secondary:hover {
            background: var(--bg-hover);
        }
        
        .btn-icon {
            padding: 6px;
            background: transparent;
            color: var(--text-secondary);
        }
        
        .btn-icon:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .btn-icon svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
        
        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0;
            gap: 4px;
            z-index: 50;
        }
        
        .sidebar-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .sidebar-btn:hover {
            background: var(--bg-hover);
        }
        
        .sidebar-btn.active {
            background: var(--bg-active);
            color: var(--accent-primary);
        }
        
        .sidebar-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .tooltip {
            position: absolute;
            left: calc(100% + 8px);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-fast);
            z-index: 1000;
        }
        
        .sidebar-btn:hover .tooltip {
            opacity: 1;
        }
        
        /* Editor and Output Panels */
        .panels-container {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }
        
        .panel {
            position: relative;
            display: flex;
            flex-direction: column;
            min-width: var(--panel-min-width);
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 32px;
            padding: 0 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .panel-tabs {
            display: flex;
            align-items: center;
            height: 100%;
            gap: 4px;
        }
        
        .panel-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0 12px;
            height: 100%;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-bottom: 2px solid transparent;
        }
        
        .panel-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .panel-tab.active {
            color: var(--text-primary);
            border-bottom-color: var(--accent-primary);
        }
        
        .panel-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        #editor-container {
            width: 100%;
            height: 100%;
        }
        
        #output-container {
            width: 100%;
            height: 100%;
            padding: 12px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            background: var(--bg-primary);
        }
        
        /* Resizer */
        .panel-resizer {
            width: 4px;
            background: var(--border-primary);
            cursor: col-resize;
            position: relative;
            transition: background var(--transition-fast);
            flex-shrink: 0;
        }
        
        .panel-resizer:hover,
        .panel-resizer.resizing {
            background: var(--accent-secondary);
        }
        
        /* Bottom Panel */
        .bottom-panel {
            position: absolute;
            bottom: var(--status-height);
            left: 0;
            right: 0;
            height: 200px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-primary);
            display: none;
            flex-direction: column;
            z-index: 40;
        }
        
        .bottom-panel.visible {
            display: flex;
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            height: var(--status-height);
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-primary);
            padding: 0 12px;
            font-size: 11px;
            color: var(--text-tertiary);
            gap: 16px;
            z-index: 100;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-item.clickable {
            cursor: pointer;
            transition: color var(--transition-fast);
        }
        
        .status-item.clickable:hover {
            color: var(--text-primary);
        }
        
        .status-spacer {
            flex: 1;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-tertiary);
        }
        
        .status-indicator.success {
            background: var(--accent-primary);
        }
        
        .status-indicator.error {
            background: var(--accent-danger);
        }
        
        .status-indicator.running {
            background: var(--accent-warning);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Output Styles */
        .output-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            border-left: 3px solid transparent;
        }
        
        .output-entry.log {
            border-left-color: var(--text-secondary);
        }
        
        .output-entry.error {
            border-left-color: var(--accent-danger);
            color: var(--accent-danger);
        }
        
        .output-entry.success {
            border-left-color: var(--accent-primary);
        }
        
        .output-entry.warning {
            border-left-color: var(--accent-warning);
            color: var(--accent-warning);
        }
        
        .output-timestamp {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-bottom: 4px;
        }
        
        .output-content {
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        /* Execution Timer */
        .execution-time {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: var(--bg-hover);
            border-radius: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            z-index: 200;
        }
        
        .loading-overlay.visible {
            display: flex;
        }
        
        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--bg-hover);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Settings Panel */
        .settings-panel {
            position: absolute;
            top: var(--header-height);
            left: var(--sidebar-width);
            width: 300px;
            bottom: var(--status-height);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            transform: translateX(-100%);
            transition: transform var(--transition-normal);
            z-index: 60;
            overflow-y: auto;
        }
        
        .settings-panel.visible {
            transform: translateX(0);
        }
        
        .settings-section {
            padding: 16px;
            border-bottom: 1px solid var(--border-primary);
        }
        
        .settings-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .settings-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 36px;
            height: 20px;
            background: var(--bg-hover);
            border-radius: 10px;
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .toggle.checked {
            background: var(--accent-primary);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition-fast);
        }
        
        .toggle.checked .toggle-slider {
            transform: translateX(16px);
        }
        
        /* Select Dropdown */
        .select {
            padding: 4px 8px;
            font-size: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-primary);
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        
        /* Examples Dropdown */
        .examples-dropdown {
            position: relative;
        }
        
        .examples-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            min-width: 200px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 150;
        }
        
        .examples-menu.visible {
            display: block;
        }
        
        .examples-item {
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: background var(--transition-fast);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .examples-item:hover {
            background: var(--bg-hover);
        }
        
        .examples-item-title {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .examples-item-desc {
            font-size: 11px;
            color: var(--text-tertiary);
        }
        
        /* Keyboard Shortcuts Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            backdrop-filter: blur(4px);
        }
        
        .modal.visible {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-primary);
            font-size: 16px;
            font-weight: 600;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .shortcuts-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        .shortcut-keys {
            display: flex;
            gap: 4px;
        }
        
        .key {
            padding: 2px 6px;
            background: var(--bg-hover);
            border: 1px solid var(--border-primary);
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 500;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .panels-container {
                flex-direction: column;
            }
            
            .panel {
                min-width: 100%;
            }
            
            .panel-resizer {
                display: none;
            }
            
            .header-title span {
                display: none;
            }
            
            .status-bar {
                gap: 8px;
            }
            
            .status-item.hide-mobile {
                display: none;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .header-bar,
            .sidebar,
            .status-bar,
            .settings-panel {
                display: none;
            }
            
            .panel-content {
                border: none;
            }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        :focus-visible {
            outline: 2px solid var(--accent-secondary);
            outline-offset: 2px;
        }
        
        /* Animations */
        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        @keyframes slideInFromBottom {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="ide-container">
        <!-- Header Bar -->
        <header class="header-bar" role="banner">
            <div class="header-title">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <span>Wang Playground</span>
            </div>
            
            <div class="header-actions">
                <button class="btn btn-primary" id="run-btn" aria-label="Run code (Ctrl+Enter)">
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                        <path fill="white" d="M4 2v12l10-6z"/>
                    </svg>
                    Run
                </button>
                
                <button class="btn btn-secondary" id="validate-btn" aria-label="Validate code">
                    <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
                        <path fill="currentColor" d="M6.5 12.5L2 8l1.5-1.5L6.5 9.5 12.5 3.5 14 5z"/>
                    </svg>
                    Validate
                </button>
                
                <div class="examples-dropdown">
                    <button class="btn btn-secondary" id="examples-btn" aria-label="Load example">
                        Examples â–¾
                    </button>
                    <div class="examples-menu" id="examples-menu" role="menu">
                        <div class="examples-item" data-example="hello" role="menuitem">
                            <div class="examples-item-title">Hello World</div>
                            <div class="examples-item-desc">Basic Wang syntax</div>
                        </div>
                        <div class="examples-item" data-example="pipeline" role="menuitem">
                            <div class="examples-item-title">Pipeline Operations</div>
                            <div class="examples-item-desc">Using |> and -> operators</div>
                        </div>
                        <div class="examples-item" data-example="async" role="menuitem">
                            <div class="examples-item-title">Async/Await</div>
                            <div class="examples-item-desc">Asynchronous operations</div>
                        </div>
                        <div class="examples-item" data-example="class" role="menuitem">
                            <div class="examples-item-title">Classes</div>
                            <div class="examples-item-desc">OOP with inheritance</div>
                        </div>
                        <div class="examples-item" data-example="module" role="menuitem">
                            <div class="examples-item-title">Modules</div>
                            <div class="examples-item-desc">Import/export system</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-icon" id="share-btn" aria-label="Share code">
                    <svg viewBox="0 0 16 16">
                        <path d="M13 5.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zM13 13.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zM3 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
                        <path d="M5.32 7.3L10.68 4.7M5.32 8.7L10.68 11.3"/>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="theme-toggle" aria-label="Toggle theme">
                    <svg viewBox="0 0 16 16">
                        <path d="M8 2a6 6 0 1 0 0 12V2z"/>
                    </svg>
                </button>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Sidebar -->
            <nav class="sidebar" role="navigation">
                <div class="sidebar-btn active" id="sidebar-code" aria-label="Code editor" role="button">
                    <svg viewBox="0 0 24 24">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l5.6 5.6a1 1 0 0 1 0 1.4l-5.6 5.6a1 1 0 1 0 1.4 1.4l5.6-5.6a3 3 0 0 0 0-4.2l-5.6-5.6a1 1 0 0 0-1.4 0z"/>
                        <path d="M9.3 17.7a1 1 0 0 0 0-1.4L3.7 10.7a1 1 0 0 1 0-1.4L9.3 3.7a1 1 0 1 0-1.4-1.4L2.3 7.9a3 3 0 0 0 0 4.2l5.6 5.6a1 1 0 0 0 1.4 0z"/>
                    </svg>
                    <span class="tooltip">Code Editor</span>
                </div>
                
                <div class="sidebar-btn" id="sidebar-output" aria-label="Output panel" role="button">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 3h18v6H3zm0 8h18v10H3z"/>
                    </svg>
                    <span class="tooltip">Output</span>
                </div>
                
                <div class="sidebar-btn" id="sidebar-console" aria-label="Console" role="button">
                    <svg viewBox="0 0 24 24">
                        <path d="M2 3h20v14H2zm5 3l4 4-4 4m5 0h5"/>
                    </svg>
                    <span class="tooltip">Console</span>
                </div>
                
                <div class="sidebar-btn" id="sidebar-settings" aria-label="Settings" role="button">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"/>
                        <path d="M12 2l2 5h5l-4 3 1.5 5L12 12l-4.5 3L9 10l-4-3h5z"/>
                    </svg>
                    <span class="tooltip">Settings</span>
                </div>
                
                <div style="flex: 1;"></div>
                
                <div class="sidebar-btn" id="sidebar-shortcuts" aria-label="Keyboard shortcuts" role="button">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 6h18v4H3zm0 8h12v4H3z"/>
                    </svg>
                    <span class="tooltip">Shortcuts</span>
                </div>
            </nav>
            
            <!-- Panels Container -->
            <div class="panels-container">
                <!-- Editor Panel -->
                <div class="panel" id="editor-panel" style="flex: 2;">
                    <div class="panel-header">
                        <div class="panel-tabs">
                            <div class="panel-tab active">main.wang</div>
                        </div>
                        <div class="panel-actions">
                            <span class="execution-time" id="exec-time" style="display: none;">
                                <svg width="12" height="12" viewBox="0 0 16 16">
                                    <path fill="currentColor" d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                    <path fill="currentColor" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                                </svg>
                                <span id="exec-time-value">0ms</span>
                            </span>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="editor-container"></div>
                    </div>
                </div>
                
                <!-- Resizer -->
                <div class="panel-resizer" id="resizer"></div>
                
                <!-- Output Panel -->
                <div class="panel" id="output-panel" style="flex: 1;">
                    <div class="panel-header">
                        <div class="panel-tabs">
                            <div class="panel-tab active">Output</div>
                            <div class="panel-tab">AST</div>
                        </div>
                        <button class="btn btn-icon" id="clear-output" aria-label="Clear output">
                            <svg viewBox="0 0 16 16">
                                <path d="M2 2l12 12M14 2L2 14"/>
                            </svg>
                        </button>
                    </div>
                    <div class="panel-content">
                        <div id="output-container">
                            <div class="output-entry log">
                                <div class="output-timestamp">Ready</div>
                                <div class="output-content">Wang Playground initialized. Press Ctrl+Enter to run your code.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Panel -->
            <div class="settings-panel" id="settings-panel">
                <div class="settings-section">
                    <div class="settings-title">Editor Settings</div>
                    
                    <div class="settings-item">
                        <label class="settings-label" for="font-size">Font Size</label>
                        <select class="select" id="font-size">
                            <option value="12">12px</option>
                            <option value="13">13px</option>
                            <option value="14" selected>14px</option>
                            <option value="16">16px</option>
                            <option value="18">18px</option>
                        </select>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label" for="tab-size">Tab Size</label>
                        <select class="select" id="tab-size">
                            <option value="2" selected>2 spaces</option>
                            <option value="4">4 spaces</option>
                            <option value="8">8 spaces</option>
                        </select>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Word Wrap</label>
                        <div class="toggle" id="word-wrap">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Line Numbers</label>
                        <div class="toggle checked" id="line-numbers">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Minimap</label>
                        <div class="toggle" id="minimap">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-title">Execution Settings</div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Auto-run</label>
                        <div class="toggle" id="auto-run">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Auto-save</label>
                        <div class="toggle checked" id="auto-save">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="settings-item">
                        <label class="settings-label">Clear on Run</label>
                        <div class="toggle checked" id="clear-on-run">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-title">Key Bindings</div>
                    
                    <div class="settings-item">
                        <label class="settings-label" for="key-bindings">Editor Mode</label>
                        <select class="select" id="key-bindings">
                            <option value="default" selected>Default</option>
                            <option value="vim">Vim</option>
                            <option value="emacs">Emacs</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Panel (Console/Errors) -->
            <div class="bottom-panel" id="bottom-panel">
                <div class="panel-header">
                    <div class="panel-tabs">
                        <div class="panel-tab active">Problems</div>
                        <div class="panel-tab">Terminal</div>
                        <div class="panel-tab">Debug Console</div>
                    </div>
                    <button class="btn btn-icon" id="close-bottom" aria-label="Close panel">
                        <svg viewBox="0 0 16 16">
                            <path d="M2 2l12 12M14 2L2 14"/>
                        </svg>
                    </button>
                </div>
                <div class="panel-content">
                    <div id="bottom-content"></div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <footer class="status-bar" role="contentinfo">
            <div class="status-item">
                <div class="status-indicator" id="status-indicator"></div>
                <span id="status-text">Ready</span>
            </div>
            
            <div class="status-item hide-mobile">
                <span id="cursor-position">Ln 1, Col 1</span>
            </div>
            
            <div class="status-item hide-mobile">
                <span id="selection-info"></span>
            </div>
            
            <div class="status-spacer"></div>
            
            <div class="status-item clickable" id="language-mode">
                Wang
            </div>
            
            <div class="status-item hide-mobile">
                <span id="encoding">UTF-8</span>
            </div>
            
            <div class="status-item clickable">
                <a href="https://github.com/artpar/wang" target="_blank" style="color: inherit; text-decoration: none;">
                    GitHub
                </a>
            </div>
        </footer>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div class="modal" id="shortcuts-modal" role="dialog" aria-labelledby="shortcuts-title">
        <div class="modal-content">
            <div class="modal-header" id="shortcuts-title">
                Keyboard Shortcuts
            </div>
            <div class="modal-body">
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span>Run code</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">Enter</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Format code</span>
                        <div class="shortcut-keys">
                            <span class="key">Shift</span>
                            <span class="key">Alt</span>
                            <span class="key">F</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle comment</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">/</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Find</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">F</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Replace</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">H</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Save to localStorage</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">S</span>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle settings</span>
                        <div class="shortcut-keys">
                            <span class="key">Ctrl</span>
                            <span class="key">,</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load Monaco Editor -->
    <script>
        var require = { paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.nls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.js"></script>
    
    <!-- Load Wang Language -->
    <script src="./wang.min.js"></script>
    
    <!-- Application Code -->
    <script>
        // Initialize the IDE
        class WangIDE {
            constructor() {
                this.editor = null;
                this.interpreter = null;
                this.validator = null;
                this.settings = this.loadSettings();
                this.executionStartTime = null;
                this.isRunning = false;
                this.autoRunTimer = null;
                
                this.init();
            }
            
            init() {
                this.initMonaco();
                this.initWang();
                this.initEventListeners();
                this.initResizer();
                this.applySettings();
                this.loadSavedCode();
            }
            
            initMonaco() {
                // Register Wang language with Monaco
                monaco.languages.register({ id: 'wang' });
                
                // Define Wang language tokens
                monaco.languages.setMonarchTokensProvider('wang', {
                    keywords: [
                        'let', 'const', 'var', 'function', 'async', 'await', 'if', 'else',
                        'for', 'while', 'do', 'break', 'continue', 'return', 'class',
                        'extends', 'new', 'this', 'super', 'import', 'export', 'from',
                        'try', 'catch', 'finally', 'throw', 'typeof', 'instanceof',
                        'true', 'false', 'null', 'undefined'
                    ],
                    
                    operators: [
                        '=', '>', '<', '!', '~', '?', ':', '==', '<=', '>=', '!=',
                        '&&', '||', '++', '--', '+', '-', '*', '/', '&', '|', '^',
                        '%', '<<', '>>', '>>>', '+=', '-=', '*=', '/=', '&=', '|=',
                        '^=', '%=', '<<=', '>>=', '>>>=', '=>', '|>', '->'
                    ],
                    
                    tokenizer: {
                        root: [
                            // Comments
                            [/\/\/.*$/, 'comment'],
                            [/\/\*/, 'comment', '@comment'],
                            
                            // Keywords
                            [/\b(let|const|var|function|async|await|if|else|for|while|do|break|continue|return|class|extends|new|this|super|import|export|from|try|catch|finally|throw|typeof|instanceof|true|false|null|undefined)\b/, 'keyword'],
                            
                            // Numbers
                            [/\b\d+(\.\d+)?\b/, 'number'],
                            
                            // Strings
                            [/"([^"\\]|\\.)*$/, 'string.invalid'],
                            [/'([^'\\]|\\.)*$/, 'string.invalid'],
                            [/"/, 'string', '@string_double'],
                            [/'/, 'string', '@string_single'],
                            [/`/, 'string', '@string_backtick'],
                            
                            // Operators
                            [/[=><!~?:&|+\-*\/\^%]+/, 'operator'],
                            
                            // Identifiers
                            [/[a-zA-Z_$][a-zA-Z0-9_$]*/, 'identifier'],
                            
                            // Whitespace
                            [/[ \t\r\n]+/, 'white'],
                            
                            // Delimiters
                            [/[{}()\[\]]/, '@brackets'],
                            [/[;,.]/, 'delimiter']
                        ],
                        
                        comment: [
                            [/[^\/*]+/, 'comment'],
                            [/\*\//, 'comment', '@pop'],
                            [/[\/*]/, 'comment']
                        ],
                        
                        string_double: [
                            [/[^\\"]+/, 'string'],
                            [/\\./, 'string.escape'],
                            [/"/, 'string', '@pop']
                        ],
                        
                        string_single: [
                            [/[^\\']+/, 'string'],
                            [/\\./, 'string.escape'],
                            [/'/, 'string', '@pop']
                        ],
                        
                        string_backtick: [
                            [/[^\\`$]+/, 'string'],
                            [/\\./, 'string.escape'],
                            [/\$\{/, 'delimiter', '@interpolation'],
                            [/`/, 'string', '@pop']
                        ],
                        
                        interpolation: [
                            [/\}/, 'delimiter', '@pop'],
                            { include: 'root' }
                        ]
                    }
                });
                
                // Define Wang theme
                monaco.editor.defineTheme('wang-dark', {
                    base: 'vs-dark',
                    inherit: true,
                    rules: [
                        { token: 'keyword', foreground: 'ff79c6' },
                        { token: 'string', foreground: 'f1fa8c' },
                        { token: 'number', foreground: 'bd93f9' },
                        { token: 'comment', foreground: '6272a4', fontStyle: 'italic' },
                        { token: 'operator', foreground: 'ff79c6' }
                    ],
                    colors: {
                        'editor.background': '#0d0e11',
                        'editor.foreground': '#e6edf3',
                        'editorLineNumber.foreground': '#6e7681',
                        'editorCursor.foreground': '#58a6ff',
                        'editor.selectionBackground': '#3392FF44',
                        'editor.lineHighlightBackground': '#1e2127'
                    }
                });
                
                // Create Monaco editor instance
                this.editor = monaco.editor.create(document.getElementById('editor-container'), {
                    value: this.getDefaultCode(),
                    language: 'wang',
                    theme: 'wang-dark',
                    fontSize: 14,
                    minimap: { enabled: false },
                    automaticLayout: true,
                    lineNumbers: 'on',
                    scrollBeyondLastLine: false,
                    wordWrap: 'off',
                    tabSize: 2,
                    insertSpaces: true,
                    folding: true,
                    bracketPairColorization: { enabled: true },
                    suggestOnTriggerCharacters: true
                });
                
                // Update cursor position
                this.editor.onDidChangeCursorPosition((e) => {
                    const position = e.position;
                    document.getElementById('cursor-position').textContent = 
                        `Ln ${position.lineNumber}, Col ${position.column}`;
                });
                
                // Update selection info
                this.editor.onDidChangeCursorSelection((e) => {
                    const selection = e.selection;
                    const model = this.editor.getModel();
                    const selectedText = model.getValueInRange(selection);
                    
                    if (selectedText.length > 0) {
                        const lines = selectedText.split('\n').length;
                        const chars = selectedText.length;
                        document.getElementById('selection-info').textContent = 
                            `${chars} chars, ${lines} lines selected`;
                    } else {
                        document.getElementById('selection-info').textContent = '';
                    }
                });
                
                // Auto-save to localStorage
                this.editor.onDidChangeModelContent(() => {
                    if (this.settings.autoSave) {
                        this.saveCode();
                    }
                    
                    // Auto-run if enabled
                    if (this.settings.autoRun) {
                        clearTimeout(this.autoRunTimer);
                        this.autoRunTimer = setTimeout(() => this.runCode(), 1000);
                    }
                });
            }
            
            initWang() {
                const { WangInterpreter, InMemoryModuleResolver, WangValidator } = Wang;
                
                // Create module resolver
                const resolver = new InMemoryModuleResolver();
                
                // Create interpreter with built-in functions
                this.interpreter = new WangInterpreter({
                    moduleResolver: resolver,
                    functions: {
                        log: (...args) => {
                            this.addOutput('log', args.map(a => 
                                typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)
                            ).join(' '));
                        },
                        error: (...args) => {
                            this.addOutput('error', args.join(' '));
                        },
                        warn: (...args) => {
                            this.addOutput('warning', args.join(' '));
                        },
                        clear: () => {
                            this.clearOutput();
                        },
                        now: () => Date.now(),
                        setTimeout: (fn, delay) => setTimeout(fn, delay),
                        setInterval: (fn, delay) => setInterval(fn, delay),
                        clearTimeout: (id) => clearTimeout(id),
                        clearInterval: (id) => clearInterval(id),
                        fetch: (url, options) => fetch(url, options),
                        parseInt: (str, radix) => parseInt(str, radix),
                        parseFloat: (str) => parseFloat(str),
                        isNaN: (val) => isNaN(val),
                        isFinite: (val) => isFinite(val)
                    }
                });
                
                // Set built-in objects
                this.interpreter.setVariable('Math', Math);
                this.interpreter.setVariable('JSON', JSON);
                this.interpreter.setVariable('Date', Date);
                this.interpreter.setVariable('Array', Array);
                this.interpreter.setVariable('Object', Object);
                this.interpreter.setVariable('String', String);
                this.interpreter.setVariable('Number', Number);
                this.interpreter.setVariable('Boolean', Boolean);
                this.interpreter.setVariable('RegExp', RegExp);
                this.interpreter.setVariable('console', {
                    log: (...args) => this.addOutput('log', args.join(' ')),
                    error: (...args) => this.addOutput('error', args.join(' ')),
                    warn: (...args) => this.addOutput('warning', args.join(' ')),
                    info: (...args) => this.addOutput('log', args.join(' ')),
                    debug: (...args) => this.addOutput('log', args.join(' ')),
                    table: (data) => this.addOutput('log', JSON.stringify(data, null, 2)),
                    clear: () => this.clearOutput()
                });
                
                // Create validator
                this.validator = new WangValidator();
            }
            
            initEventListeners() {
                // Run button
                document.getElementById('run-btn').addEventListener('click', () => this.runCode());
                
                // Validate button
                document.getElementById('validate-btn').addEventListener('click', () => this.validateCode());
                
                // Clear output button
                document.getElementById('clear-output').addEventListener('click', () => this.clearOutput());
                
                // Examples dropdown
                document.getElementById('examples-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('examples-menu');
                    menu.classList.toggle('visible');
                });
                
                // Example items
                document.querySelectorAll('.examples-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const example = item.dataset.example;
                        this.loadExample(example);
                        document.getElementById('examples-menu').classList.remove('visible');
                    });
                });
                
                // Share button
                document.getElementById('share-btn').addEventListener('click', () => this.shareCode());
                
                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());
                
                // Sidebar buttons
                document.getElementById('sidebar-settings').addEventListener('click', () => {
                    const panel = document.getElementById('settings-panel');
                    panel.classList.toggle('visible');
                });
                
                document.getElementById('sidebar-console').addEventListener('click', () => {
                    const panel = document.getElementById('bottom-panel');
                    panel.classList.toggle('visible');
                });
                
                document.getElementById('sidebar-shortcuts').addEventListener('click', () => {
                    document.getElementById('shortcuts-modal').classList.add('visible');
                });
                
                // Close bottom panel
                document.getElementById('close-bottom').addEventListener('click', () => {
                    document.getElementById('bottom-panel').classList.remove('visible');
                });
                
                // Modal close
                document.getElementById('shortcuts-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'shortcuts-modal') {
                        e.target.classList.remove('visible');
                    }
                });
                
                // Settings
                document.getElementById('font-size').addEventListener('change', (e) => {
                    this.editor.updateOptions({ fontSize: parseInt(e.target.value) });
                    this.saveSettings();
                });
                
                document.getElementById('tab-size').addEventListener('change', (e) => {
                    this.editor.updateOptions({ tabSize: parseInt(e.target.value) });
                    this.saveSettings();
                });
                
                document.getElementById('word-wrap').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    const enabled = toggle.classList.contains('checked');
                    this.editor.updateOptions({ wordWrap: enabled ? 'on' : 'off' });
                    this.saveSettings();
                });
                
                document.getElementById('line-numbers').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    const enabled = toggle.classList.contains('checked');
                    this.editor.updateOptions({ lineNumbers: enabled ? 'on' : 'off' });
                    this.saveSettings();
                });
                
                document.getElementById('minimap').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    const enabled = toggle.classList.contains('checked');
                    this.editor.updateOptions({ minimap: { enabled } });
                    this.saveSettings();
                });
                
                document.getElementById('auto-run').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    this.settings.autoRun = toggle.classList.contains('checked');
                    this.saveSettings();
                });
                
                document.getElementById('auto-save').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    this.settings.autoSave = toggle.classList.contains('checked');
                    this.saveSettings();
                });
                
                document.getElementById('clear-on-run').addEventListener('click', (e) => {
                    const toggle = e.currentTarget;
                    toggle.classList.toggle('checked');
                    this.settings.clearOnRun = toggle.classList.contains('checked');
                    this.saveSettings();
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl+Enter: Run code
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        e.preventDefault();
                        this.runCode();
                    }
                    
                    // Ctrl+S: Save
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        this.saveCode();
                        this.addOutput('success', 'Code saved to localStorage');
                    }
                    
                    // Ctrl+,: Settings
                    if ((e.ctrlKey || e.metaKey) && e.key === ',') {
                        e.preventDefault();
                        const panel = document.getElementById('settings-panel');
                        panel.classList.toggle('visible');
                    }
                    
                    // Escape: Close modals
                    if (e.key === 'Escape') {
                        document.getElementById('shortcuts-modal').classList.remove('visible');
                        document.getElementById('settings-panel').classList.remove('visible');
                        document.getElementById('examples-menu').classList.remove('visible');
                    }
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', () => {
                    document.getElementById('examples-menu').classList.remove('visible');
                });
            }
            
            initResizer() {
                const resizer = document.getElementById('resizer');
                const editorPanel = document.getElementById('editor-panel');
                const outputPanel = document.getElementById('output-panel');
                const container = document.querySelector('.panels-container');
                
                let isResizing = false;
                let startX = 0;
                let startWidthEditor = 0;
                let startWidthOutput = 0;
                
                resizer.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startWidthEditor = editorPanel.offsetWidth;
                    startWidthOutput = outputPanel.offsetWidth;
                    resizer.classList.add('resizing');
                    document.body.style.cursor = 'col-resize';
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    
                    const dx = e.clientX - startX;
                    const containerWidth = container.offsetWidth;
                    const newEditorWidth = startWidthEditor + dx;
                    const newOutputWidth = startWidthOutput - dx;
                    
                    if (newEditorWidth > 200 && newOutputWidth > 200) {
                        const editorFlex = newEditorWidth / containerWidth;
                        const outputFlex = newOutputWidth / containerWidth;
                        
                        editorPanel.style.flex = editorFlex;
                        outputPanel.style.flex = outputFlex;
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isResizing = false;
                    resizer.classList.remove('resizing');
                    document.body.style.cursor = '';
                });
            }
            
            async runCode() {
                if (this.isRunning) return;
                
                const code = this.editor.getValue();
                
                if (this.settings.clearOnRun) {
                    this.clearOutput();
                }
                
                this.isRunning = true;
                this.executionStartTime = performance.now();
                this.updateStatus('running', 'Running...');
                document.getElementById('exec-time').style.display = 'inline-flex';
                
                try {
                    const result = await this.interpreter.execute(code);
                    
                    const executionTime = Math.round(performance.now() - this.executionStartTime);
                    document.getElementById('exec-time-value').textContent = `${executionTime}ms`;
                    
                    if (result !== undefined && result !== null) {
                        this.addOutput('success', `Result: ${typeof result === 'object' ? JSON.stringify(result, null, 2) : result}`);
                    }
                    
                    this.updateStatus('success', 'Execution completed');
                } catch (error) {
                    this.addOutput('error', error.message || error.toString());
                    this.updateStatus('error', 'Execution failed');
                    
                    // Show error in bottom panel
                    const bottomPanel = document.getElementById('bottom-panel');
                    bottomPanel.classList.add('visible');
                    document.getElementById('bottom-content').innerHTML = `
                        <div class="output-entry error">
                            <div class="output-content">${error.message || error.toString()}</div>
                        </div>
                    `;
                } finally {
                    this.isRunning = false;
                }
            }
            
            validateCode() {
                const code = this.editor.getValue();
                const result = this.validator.validate(code, { includeAST: true });
                
                if (result.valid) {
                    this.addOutput('success', 'âœ… Valid Wang code');
                    
                    if (result.ast) {
                        // Show AST in output panel (simplified view)
                        this.addOutput('log', 'Abstract Syntax Tree:\n' + JSON.stringify(result.ast, null, 2));
                    }
                } else {
                    this.addOutput('error', `âŒ Validation error:\n${result.error.message}`);
                    
                    if (result.error.suggestion) {
                        this.addOutput('warning', `ðŸ’¡ Suggestion: ${result.error.suggestion}`);
                    }
                }
            }
            
            addOutput(type, message) {
                const container = document.getElementById('output-container');
                const entry = document.createElement('div');
                entry.className = `output-entry ${type}`;
                
                const timestamp = document.createElement('div');
                timestamp.className = 'output-timestamp';
                timestamp.textContent = new Date().toLocaleTimeString();
                
                const content = document.createElement('div');
                content.className = 'output-content';
                content.textContent = message;
                
                entry.appendChild(timestamp);
                entry.appendChild(content);
                container.appendChild(entry);
                
                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
            }
            
            clearOutput() {
                document.getElementById('output-container').innerHTML = '';
            }
            
            updateStatus(state, text) {
                const indicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');
                
                indicator.className = `status-indicator ${state}`;
                statusText.textContent = text;
            }
            
            shareCode() {
                const code = this.editor.getValue();
                const encoded = btoa(encodeURIComponent(code));
                const url = `${window.location.origin}${window.location.pathname}#code=${encoded}`;
                
                navigator.clipboard.writeText(url).then(() => {
                    this.addOutput('success', 'Share URL copied to clipboard!');
                }).catch(() => {
                    prompt('Share URL:', url);
                });
            }
            
            toggleTheme() {
                const html = document.documentElement;
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                html.setAttribute('data-theme', newTheme);
                this.editor.updateOptions({
                    theme: newTheme === 'light' ? 'vs' : 'wang-dark'
                });
                
                localStorage.setItem('wang-theme', newTheme);
            }
            
            loadExample(name) {
                const examples = {
                    hello: `// Hello World in Wang
let greeting = "Hello, Wang Language!"
log(greeting)

// String interpolation
let name = "Developer"
let message = \`Welcome, \${name}!\`
log(message)

// Arrays and loops
let numbers = [1, 2, 3, 4, 5]
for (let num of numbers) {
    log(\`Number: \${num}\`)
}`,
                    
                    pipeline: `// Pipeline operators in Wang
let data = [1, 2, 3, 4, 5]

// Using the pipe operator |>
let doubled = data |> map(_, x => x * 2)
log("Doubled:", doubled)

// Using the arrow operator ->
let result = data 
    |> filter(_, x => x > 2)
    |> map(_, x => x * 3)
    -> reduce(_, (acc, val) => acc + val, 0)

log("Pipeline result:", result)`,
                    
                    async: `// Async/Await in Wang
async function fetchData() {
    log("Starting async operation...")
    
    // Simulate async delay
    await new Promise(resolve => setTimeout(resolve, 1000))
    
    return { status: "success", data: [1, 2, 3] }
}

// Call async function
let result = await fetchData()
log("Result:", result)

// Async error handling
async function mayFail() {
    if (Math.random() > 0.5) {
        throw new Error("Random failure!")
    }
    return "Success!"
}

try {
    let outcome = await mayFail()
    log("Outcome:", outcome)
} catch (error) {
    error("Caught:", error.message)
}`,
                    
                    class: `// Classes in Wang
class Animal {
    constructor(name) {
        this.name = name
    }
    
    speak() {
        log(\`\${this.name} makes a sound\`)
    }
}

class Dog extends Animal {
    constructor(name, breed) {
        super(name)
        this.breed = breed
    }
    
    speak() {
        log(\`\${this.name} the \${this.breed} barks!\`)
    }
    
    wagTail() {
        log(\`\${this.name} is wagging its tail\`)
    }
}

// Create instances
let pet = new Dog("Max", "Golden Retriever")
pet.speak()
pet.wagTail()

// Check inheritance
log("Is pet an Animal?", pet instanceof Animal)
log("Is pet a Dog?", pet instanceof Dog)`,
                    
                    module: `// Module system in Wang
// Note: This is a simulation since we're in a playground

// Simulated module export
let mathUtils = {
    add: (a, b) => a + b,
    multiply: (a, b) => a * b,
    factorial: function(n) {
        if (n <= 1) return 1
        return n * this.factorial(n - 1)
    }
}

// Using the "imported" module
log("Addition: 5 + 3 =", mathUtils.add(5, 3))
log("Multiplication: 4 Ã— 7 =", mathUtils.multiply(4, 7))
log("Factorial: 5! =", mathUtils.factorial(5))

// Destructuring
let { add, multiply } = mathUtils
log("Using destructured functions:", add(10, 20))`
                };
                
                if (examples[name]) {
                    this.editor.setValue(examples[name]);
                }
            }
            
            saveCode() {
                const code = this.editor.getValue();
                localStorage.setItem('wang-code', code);
            }
            
            loadSavedCode() {
                // Check for shared code in URL
                const hash = window.location.hash;
                if (hash.startsWith('#code=')) {
                    try {
                        const encoded = hash.slice(6);
                        const code = decodeURIComponent(atob(encoded));
                        this.editor.setValue(code);
                        return;
                    } catch (e) {
                        console.error('Failed to load shared code:', e);
                    }
                }
                
                // Load from localStorage
                const saved = localStorage.getItem('wang-code');
                if (saved) {
                    this.editor.setValue(saved);
                }
            }
            
            loadSettings() {
                const saved = localStorage.getItem('wang-settings');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                return {
                    fontSize: 14,
                    tabSize: 2,
                    wordWrap: false,
                    lineNumbers: true,
                    minimap: false,
                    autoRun: false,
                    autoSave: true,
                    clearOnRun: true,
                    theme: 'dark'
                };
            }
            
            saveSettings() {
                const settings = {
                    fontSize: parseInt(document.getElementById('font-size').value),
                    tabSize: parseInt(document.getElementById('tab-size').value),
                    wordWrap: document.getElementById('word-wrap').classList.contains('checked'),
                    lineNumbers: document.getElementById('line-numbers').classList.contains('checked'),
                    minimap: document.getElementById('minimap').classList.contains('checked'),
                    autoRun: document.getElementById('auto-run').classList.contains('checked'),
                    autoSave: document.getElementById('auto-save').classList.contains('checked'),
                    clearOnRun: document.getElementById('clear-on-run').classList.contains('checked'),
                    theme: document.documentElement.getAttribute('data-theme') || 'dark'
                };
                
                this.settings = settings;
                localStorage.setItem('wang-settings', JSON.stringify(settings));
            }
            
            applySettings() {
                // Apply theme
                const savedTheme = localStorage.getItem('wang-theme') || 'dark';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                // Apply editor settings
                if (this.settings) {
                    document.getElementById('font-size').value = this.settings.fontSize;
                    document.getElementById('tab-size').value = this.settings.tabSize;
                    
                    if (this.settings.wordWrap) {
                        document.getElementById('word-wrap').classList.add('checked');
                    }
                    
                    if (!this.settings.lineNumbers) {
                        document.getElementById('line-numbers').classList.remove('checked');
                    }
                    
                    if (this.settings.minimap) {
                        document.getElementById('minimap').classList.add('checked');
                    }
                    
                    if (this.settings.autoRun) {
                        document.getElementById('auto-run').classList.add('checked');
                    }
                    
                    if (!this.settings.autoSave) {
                        document.getElementById('auto-save').classList.remove('checked');
                    }
                    
                    if (!this.settings.clearOnRun) {
                        document.getElementById('clear-on-run').classList.remove('checked');
                    }
                }
            }
            
            getDefaultCode() {
                return `// Welcome to Wang Playground!
// Wang is a modern workflow language with pipeline operators

// Variables
let message = "Hello, Wang!"
log(message)

// Pipeline example
let numbers = [1, 2, 3, 4, 5]
let result = numbers 
    |> filter(_, x => x > 2)
    |> map(_, x => x * 2)
log("Result:", result)

// Try pressing Ctrl+Enter to run this code!`;
            }
        }
        
        // Initialize IDE when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.ide = new WangIDE();
            });
        } else {
            window.ide = new WangIDE();
        }
    </script>
</body>
</html>