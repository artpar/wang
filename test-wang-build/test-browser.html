<!DOCTYPE html>
<html>
<head>
    <title>Test Wang Browser Build</title>
</head>
<body>
    <h1>Wang-Lang Browser Build Test</h1>
    <h2>Testing dist/browser/wang.min.js</h2>
    <div id="results"></div>
    
    <script src="../dist/browser/wang.min.js"></script>
    <script>
        // The browser build should expose Wang global
        console.log('Available globals:', Object.keys(window).filter(k => k.includes('Wang')));
        
        async function testBrowserBuild() {
            const resultsDiv = document.getElementById('results');
            
            // Check what's available
            if (typeof Wang === 'undefined') {
                resultsDiv.innerHTML = '<p style="color: red;">❌ Wang is not defined!</p>';
                console.error('Wang is not defined!');
                return;
            }
            
            console.log('Wang object:', Wang);
            console.log('Wang exports:', Object.keys(Wang));
            
            const { WangInterpreter, InMemoryModuleResolver } = Wang;
            
            if (!WangInterpreter || !InMemoryModuleResolver) {
                resultsDiv.innerHTML = '<p style="color: red;">❌ WangInterpreter or InMemoryModuleResolver not found!</p>';
                console.error('Missing exports:', { WangInterpreter, InMemoryModuleResolver });
                return;
            }
            
            const resolver = new InMemoryModuleResolver();
            const interpreter = new WangInterpreter({ moduleResolver: resolver });
            
            // Test 1: Browser extension pattern
            const code1 = `let __inputs = {}
let x = 10
x += 5
__result = x`;
            
            try {
                console.log('Test 1: Browser extension pattern');
                console.log('Code:', code1);
                const result = await interpreter.execute(code1);
                console.log('✅ SUCCESS: Result =', result);
                resultsDiv.innerHTML += '<p style="color: green;">✅ Test 1 PASSED: Result = ' + result + '</p>';
            } catch (error) {
                console.error('❌ Test 1 FAILED:', error.message);
                resultsDiv.innerHTML += '<p style="color: red;">❌ Test 1 FAILED: ' + error.message + '</p>';
            }
            
            // Test 2: Multiple compound assignments
            const code2 = `let __inputs = {}
let x = 10
x += 5
let y = 20
y -= 3
let z = 4
z *= 2
let w = 16
w /= 4
__result = {
  x: x,
  y: y,
  z: z,
  w: w
}`;
            
            try {
                console.log('Test 2: Multiple compound assignments');
                const result = await interpreter.execute(code2);
                console.log('✅ SUCCESS: Result =', result);
                resultsDiv.innerHTML += '<p style="color: green;">✅ Test 2 PASSED: Result = ' + JSON.stringify(result) + '</p>';
            } catch (error) {
                console.error('❌ Test 2 FAILED:', error.message);
                resultsDiv.innerHTML += '<p style="color: red;">❌ Test 2 FAILED: ' + error.message + '</p>';
            }
        }
        
        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', testBrowserBuild);
    </script>
</body>
</html>